"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{74095:function(we,de,m){m.d(de,{Z:function(){return at}});var S=m(4819),q=m(15854),E=m.n(q),V=m(10651),_=m(58503),ye=m(76516),ae=m(40387),Ee=m(24990),p=m(44251),be=m(33634),le=m(51172),Q=m(25177),xe=m(33841),P=m(49582),ie=m(36513),oe=m(4302),Ne=m(43007),Me=m(43223),Pe=m(96933),Ae=m(93484),$e=m(80809),u=m(94427),A=m(75606),se=m(14853),Re=m(98667),re=m.n(Re),lt={},Te=(e,c,n)=>new Promise((s,v)=>{var f=r=>{try{b(n.next(r))}catch(C){v(C)}},t=r=>{try{b(n.throw(r))}catch(C){v(C)}},b=r=>r.done?s(r.value):Promise.resolve(r.value).then(f,t);b((n=n.apply(e,c)).next())});function j(e){if(e==="*"||e==="?"||e==="")return e;const c=e.split(","),n=[];for(let s=0;s<c.length;s++){const v=c[s].match(/(\d+)-(\d+)/);if(v)for(let f=parseInt(v[1],10);f<=parseInt(v[2],10);f++)n.push(f);else n.push(parseInt(c[s],10))}return n}function U(e,c){const n={};if(c){const s=c.split(/\D/);n.seconds=[parseInt(s[5],10)],n.minutes=[parseInt(s[4],10)],n.hours=[parseInt(s[3],10)],n.dates=[parseInt(s[2],10)],n.months=[parseInt(s[1],10)],n.dows="?"}else{const s=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");s.length===6?(n.seconds=j(s[0]),n.minutes=j(s[1]),n.hours=j(s[2]),n.dates=j(s[3]),n.months=j(s[4]),n.dows=j(s[5])):(n.seconds=[0],n.minutes=j(s[0]),n.hours=j(s[1]),n.dates=j(s[2]),n.months=j(s[3]),n.dows=j(s[4]))}return n}function X(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort((v,f)=>v-f),e.length<3)return e.join(",");const c=[];let n=e[0],s=e[0];for(let v=1;v<e.length;v++)e[v]===s+1?s++:(n!==s?n+1===s?c.push(`${n},${s}`):c.push(`${n}-${s}`):c.push(n),n=e[v],s=e[v]);return n!==s?n+1===s?c.push(`${n},${s}`):c.push(`${n}-${s}`):c.push(n),c.join(",")}function G(e){const c=[];return e.seconds&&c.push(X(e.seconds)),c.push(X(e.minutes)),c.push(X(e.hours)),c.push(X(e.dates)),c.push(X(e.months)),c.push(X(e.dows)),c.join(" ")}function ee(e,c){if(c==="cron"){const n=U(e),s=new Date;return s.setHours(n.hours[0]),s.setMinutes(n.minutes[0]),s.setSeconds(n.seconds[0]),Array.isArray(n.dows)&&s.setDate(s.getDate()+n.dows[0]-s.getDay()),s}return c==="date"?new Date(e):null}function W(e,c){if(c==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(c==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const n=e.toISOString();return n.substring(0,n.length-5)}return null}const N={},it=null;function ot(e,c,n){const s={};e.forEach(f=>{var t,b;const C=f.split(".")[1];s[C]=s[C]||[],c[f]&&((b=(t=c[f].common)==null?void 0:t.members)==null||b.forEach(w=>!n.includes(w)&&!s[C].includes(w)&&s[C].push(w)))});let v=[];return Object.keys(s).forEach((f,t)=>{const b=s[f];t?v=v.filter(r=>b.includes(r)):v=b}),v.filter((f,t)=>v.indexOf(f)===t)}function st(e){var c,n,s,v,f,t;if(N[e]){if((c=N[e].common)!=null&&c.icon)return(n=N[e].common)==null?void 0:n.icon;if(N[e].type==="state"||N[e].type==="channel"){let b=e.split(".");b.pop();let r=b.join(".");if(N[r]&&((s=N[r].common)!=null&&s.icon))return(v=N[r].common)==null?void 0:v.icon;if(N[r]&&N[r].type==="channel"&&(b=e.split("."),b.pop(),r=b.join("."),N[r]&&((f=N[r].common)!=null&&f.icon)))return(t=N[r].common)==null?void 0:t.icon}}}function ue(e,c){return Te(this,null,function*(){if(N[e]===void 0){try{N[e]=yield c.getObject(e)}catch(n){}N[e]=N[e]||null}return N[e]})}function rt(e,c){return Te(this,null,function*(){var n,s,v,f,t,b;let r=yield ue(e,c);if(r){if((n=r.common)!=null&&n.icon)return(s=r.common)==null?void 0:s.icon;if(r.type==="state"||r.type==="channel"){let C=e.split(".");C.pop();let w=C.join(".");if(r=yield ue(w,c),r&&((v=r.common)!=null&&v.icon))return(f=r.common)==null?void 0:f.icon;if(r&&r.type==="channel"&&(C=e.split("."),C.pop(),w=C.join("."),r=yield ue(w,c),r&&((t=r.common)!=null&&t.icon)))return(b=r.common)==null?void 0:b.icon}}})}var ke=m(36105),me=m.n(ke),ct=m(63460),dt=m(79117),ut=m(83994),mt=m(28301),vt=m(19867),ft=m(68582),gt=m(37529),ht=m(69850),yt=m(15552),Et=m(97712),Le=m(26733),Be=m(3512),Ze=m(55784),ve=m(59665),i=m(4819),je=Object.defineProperty,We=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Ve=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,Oe=(e,c,n)=>c in e?je(e,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[c]=n,He=(e,c)=>{for(var n in c||(c={}))Ve.call(c,n)&&Oe(e,n,c[n]);if(Ce)for(var n of Ce(c))Ue.call(c,n)&&Oe(e,n,c[n]);return e},Ke=(e,c)=>We(e,Fe(c)),fe=(e,c,n)=>new Promise((s,v)=>{var f=r=>{try{b(n.next(r))}catch(C){v(C)}},t=r=>{try{b(n.throw(r))}catch(C){v(C)}},b=r=>r.done?s(r.value):Promise.resolve(r.value).then(f,t);b((n=n.apply(e,c)).next())});const ze={single:"single_description",double:"double_description",toggle:"toggle_description"},Je={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},_e=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function Ge(e,c){return e&&typeof e=="object"?e[c]||e.en:e}function Ye(e,c){return fe(this,null,function*(){let n;typeof e=="string"?n=yield c.getObject(e):n=e;let s=null;if(n&&n.common&&n.common.icon)s=A.Utils.getObjectIcon(n);else if(n.type==="state"){let v=n._id.split(".");v.pop();let f=v.join(".");n=yield c.getObject(f),n&&n.common&&n.common.icon?s=A.Utils.getObjectIcon(n):(!n||n.type==="channel"||n.type==="device")&&(v=n._id.split("."),v.pop(),f=v.join("."),n=yield c.getObject(f),n&&n.common&&n.common.icon&&(s=A.Utils.getObjectIcon(n)))}return s})}const Se=e=>{var c;const n=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,s=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[v,f]=(0,S.useState)(!1),[t,b]=(0,S.useState)(e.event),[r,C]=(0,S.useState)(null),[w,k]=(0,S.useState)(!1),[$,Z]=(0,S.useState)(n),[H,Y]=(0,S.useState)(s),[z,te]=(0,S.useState)({});me().locale(e.language);const I=(0,S.useCallback)(a=>{const d=JSON.parse(JSON.stringify(t));a(d),b(d)},[t]);(0,S.useEffect)(()=>{const a=new Date;a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0);const d=re().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude);if(te(d),t.native.oid){if(!r||r._id!==t.native.oid)try{e.socket.getObject(t.native.oid).then(y=>{JSON.stringify(t.native.states)!==JSON.stringify(y.common.states)&&I(T=>T.native.states=y.common.states),(r||e.event.native.oid!==t.native.oid)&&Ye(y,e.socket).then(T=>I(O=>O.common.icon=T)),C(y)})}catch(y){console.error(`Cannot get object ${t.native.oid}: ${y}`),C(null)}}else C(null)},[t.native.oid,e.socket,I,t.native.states,r,e.event.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);const R=t.native.cron?U(t.native.cron):null;let L="once";Array.isArray(R==null?void 0:R.months)?L="monthly":Array.isArray(R==null?void 0:R.dows)&&(L="daily");let o;t&&(L==="once"?o=ee(t.native.start,"date",e.serverTimeZone):(L==="monthly"||L==="daily")&&(o=ee(t.native.cron,"cron",e.serverTimeZone)));const l=JSON.stringify(e.event)!==JSON.stringify(t)||$!==n||H!==s,g=(a,d)=>r?r.common.type==="boolean"?(a==="startValue"&&typeof t.native[a]!="boolean"&&setTimeout(()=>I(y=>y.native[a]=!!y.native[a]),100),i.createElement(u.FormControlLabel,{className:e.classes.narrowText2,control:i.createElement(u.Checkbox,{checked:!!t.native[a],disabled:e.readOnly,onChange:y=>I(T=>T.native[a]=y.target.checked)}),label:i.createElement("div",null,i.createElement("div",null,e.t(d)),i.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):r.common.states?i.createElement(u.FormControl,{className:e.classes.narrowText2,variant:"standard"},i.createElement(u.InputLabel,null,e.t(d)),i.createElement(u.Select,{value:t.native[a]||"",disabled:e.readOnly,onChange:y=>I(T=>T.native[a]=y.target.value)},Object.keys(r.common.states).map(y=>i.createElement(u.MenuItem,{key:y,value:y},r.common.states[y])))):i.createElement(u.TextField,{className:e.classes.narrowText2,label:e.t(d),value:t.native[a]||"",disabled:e.readOnly,onChange:y=>I(T=>T.native[a]=y.target.value),variant:"standard"}):null,h=()=>r?r.common.type==="boolean"?(typeof H!="boolean"&&setTimeout(()=>Y(!!H),100),i.createElement(u.FormControlLabel,{className:e.classes.narrowText2,control:i.createElement(u.Checkbox,{checked:!!H,disabled:e.readOnly,onChange:a=>Y(a.target.checked)}),label:i.createElement("div",null,i.createElement("div",null,e.t("End value")),i.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):r.common.states?i.createElement(u.FormControl,{className:e.classes.narrowText2,variant:"standard"},i.createElement(u.InputLabel,null,e.t("End value")),i.createElement(u.Select,{value:H||"",disabled:e.readOnly,onChange:a=>Y(a.target.value)},Object.keys(r.common.states).map(a=>i.createElement(u.MenuItem,{key:a,value:a},r.common.states[a])))):i.createElement(u.TextField,{label:e.t("End value"),value:H||"",disabled:e.readOnly,onChange:a=>Y(a.target.value),variant:"standard",className:e.classes.narrowText2}):null,M=((c=e.systemConfig)==null?void 0:c.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],B=t.native.astro&&z?z[t.native.astro]:"",ce=B?B.toLocaleTimeString().replace(/:\d\d$/,""):"";let ne="";t.native.astro&&t.native.offset&&B&&(ne=new Date(B.getTime()+t.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let F=t.common.icon;return F&&!F.startsWith("data:image")&&!F.startsWith("http")&&!F.startsWith("/")&&(F=`../../${F}`),i.createElement(u.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},i.createElement(u.DialogTitle,null,e.t("Configure event")),i.createElement(u.DialogContent,null,v&&i.createElement(A.SelectID,{imagePrefix:"../..",selected:t.native.oid,disabled:e.readOnly,onOk:a=>{I(d=>d.native.oid=a),f(!1)},onClose:()=>f(!1),socket:e.socket}),i.createElement("div",{className:e.classes.field},i.createElement(u.FormControlLabel,{control:i.createElement(u.Checkbox,{checked:!!(t!=null&&t.common.enabled),disabled:e.readOnly,onChange:a=>I(d=>d.common.enabled=a.target.checked)}),label:e.t("Active")})),i.createElement("div",{className:e.classes.field},i.createElement(u.FormControl,{variant:"standard",className:e.classes.timeType},i.createElement(u.InputLabel,null,e.t("Time type")),i.createElement(u.Select,{value:t.native.astro?"astro":"time",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>{a.target.value==="astro"?d.native.astro="sunrise":delete d.native.astro}),renderValue:a=>e.t(a)},["time","astro"].map(a=>i.createElement(u.MenuItem,{key:a,value:a},i.createElement("div",null,e.t(a)))))),t.native.astro?i.createElement(u.FormControl,{className:e.classes.narrowText,variant:"standard"},i.createElement(u.InputLabel,null,e.t("Astronomic event")),i.createElement(u.Select,{value:t.native.astro||"",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.native.astro=a.target.value),renderValue:a=>e.t(a)},_e.map(a=>i.createElement(u.MenuItem,{key:a,value:a},i.createElement("div",{style:{display:"flex",width:"100%"}},i.createElement("span",null,e.t(a)),i.createElement("span",{style:{flexGrow:1}}),i.createElement("span",null," ","- [",z&&z[a]?z[a].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):i.createElement(Ze._,{dateAdapter:Be.Q},i.createElement(Le.j,{label:e.t("Time"),value:o||null,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>{if(a)try{I(d=>{if(L==="once")d.native.start=W(a.toDate(),"date",e.serverTimeZone);else if(L==="monthly"||L==="daily"){const y=U(d.native.cron),T=W(a.toDate(),"cron",e.serverTimeZone);y.hours=T.hours,y.minutes=T.minutes,d.native.cron=G(y)}})}catch(d){}},renderInput:a=>i.createElement(u.TextField,Ke(He({},a),{variant:"standard",className:e.classes.narrowText,helperText:o.getSeconds()?o.toLocaleTimeString():""})),ampm:!1})),t.native.astro?i.createElement(u.FormControl,{variant:"standard",className:e.classes.width60},i.createElement(u.InputLabel,null,e.t("Offset")),i.createElement(u.Select,{value:t.native.offset||0,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.native.offset=a.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(a=>i.createElement(u.MenuItem,{key:a.value,value:a.value},a.value<0?`- ${e.t(a.label)}`:e.t(a.label))))):null,e.isSimulation&&i.createElement(u.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:t.native.timeRandomOffset||0,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.native.timeRandomOffset=parseInt(a.target.value)),variant:"standard",InputProps:{endAdornment:i.createElement(u.InputAdornment,{position:"end"},e.t("ms"))}})),t.native.astro?i.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(t.native.astro),ce),"\xA0",t.native.offset?e.t("With offset at %s.",ne):null):null,i.createElement("div",{className:e.classes.field},!e.isSimulation&&i.createElement(u.FormControl,{variant:"standard",className:e.classes.narrowText2},i.createElement(u.InputLabel,null,e.t("Event type")),i.createElement(u.Select,{value:t.native.type||"",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>{d.common.name===e.t(d.native.type)&&(d.common.name=e.t(a.target.value)),d.native.type=a.target.value}),renderValue:a=>e.t(a)},["single","double","toggle"].map(a=>i.createElement(u.MenuItem,{key:a,value:a},i.createElement("div",null,i.createElement("div",null,e.t(a)),i.createElement("div",{className:e.classes.typeDescription},e.t(ze[a]))))))),t.native.type!=="single"&&i.createElement(u.TextField,{label:e.t("Duration"),value:$,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>Z(a.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:i.createElement(u.InputAdornment,{position:"end"},e.t("minutes"))}})),i.createElement("div",{className:e.classes.field},i.createElement("div",{className:e.classes.selectId},i.createElement(A.Icon,{src:F||"",style:{width:32,height:32}}),i.createElement(u.TextField,{label:"Object ID",value:t.native.oid||"",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.native.oid=a.target.value),variant:"standard",helperText:Ge((r==null?void 0:r.common.name)||"",e.language),fullWidth:!0}),i.createElement(u.Button,{onClick:()=>f(!0)},"..."))),i.createElement("div",{className:e.classes.field},g("startValue",t.native.type==="toggle"?"First value":t.native.type==="single"?"Desired value":"Start value"),t.native.type==="double"&&h()),i.createElement("div",{className:e.classes.field},!e.isSimulation&&i.createElement(u.FormControl,{variant:"standard"},i.createElement(u.InputLabel,null,e.t("Period")),i.createElement(u.Select,{value:L||"once",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>{a.target.value!==t.native.cron&&I(d=>{if(a.target.value==="once")delete d.native.cron,d.native.start=W(o,"date",e.serverTimeZone);else if(a.target.value==="daily"){delete d.native.start;const y=U("0 0 ? * 0-6"),T=W(o,"cron",e.serverTimeZone);y.hours=T.hours,y.minutes=T.minutes,d.native.cron=G(y)}else if(a.target.value==="monthly"){delete d.native.start;const y=U("0 0 * 1-12 *"),T=W(o,"cron",e.serverTimeZone);y.hours=T.hours,y.minutes=T.minutes,d.native.cron=G(y)}})}},["once","daily","monthly"].map(a=>i.createElement(u.MenuItem,{key:a,value:a},e.t(a))))),L==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&i.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},i.createElement("thead",null,i.createElement("tr",null,M.map(a=>i.createElement("td",{key:a,className:e.classes.tableCell},me()().day(a).format("ddd"))))),i.createElement("tbody",null,i.createElement("tr",null,M.map(a=>{var d;return i.createElement("td",{key:a},i.createElement(u.Checkbox,{checked:((d=R==null?void 0:R.dows)==null?void 0:d.includes(a))||!1,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:y=>{I(T=>{const O=U(T.native.cron);y.target.checked?O.dows.push(a):O.dows=O.dows.filter(x=>x!==a),T.native.cron=G(O)})},size:"small"}))}))))),L==="monthly"&&i.createElement("div",{className:e.classes.field},i.createElement("table",null,i.createElement("thead",null,i.createElement("tr",null,new Array(12).fill(null).map((a,d)=>i.createElement("td",{key:d,className:e.classes.tableCell},me()().month(d).format("MMM"))))),i.createElement("tbody",null,i.createElement("tr",null,new Array(12).fill(null).map((a,d)=>{var y;return i.createElement("td",{key:d},i.createElement(u.Checkbox,{checked:((y=R==null?void 0:R.months)==null?void 0:y.includes(d+1))||!1,disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:T=>{I(O=>{const x=U(O.native.cron);T.target.checked?x.months.push(d+1):x.months=x.months.filter(he=>he!==d+1),O.native.cron=G(x)})},size:"small"}))}))))),i.createElement("div",{className:e.classes.field},i.createElement(u.TextField,{label:"Description",value:(t==null?void 0:t.common.name)||"",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.common.name=a.target.value),variant:"standard",fullWidth:!0})),i.createElement("div",{className:e.classes.narrowColor},i.createElement(A.ColorPicker,{value:t.common.color||t.native.color||"",disabled:e.readOnly||!(t!=null&&t.common.enabled),onChange:a=>I(d=>d.common.color=a),name:e.t("Color")}))),i.createElement(u.DialogActions,null,e.readOnly?null:i.createElement(u.Button,{variant:"contained",color:"secondary",startIcon:i.createElement(ve.Delete,null),onClick:()=>k(!0)},e.t("Delete")),!e.readOnly&&!e.widget?i.createElement("div",{style:{flex:1}}):null,e.readOnly?null:i.createElement(u.Button,{variant:"contained",color:"primary",disabled:!l,startIcon:i.createElement(ve.Save,null),onClick:()=>fe(void 0,null,function*(){t.native.type==="single"?t.native.intervals&&delete t.native.intervals:t.native.type==="double"?(t.native.intervals=t.native.intervals||[],t.native.intervals[0]=t.native.intervals[0]||{},t.native.intervals[0].timeOffset=(parseFloat($)||1)*6e4,t.native.intervals[0].value=H):t.native.type==="toggle"&&(t.native.intervals=t.native.intervals||[],t.native.intervals[0]=t.native.intervals[0]||{},t.native.intervals[0].timeOffset=(parseFloat($)||1)*6e4),yield e.setEvent(t._id,t),e.updateEvents(),e.onClose()})},e.t("Save")),i.createElement(u.Button,{variant:"contained",color:"grey",startIcon:i.createElement(ve.Cancel,null),onClick:e.onClose},e.readOnly||!l?e.t("ra_Close"):e.t("ra_Cancel"))),w&&i.createElement(A.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:a=>fe(void 0,null,function*(){if(a){try{yield e.deleteEvent(t._id),e.updateEvents()}catch(d){window.alert(`Cannot delete event: ${d}`)}e.onClose()}k(!1)})}))};Se.propTypes={systemConfig:E().object,classes:E().object.isRequired,socket:E().object.isRequired,onClose:E().func.isRequired,event:E().object,readOnly:E().bool,updateEvents:E().func.isRequired,serverTimeZone:E().number.isRequired,t:E().func.isRequired,language:E().string.isRequired,widget:E().bool,setEvent:E().func.isRequired,deleteEvent:E().func.isRequired};var Qe=(0,_.withStyles)(Je)(Se),D=m(4819),ge=(e,c,n)=>new Promise((s,v)=>{var f=r=>{try{b(n.next(r))}catch(C){v(C)}},t=r=>{try{b(n.throw(r))}catch(C){v(C)}},b=r=>r.done?s(r.value):Promise.resolve(r.value).then(f,t);b((n=n.apply(e,c)).next())});const Xe=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],qe=[1,2,3,5,10,15,20,30,60],pe=({type:e,t:c,color:n})=>{const s=(0,S.useRef)(null);return(0,S.useEffect)(()=>{const v=new p._l(s.current,{eventData:()=>({id:e.type,title:c(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{v.destroy()}},[]),D.createElement("div",{style:{backgroundColor:n||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:s},c(e.name))},et=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function De(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function tt(e){const c=e.getBoundingClientRect(),n=e.getElementsByClassName("fc-timegrid-slot");for(let s=0;s<n.length;s++)if(n[s].getBoundingClientRect().top>c.top+100)return n[s].dataset.time;return null}function nt(e){return e.date.second?`${e.date.hour}:${e.date.minute.toString().padStart(2,"0")}:${e.date.second.toString().padStart(2,"0")}`:`${e.date.hour}:${e.date.minute.toString().padStart(2,"0")}`}function Ie(e){var c,n;const[s,v]=(0,S.useState)(null),[f,t]=(0,S.useState)(e.dayStep||parseInt(window.localStorage.getItem("calendarStep"),10)||30),b=e.storageName||"calendar",r=(0,S.useRef)(null),C=(0,S.useRef)(null),w=(0,S.useRef)(null),k=(0,S.useRef)(null),$=(0,S.useRef)(null),[Z,H]=(0,S.useState)({start:null,end:null});let Y=(!e.widget&&window.localStorage.getItem(`${b}Start`),new Date),z=e.viewMode||window.localStorage.getItem(`${b}View`)||"dayGridMonth";e.isSimulation&&(Y=new Date,z=((c=e.simulation)==null?void 0:c.native.interval)==="day"?"timeGridDay":"timeGridWeek");let te=Xe;e.isSimulation&&(te=te.filter(o=>o.type==="single"));const I=(0,S.useMemo)(()=>{const o=[];return e.events.forEach(l=>{var g,h,M,B,ce,ne,F;if(!l)return;const a=(g=l.native)!=null&&g.intervals&&l.native.intervals[0]&&l.native.intervals[0].timeOffset?l.native.intervals[0].timeOffset:30;l.common.color=l.common.color||"#3a87b2";const d=l.common.enabled?l.common.color:De(l.common.color);let y=A.Utils.invertColor(l.common.color,!0);l.common.enabled||(y=De(y));let T=l.common.name;if(l.native.oid){let O=l.native.startValue;typeof O=="boolean"?O=O?A.I18n.t("ON"):A.I18n.t("OFF"):l.native.states&&l.native.states[O]&&(O=l.native.states[O]);let x=(M=(h=l.native.intervals)==null?void 0:h[0])==null?void 0:M.value;typeof x=="boolean"?x=x?A.I18n.t("ON"):A.I18n.t("OFF"):l.native.states&&l.native.states[x]&&(x=l.native.states[x]),T=`${l.common.name} \u2192 ${O}`,l.native.type==="double"&&(T+=` \u2192 ${(((ce=(B=l.native.intervals)==null?void 0:B[0])==null?void 0:ce.timeOffset)||0)/1e3/60} ${A.I18n.t("min")}. \u2192 ${x}`),l.native.type==="toggle"&&(T+=` \u2192 ${(((F=(ne=l.native.intervals)==null?void 0:ne[0])==null?void 0:F.timeOffset)||0)/1e3/60} ${A.I18n.t("min")}. \u2192 ${A.I18n.t("initial")}`)}if(l.native.cron){const O=ee(l.native.cron,"cron",e.serverTimeZone),x=U(l.native.cron);O.setFullYear(new Date().getFullYear()-1),Array.isArray(x.months)?new se.Ci({dtstart:O,until:Z.end||new Date,freq:se.Ci.WEEKLY,bymonth:x.months}).between(Z.start||new Date,Z.end||new Date).forEach(J=>{const K=l.native.astro?re().getTimes(J,e.systemConfig.latitude,e.systemConfig.longitude)[l.native.astro]:J;l.native.astro&&l.native.offset&&K.setMinutes(K.getMinutes()+l.native.offset),o.push({extendedProps:{eventId:l._id,icon:l.common.icon,type:l.native.type,seconds:K.getSeconds()},title:T,backgroundColor:d,textColor:y,start:K,allDay:!1,display:"block"})}):Array.isArray(x.dows)?new se.Ci({dtstart:O,until:Z.end||new Date,freq:se.Ci.WEEKLY,byweekday:x.dows.map(J=>J===0?6:J-1)}).between(Z.start||new Date,Z.end||new Date).forEach(J=>{const K=l.native.astro?re().getTimes(J,e.systemConfig.latitude,e.systemConfig.longitude)[l.native.astro]:J;l.native.astro&&l.native.offset&&K.setMinutes(K.getMinutes()+l.native.offset),o.push({extendedProps:{eventId:l._id,icon:l.common.icon,type:l.native.type,seconds:K.getSeconds()},title:T,backgroundColor:d,textColor:y,start:K,allDay:!1,display:"block"})}):o.push({extendedProps:{eventId:l._id,icon:l.common.icon,type:l.native.type,seconds:0},title:T,backgroundColor:d,textColor:y,icon:l.common.icon})}else{const O=l.native.astro?re().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[l.native.astro]:l.native.start;l.native.astro&&l.native.offset&&O.setMinutes(O.getMinutes()+l.native.offset),o.push({extendedProps:{eventId:l._id,icon:l.common.icon,type:l.native.type,seconds:0},title:T,display:"block",backgroundColor:d,textColor:y,start:ee(O,"date",e.serverTimeZone),end:ee(new Date(new Date(O).getTime()+a),"date",e.serverTimeZone)})}}),o},[e.events,e.serverTimeZone,e.systemConfig.latitude,e.systemConfig.longitude,Z.end,Z.start]);if((0,S.useEffect)(()=>{if(e.widget){const o=()=>{var l;const g=(l=r.current)==null?void 0:l.getApi();g&&(console.log("Scroll to now"),g.scrollToTime(new Date().getTime())),w.current?k.current=null:k.current=setTimeout(()=>o,3e5)};setTimeout(o,1e3)}return()=>{k.current&&clearTimeout(k.current),k.current=null,w.current&&clearTimeout(w.current),w.current=null}},[]),(0,S.useEffect)(()=>{$.current=null,setTimeout(()=>{var o;const l=new Date;(o=r.current)==null||o.getApi().scrollToTime(`${l.getHours().toString().padStart(2,"0")}:${(f>l.getMinutes()?0:l.getMinutes()-f).toString().padStart(2,"0")}:00`)},300)},[e.calendarPrefix,e.simulationId,f]),(0,S.useEffect)(()=>{var o,l;if(e.isSimulation){const g=(o=r.current)==null?void 0:o.getApi();g==null||g.changeView(((l=e.simulation)==null?void 0:l.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.isSimulation,(n=e.simulation)==null?void 0:n.native.interval]),e.isSimulation&&!e.simulation)return null;const R=$.current?void 0:new Date,L=R?`${R.getHours().toString().padStart(2,"0")}:${(f>R.getMinutes()?0:R.getMinutes()-f).toString().padStart(2,"0")}:00`:void 0;return console.log(`SCROLL TIME: ${L}`),D.createElement(D.Fragment,null,D.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),s?D.createElement(Qe,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(o=>o._id===s),onClose:()=>{v(null);const o=$.current?new Date($.current):new Date,l=`${R.getHours().toString().padStart(2,"0")}:${(f>R.getMinutes()?0:o.getMinutes()-f).toString().padStart(2,"0")}:00`;setTimeout(()=>{var g;return(g=r.current)==null?void 0:g.getApi().scrollToTime(l)},200)},socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,D.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&D.createElement("div",{className:e.classes.leftBlock},D.createElement(u.Paper,{elevation:4,className:e.classes.leftPaper},D.createElement("div",{className:e.classes.leftContent},D.createElement("h4",null,e.t("Events")),te.map((o,l)=>{var g,h;return D.createElement(pe,{t:e.t,type:o,name:e.t(o.name),key:o.type,index:l,color:e.isSimulation?(h=(g=e.simulation)==null?void 0:g.common)==null?void 0:h.color:void 0})}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Use double click on calendar to add new events.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement(u.FormControl,{fullWidth:!0,variant:"standard"},D.createElement(u.InputLabel,null,e.t("Zoom")),D.createElement(u.Select,{value:f,onChange:o=>{var l,g;if((g=(l=r.current)==null?void 0:l.elRef)!=null&&g.current){const h=tt(r.current.elRef.current);h&&setTimeout(()=>{var M;return(M=r.current)==null?void 0:M.getApi().scrollToTime(h)},300)}window.localStorage.setItem("calendarStep",o.target.value.toString()),t(o.target.value)}},qe.map(o=>D.createElement(u.MenuItem,{key:o,value:o},o,e.t("min"))))))),e.button),D.createElement("div",{className:e.classes.calendarBlock},D.createElement("div",{className:e.classes.calendar},D.createElement(ye.Z,{ref:r,plugins:[le.Z,ae.Z,Ee.Z,p.ZP,be.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},eventTimeFormat:e.isSimulation?nt:void 0,slotDuration:`00:${f.toString().padStart(2,"0")}:00`,eventMinHeight:20,initialView:z,initialDate:Y,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,defaultTimedEventDuration:`00:${f.toString().padStart(2,"0")}`,events:I,height:"calc(100% - 20px)",locales:[Q.Z,xe.Z,P.Z,ie.Z,oe.Z,Ne.Z,Me.Z,Pe.Z,Ae.Z,$e.Z],locale:e.language,datesSet:o=>{var l,g;(o.start.toString()!==((l=Z.start)==null?void 0:l.toString())||o.end.toString()!==((g=Z.end)==null?void 0:g.toString()))&&($.current=null,H({start:o.start,end:o.end})),e.widget?(k.current&&clearTimeout(k.current),k.current=null,w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{w.current=null;const h=()=>{var M;const B=(M=r.current)==null?void 0:M.getApi();B==null||B.scrollToTime(new Date().getTime()),w.current?k.current=null:k.current=setTimeout(()=>h,1e3*60*5)};h()},6e4)):window.localStorage.setItem(`${b}View`,o.view.type)},eventClick:o=>{$.current=new Date(o.event.start).getTime(),v(o.event.extendedProps.eventId)},eventResize:o=>{var l;$.current=new Date(o.event.start).getTime();const g=e.events.find(h=>h._id===o.event.extendedProps.eventId);if((l=g.native.intervals)!=null&&l[0].timeOffset){const h=JSON.parse(JSON.stringify(g));h.native.intervals[0].timeOffset+=o.endDelta.milliseconds,e.setEvent(h._id,h),e.updateEvents()}else o.revert()},eventDrop:o=>ge(this,null,function*(){var l;$.current=new Date(o.event.start).getTime();const g=e.events.find(h=>h._id===o.event.extendedProps.eventId);if((l=g==null?void 0:g.native)!=null&&l.cron){const h=JSON.parse(JSON.stringify(g));o.jsEvent.altKey&&(h._id=`${e.calendarPrefix||e.simulationId}.event-${(0,V.Z)()}`);const M=U(h.native.cron),B=W(o.event.start,"cron",e.serverTimeZone);M.hours=B.hours,M.minutes=B.minutes,h.native.cron=G(M),yield e.setEvent(h._id,h),e.updateEvents()}else{const h=JSON.parse(JSON.stringify(g));o.jsEvent.altKey&&(h._id=`${e.calendarPrefix||e.simulationId}.event-${(0,V.Z)()}`),h.native.start=W(o.event.start,"date",e.serverTimeZone),yield e.setEvent(h._id,h),e.updateEvents()}}),eventReceive:o=>ge(this,null,function*(){const l={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,V.Z)()}`,common:{name:o.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:W(o.event.start,"date",e.serverTimeZone),type:o.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(o.event.extendedProps.type!=="single"&&(l.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){l.common.color=e.simulation.common.color||l.common.color,delete l.native.start;const g=W(o.event.start,"cron",e.serverTimeZone);g.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[o.event.start.getDay()],g.dates=["?"],g.months=["*"],l.native.cron=G(g),l.native.record={states:[],enums:[],start:null,end:null}}$.current=new Date(o.event.start).getTime(),yield e.setEvent(l._id,l),e.updateEvents(),setTimeout(()=>v(l._id),100)}),eventDidMount:o=>{let l=o.event.extendedProps.icon;if(l){const g=window.document.createElement("img");!l.startsWith("data:image")&&!l.startsWith("http")&&!l.startsWith("/")&&(l=`../../${l}`),g.setAttribute("src",l),g.className="icon",g.style.width="20px",g.style.height="20px";const h=o.el.getElementsByClassName("fc-event-title-container");if(h.length){h[0].prepend(g);const M=h[0].getElementsByClassName("fc-event-title");M.length&&(M[0].style.marginLeft="23px")}}},select:o=>ge(this,null,function*(){if(o.view.calendar.unselect(),e.readOnly)return;const g=o.end.getTime()-o.start.getTime();if((!C.current||Date.now()-C.current>500)&&g===30*60*1e3){C.current=Date.now();return}const h={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,V.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:W(o.date||o.start,"date",e.serverTimeZone),intervals:o.end&&!e.isSimulation?[{value:"",timeOffset:o.end.getTime()-o.start.getTime()}]:void 0,type:o.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(h.common.color=e.simulation.common.color||h.common.color),$.current=new Date(h.native.start).getTime(),yield e.setEvent(h._id,h),yield e.updateEvents(),setTimeout(()=>v(h._id),100)})})))))}Ie.propTypes={events:E().array,serverTimeZone:E().number,systemConfig:E().object,theme:E().object,socket:E().object,readOnly:E().bool,hideLeftBlock:E().bool,hideTopBlock:E().bool,hideLeftBlockHint:E().bool,hideTopBlockButtons:E().bool,hideWeekends:E().bool,viewMode:E().bool,updateEvents:E().func,t:E().func.isRequired,widget:E().bool,language:E().string.isRequired,storageName:E().string,calendarPrefix:E().string,isSimulation:E().bool,simulationId:E().string,setEvent:E().func,button:E().any,dayStep:E().number};var at=(0,_.withTheme)((0,_.withStyles)(et)(Ie))},82809:function(we,de,m){var S=m(4819),q=m.n(S),E=m(15854),V=m.n(E),_=m(94427),ye=m.n(_),ae=m(75606),Ee=m.n(ae),p=m(88411),be=m.n(p);const le=window.visRxWidget||p.VisRxWidget;class Q extends q().Component{constructor(P){super(P),this.state={list:[{value:"",label:le.t("default")}]}}static getText(P){return typeof P=="object"?P[ae.I18n.getLanguage()]||P.en:P}componentDidMount(){this.props.instance&&this.props.socket.getObjectViewSystem("folder",`fullcalendar.${this.props.instance}.Calendars.`,`fullcalendar.${this.props.instance}.Calendars.\u9999`).then(P=>{const ie=Object.keys(P).map(oe=>({value:oe,label:Q.getText(P[oe].common.name)}));ie.unshift({value:"",label:le.t("default")}),this.setState({list:ie})})}render(){return q().createElement(_.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:P=>this.props.onChange(P.target.value)},this.state.list.map(P=>q().createElement(_.MenuItem,{key:P.value},P.label)))}}Q.propTypes={value:V().string,socket:V().object,onChange:V().func,instance:V().number},de.Z=Q}}]);

//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.5fe938a1.chunk.js.map