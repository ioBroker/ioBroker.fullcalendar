"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1"],{83178:function(Je,le,c){c.d(le,{Z:function(){return ze}});var O=c(4819),ie=c(15854),g=c.n(ie),M=c(10651),K=c(58503),re=c(76516),se=c(40387),oe=c(24990),X=c(44251),de=c(33634),ce=c(51172),ue=c(25177),me=c(33841),ve=c(49582),fe=c(36513),ge=c(4302),ye=c(43007),he=c(43223),Ee=c(96933),Ce=c(93484),be=c(80809),d=c(94427),x=c(75606),J=c(14853),Te=c(98667),q=c.n(Te);function Oe(e,r){return e-r}function N(e){if(e==="*"||e==="?"||e==="")return e;const r=e.split(","),l=[];for(let o=0;o<r.length;o++){const E=r[o].match(/(\d+)-(\d+)/);if(E)for(let D=parseInt(E[1],10);D<=parseInt(E[2],10);D++)l.push(D);else l.push(parseInt(r[o],10))}return l}function P(e,r){const l={};if(r){const o=r.split(/\D/);l.seconds=[parseInt(o[5],10)],l.minutes=[parseInt(o[4],10)],l.hours=[parseInt(o[3],10)],l.dates=[parseInt(o[2],10)],l.months=[parseInt(o[1],10)],l.dows="?"}else{const o=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");o.length===6?(l.seconds=N(o[0]),l.minutes=N(o[1]),l.hours=N(o[2]),l.dates=N(o[3]),l.months=N(o[4]),l.dows=N(o[5])):(l.seconds=[0],l.minutes=N(o[0]),l.hours=N(o[1]),l.dates=N(o[2]),l.months=N(o[3]),l.dows=N(o[4]))}return l}function R(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(Oe),e.length<3)return e.join(",");const r=[];let l=e[0],o=e[0];for(let E=1;E<e.length;E++)e[E]===o+1?o++:(l!==o?l+1===o?r.push(`${l},${o}`):r.push(`${l}-${o}`):r.push(l),l=e[E],o=e[E]);return l!==o?l+1===o?r.push(`${l},${o}`):r.push(`${l}-${o}`):r.push(l),r.join(",")}function F(e){const r=["*","*","*","*","?"];return e.seconds&&(r[0]=R(e.seconds)),r[0]=R(e.minutes),r[1]=R(e.hours),r[2]=R(e.dates),r[3]=R(e.months),r[4]=R(e.dows),r.join(" ")}function V(e,r){if(r==="cron"){const l=P(e),o=new Date;return o.setHours(l.hours[0],l.minutes[0]),Array.isArray(l.dows)&&o.setDate(o.getDate()+l.dows[0]-o.getDay()),o}return r==="date"?new Date(e):null}function Z(e,r){if(r==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(r==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const l=e.toISOString();return l.substring(0,l.length-5)}return null}var Y=c(59665),De=c(96148),we=c(55784),Se=c(37218),xe=c(36105),Q=c.n(xe),Ge=c(63460),He=c(79117),Ke=c(83994),Ye=c(28301),Qe=c(19867),Ue=c(68582),Xe=c(37529),qe=c(69850),_e=c(15552),pe=c(97712),a=c(4819),Ie=Object.defineProperty,Ne=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,p=(e,r,l)=>r in e?Ie(e,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[r]=l,$e=(e,r)=>{for(var l in r||(r={}))Ze.call(r,l)&&p(e,l,r[l]);if(_)for(var l of _(r))Pe.call(r,l)&&p(e,l,r[l]);return e},Ae=(e,r)=>Ne(e,ke(r)),ee=(e,r,l)=>new Promise((o,E)=>{var D=f=>{try{C(l.next(f))}catch(I){E(I)}},i=f=>{try{C(l.throw(f))}catch(I){E(I)}},C=f=>f.done?o(f.value):Promise.resolve(f.value).then(D,i);C((l=l.apply(e,r)).next())});const Fe={single:"single_description",double:"double_description",toggle:"toggle_description"},je={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex"},narrowText:{width:140,marginLeft:8},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16}},Be=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function Re(e,r){return e&&typeof e=="object"?e[r]||e.en:e}const te=e=>{var r;const l=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,o=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[E,D]=(0,O.useState)(!1),[i,C]=(0,O.useState)(e.event),[f,I]=(0,O.useState)(null),[G,W]=(0,O.useState)(!1),[A,j]=(0,O.useState)(l),[n,y]=(0,O.useState)(o);Q().locale(e.language),(0,O.useEffect)(()=>{i.native.oid?e.socket.getObject(i.native.oid).then(t=>I(t)).catch(t=>{console.error(`Cannot get object ${i.native.oid}: ${t}`),I(null)}):I(null)},[i.native.oid,e.socket]);const u=i.native.cron?P(i.native.cron):null;let m="once";Array.isArray(u==null?void 0:u.months)?m="monthly":Array.isArray(u==null?void 0:u.dows)&&(m="daily");let w;i&&(m==="once"?w=V(i.native.start,"date",e.serverTimeZone):(m==="monthly"||m==="daily")&&(w=V(i.native.cron,"cron",e.serverTimeZone)));const k=JSON.stringify(e.event)!==JSON.stringify(i)||A!==l||n!==o,b=t=>{const s=JSON.parse(JSON.stringify(i));t(s),C(s)},H=(t,s)=>f?f.common.type==="boolean"?(t==="startValue"&&typeof i.native[t]!="boolean"&&setTimeout(()=>b(v=>v.native[t]=!!v.native[t]),100),a.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(d.Checkbox,{checked:!!i.native[t],disabled:e.readOnly,onChange:v=>b(h=>h.native[t]=v.target.checked)}),label:e.t(s)})):f.common.states?a.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(d.InputLabel,null,e.t(s)),a.createElement(d.Select,{value:i.native[t]||"",disabled:e.readOnly,onChange:v=>b(h=>h.native[t]=v.target.value)},Object.keys(f.common.states).map(v=>a.createElement(d.MenuItem,{key:v,value:v},f.common.states[v])))):a.createElement(d.TextField,{className:e.classes.narrowText2,label:e.t(s),value:i.native[t]||"",disabled:e.readOnly,onChange:v=>b(h=>h.native[t]=v.target.value),variant:"standard"}):null,L=()=>f?f.common.type==="boolean"?(typeof n!="boolean"&&setTimeout(()=>y(!!n),100),a.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(d.Checkbox,{checked:!!n,disabled:e.readOnly,onChange:t=>y(t.target.checked)}),label:e.t("End value")})):f.common.states?a.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(d.InputLabel,null,e.t("End value")),a.createElement(d.Select,{value:n||"",disabled:e.readOnly,onChange:t=>y(t.target.value)},Object.keys(f.common.states).map(t=>a.createElement(d.MenuItem,{key:t,value:t},f.common.states[t])))):a.createElement(d.TextField,{label:e.t("End value"),value:n||"",disabled:e.readOnly,onChange:t=>y(t.target.value),variant:"standard",className:e.classes.narrowText2}):null,B=((r=e.systemConfig)==null?void 0:r.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6];return a.createElement(d.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},a.createElement(d.DialogTitle,null,e.t("Configure event")),a.createElement(d.DialogContent,null,E&&a.createElement(x.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:t=>{b(s=>s.native.oid=t),D(!1)},onClose:()=>D(!1),socket:e.socket}),a.createElement("div",{className:e.classes.field},a.createElement(d.FormControlLabel,{control:a.createElement(d.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:t=>b(s=>s.common.enabled=t.target.checked)}),label:e.t("Active")})),a.createElement("div",{className:e.classes.field},a.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},a.createElement(d.InputLabel,null,e.t("Time")),a.createElement(d.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:t=>b(s=>{t.target.value==="astro"?s.native.astro="sunrise":delete s.native.astro}),renderValue:t=>e.t(t)},["time","astro"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},a.createElement("div",null,e.t(t)))))),i.native.astro?a.createElement(d.FormControl,{className:e.classes.narrowText,variant:"standard"},a.createElement(d.InputLabel,null,x.I18n.t("Astronomic event")),a.createElement(d.Select,{value:i.native.astro||"",onChange:t=>b(s=>s.native.astro=t.target.value)},Be.map(t=>a.createElement(d.MenuItem,{key:t,value:t},x.I18n.t(t))))):a.createElement(we._,{dateAdapter:De.Q},a.createElement(Se.j,{label:e.t("Time"),value:w||null,disabled:e.readOnly,onChange:t=>{if(t)try{b(s=>{if(m==="once")s.native.start=Z(t.toDate(),"date",e.serverTimeZone);else if(m==="monthly"||m==="daily"){const v=P(s.native.cron),h=Z(t.toDate(),"cron",e.serverTimeZone);v.hours=h.hours,v.minutes=h.minutes,s.native.cron=F(v)}})}catch(s){}},renderInput:t=>a.createElement(d.TextField,Ae($e({},t),{variant:"standard",className:e.classes.narrowText})),ampm:!1})),e.isSimulation&&a.createElement(d.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:t=>b(s=>s.native.timeRandomOffset=parseInt(t.target.value)),variant:"standard",InputProps:{endAdornment:a.createElement(d.InputAdornment,{position:"end"},e.t("ms"))}})),a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},a.createElement(d.InputLabel,null,e.t("Event type")),a.createElement(d.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:t=>b(s=>s.native.type=t.target.value),renderValue:t=>e.t(t)},["single","double","toggle"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},a.createElement("div",null,a.createElement("div",null,e.t(t)),a.createElement("div",{className:e.classes.typeDescription},e.t(Fe[t]))))))),i.native.type!=="single"&&a.createElement(d.TextField,{label:e.t("Duration"),value:A,disabled:e.readOnly,onChange:t=>j(t.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:a.createElement(d.InputAdornment,{position:"end"},e.t("minutes"))}})),a.createElement("div",{className:e.classes.field},a.createElement("div",{className:e.classes.selectId},a.createElement(d.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:t=>b(s=>s.native.oid=t.target.value),variant:"standard",helperText:Re((f==null?void 0:f.common.name)||"",e.language),fullWidth:!0}),a.createElement(d.Button,{onClick:()=>D(!0)},"..."))),a.createElement("div",{className:e.classes.field},H("startValue",i.native.type==="toggle"?"First value":"Start value"),i.native.type==="double"&&L()),a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(d.FormControl,{variant:"standard"},a.createElement(d.InputLabel,null,e.t("Period")),a.createElement(d.Select,{value:m||"once",disabled:e.readOnly,onChange:t=>{t.target.value!==i.native.cron&&b(s=>{if(t.target.value==="once")delete s.native.cron,s.native.start=Z(w,"date",e.serverTimeZone);else if(t.target.value==="daily"){delete s.native.start;const v=P("0 0 ? * 0-6"),h=Z(w,"cron",e.serverTimeZone);v.hours=h.hours,v.minutes=h.minutes,s.native.cron=F(v)}else if(t.target.value==="monthly"){delete s.native.start;const v=P("0 0 ? 1-12 ?"),h=Z(w,"cron",e.serverTimeZone);v.hours=h.hours,v.minutes=h.minutes,s.native.cron=F(v)}})}},["once","daily","monthly"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},e.t(t))))),m==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&a.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},a.createElement("thead",null,a.createElement("tr",null,B.map(t=>a.createElement("td",{key:t,className:e.classes.tableCell},Q()().day(t).format("ddd"))))),a.createElement("tbody",null,a.createElement("tr",null,B.map(t=>{var s;return a.createElement("td",{key:t},a.createElement(d.Checkbox,{checked:((s=u==null?void 0:u.dows)==null?void 0:s.includes(t))||!1,disabled:e.readOnly,onChange:v=>{b(h=>{const $=P(h.native.cron);v.target.checked?$.dows.push(t):$.dows=$.dows.filter(S=>S!==t),h.native.cron=F($)})},size:"small"}))}))))),m==="monthly"&&a.createElement("div",{className:e.classes.field},a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,new Array(12).fill(null).map((t,s)=>a.createElement("td",{key:s,className:e.classes.tableCell},Q()().month(s).format("MMM"))))),a.createElement("tbody",null,a.createElement("tr",null,new Array(12).fill(null).map((t,s)=>{var v;return a.createElement("td",{key:s},a.createElement(d.Checkbox,{checked:((v=u==null?void 0:u.months)==null?void 0:v.includes(s+1))||!1,disabled:e.readOnly,onChange:h=>{b($=>{const S=P($.native.cron);h.target.checked?S.months.push(s+1):S.months=S.months.filter(z=>z!==s+1),$.native.cron=F(S)})},size:"small"}))}))))),a.createElement("div",{className:e.classes.field},a.createElement(d.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:t=>b(s=>s.common.name=t.target.value),variant:"standard",fullWidth:!0})),a.createElement("div",{className:e.classes.narrowColor},a.createElement(x.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:t=>b(s=>s.common.color=t),name:e.t("Color")}))),a.createElement(d.DialogActions,null,e.readOnly?null:a.createElement(d.Button,{variant:"contained",color:"secondary",startIcon:a.createElement(Y.Delete,null),onClick:()=>W(!0)},e.t("Delete")),!e.readOnly&&!e.widget?a.createElement("div",{style:{flex:1}}):null,e.readOnly?null:a.createElement(d.Button,{variant:"contained",color:"primary",disabled:!k,startIcon:a.createElement(Y.Save,null),onClick:()=>ee(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(A)||1)*6e4,i.native.intervals[0].value=n):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(A)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),a.createElement(d.Button,{variant:"contained",color:"grey",startIcon:a.createElement(Y.Cancel,null),onClick:e.onClose},e.readOnly||!k?e.t("ra_Close"):e.t("ra_Cancel"))),G&&a.createElement(x.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:x.I18n.t("Delete"),onClose:t=>ee(void 0,null,function*(){if(t){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(s){window.alert(`Cannot delete event: ${s}`)}e.onClose()}W(!1)})}))};te.propTypes={systemConfig:g().object,classes:g().object.isRequired,socket:g().object.isRequired,onClose:g().func.isRequired,event:g().object,readOnly:g().bool,updateEvents:g().func.isRequired,serverTimeZone:g().number.isRequired,t:g().func.isRequired,language:g().string.isRequired,widget:g().bool,setEvent:g().func.isRequired,deleteEvent:g().func.isRequired};var Le=(0,K.withStyles)(je)(te),T=c(4819),U=(e,r,l)=>new Promise((o,E)=>{var D=f=>{try{C(l.next(f))}catch(I){E(I)}},i=f=>{try{C(l.throw(f))}catch(I){E(I)}},C=f=>f.done?o(f.value):Promise.resolve(f.value).then(D,i);C((l=l.apply(e,r)).next())});const Me=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ve=({type:e,t:r,color:l})=>{const o=(0,O.useRef)(null);return(0,O.useEffect)(()=>{const E=new X._l(o.current,{eventData:()=>({id:e.type,title:r(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{E.destroy()}},[]),T.createElement("div",{style:{backgroundColor:l||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:o},r(e.name))},We=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function ne(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function ae(e){var r;const[l,o]=(0,O.useState)(null),E=e.storageName||"calendar",D=(0,O.useRef)(null),i=(0,O.useRef)(null),C=(0,O.useRef)(null),[f,I]=(0,O.useState)({start:null,end:null});let G=(!e.widget&&window.localStorage.getItem(`${E}Start`),new Date),W=e.viewMode||window.localStorage.getItem(`${E}View`)||"dayGridMonth";e.isSimulation&&(G=new Date,W=((r=e.simulation)==null?void 0:r.native.interval)==="day"?"timeGridDay":"timeGridWeek");let A=Me;e.isSimulation&&(A=A.filter(n=>n.type==="single"));const j=[];return e.events.forEach(n=>{var y,u,m,w,k,b,H;if(!n)return;const L=(y=n.native)!=null&&y.intervals&&n.native.intervals[0]&&n.native.intervals[0].timeOffset?n.native.intervals[0].timeOffset:30;n.common.color=n.common.color||"#3a87b2";const B=n.common.enabled?n.common.color:ne(n.common.color);let t=x.Utils.invertColor(n.common.color,!0);n.common.enabled||(t=ne(t));let s=n.common.name;if(n.native.oid){let v=n.native.startValue;typeof v=="boolean"&&(v=v?x.I18n.t("ON"):x.I18n.t("OFF"));let h=(m=(u=n.native.intervals)==null?void 0:u[0])==null?void 0:m.value;typeof h=="boolean"&&(h=h?x.I18n.t("ON"):x.I18n.t("OFF")),s=`${n.common.name} \u2192 ${v}`,n.native.type==="double"&&(s+=` \u2192 ${(((k=(w=n.native.intervals)==null?void 0:w[0])==null?void 0:k.timeOffset)||0)/1e3/60} ${x.I18n.t("min")}. \u2192 ${h}`),n.native.type==="toggle"&&(s+=` \u2192 ${(((H=(b=n.native.intervals)==null?void 0:b[0])==null?void 0:H.timeOffset)||0)/1e3/60} ${x.I18n.t("min")}. \u2192 ${x.I18n.t("initial")}`)}if(n.native.cron){const v=V(n.native.cron,"cron",e.serverTimeZone),h=P(n.native.cron);if(v.setFullYear(new Date().getFullYear()-1),Array.isArray(h.months)){new J.Ci({dtstart:v,until:f.end||new Date,freq:J.Ci.WEEKLY,bymonth:h.months}).between(f.start||new Date,f.end||new Date).forEach(S=>{const z=n.native.astro?q().getTimes(S,e.adapterConfig.latitude||e.systemConfig.latitude,e.adapterConfig.longitude||e.systemConfig.longitude)[n.native.astro]:S;j.push({extendedProps:{eventId:n._id},title:s,backgroundColor:B,textColor:t,start:z,duration:L,allDay:!1,display:"block"})});return}if(Array.isArray(h.dows)){new J.Ci({dtstart:v,until:f.end||new Date,freq:J.Ci.WEEKLY,byweekday:h.dows.map(S=>S===0?6:S-1)}).between(f.start||new Date,f.end||new Date).forEach(S=>{const z=n.native.astro?q().getTimes(S,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:S;j.push({extendedProps:{eventId:n._id},title:s,backgroundColor:B,textColor:t,start:z,duration:L,allDay:!1,display:"block"})});return}j.push({extendedProps:{eventId:n._id},title:s,duration:L,backgroundColor:B,textColor:t});return}j.push({extendedProps:{eventId:n._id},title:s,display:"block",backgroundColor:B,textColor:t,start:V(n.native.start,"date",e.serverTimeZone),end:V(new Date(new Date(n.native.start).getTime()+L),"date",e.serverTimeZone)})}),(0,O.useEffect)(()=>{if(e.widget){const n=()=>{var y;const u=(y=D.current)==null?void 0:y.getApi();u&&(console.log("Scroll to now"),u.scrollToTime(new Date().getTime())),i.current?C.current=null:C.current=setTimeout(()=>n,3e5)};setTimeout(n,1e3)}return()=>{C.current&&clearTimeout(C.current),C.current=null,i.current&&clearTimeout(i.current),i.current=null}},[]),(0,O.useEffect)(()=>{var n,y;if(e.isSimulation){const u=(n=D.current)==null?void 0:n.getApi();u==null||u.changeView(((y=e.simulation)==null?void 0:y.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.simulations,e.simulationId]),e.isSimulation&&!e.simulation?null:T.createElement(T.Fragment,null,T.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),l?T.createElement(Le,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(n=>n._id===l),onClose:()=>o(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,T.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&T.createElement("div",{className:e.classes.leftBlock},T.createElement(d.Paper,{elevation:4,className:e.classes.leftPaper},T.createElement("div",{className:e.classes.leftContent},T.createElement("h4",null,e.t("Events")),A.map((n,y)=>{var u,m;return T.createElement(Ve,{t:e.t,type:n,name:e.t(n.name),key:n.type,index:y,color:e.isSimulation?(m=(u=e.simulation)==null?void 0:u.common)==null?void 0:m.color:void 0})}),e.hideLeftBlockHint?null:T.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:T.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:T.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")))),e.button),T.createElement("div",{className:e.classes.calendarBlock},T.createElement("div",{className:e.classes.calendar},T.createElement(re.Z,{ref:D,plugins:[ce.Z,se.Z,oe.Z,X.ZP,de.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:W,initialDate:G,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:j,height:"calc(100% - 20px)",locales:[ue.Z,me.Z,ve.Z,fe.Z,ge.Z,ye.Z,he.Z,Ee.Z,Ce.Z,be.Z],locale:e.language,datesSet:n=>{var y,u;(n.start.toString()!==((y=f.start)==null?void 0:y.toString())||n.end.toString()!==((u=f.end)==null?void 0:u.toString()))&&I({start:n.start,end:n.end}),e.widget?(C.current&&clearTimeout(C.current),C.current=null,i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{i.current=null;const m=()=>{var w;const k=(w=D.current)==null?void 0:w.getApi();k==null||k.scrollToTime(new Date().getTime()),i.current?C.current=null:C.current=setTimeout(()=>m,1e3*60*5)};m()},6e4)):window.localStorage.setItem(`${E}View`,n.view.type)},eventClick:n=>o(n.event.extendedProps.eventId),eventResize:n=>{var y;const u=e.events.find(m=>m._id===n.event.extendedProps.eventId);if((y=u.native.intervals)!=null&&y[0].timeOffset){const m=JSON.parse(JSON.stringify(u));m.native.intervals[0].timeOffset+=n.endDelta.milliseconds,e.setEvent(m._id,m),e.updateEvents()}else n.revert()},eventDrop:n=>U(this,null,function*(){var y;const u=e.events.find(m=>m._id===n.event.extendedProps.eventId);if((y=u==null?void 0:u.native)!=null&&y.cron){const m=JSON.parse(JSON.stringify(u));n.jsEvent.altKey&&(m._id=`${e.calendarPrefix}.event-${(0,M.Z)()}`);const w=P(m.native.cron),k=Z(n.event.start,"cron",e.serverTimeZone);w.hours=k.hours,w.minutes=k.minutes,m.native.cron=F(w),yield e.setEvent(m._id,m),e.updateEvents()}else{const m=JSON.parse(JSON.stringify(u));n.jsEvent.altKey&&(m._id=`${e.calendarPrefix}.event-${(0,M.Z)()}`),m.native.start=Z(n.event.start,"date",e.serverTimeZone),yield e.setEvent(m._id,m),e.updateEvents()}}),eventReceive:n=>U(this,null,function*(){const y={_id:`${e.calendarPrefix}.event-${(0,M.Z)()}`,common:{name:n.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:Z(n.event.start,"date",e.serverTimeZone),type:n.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(n.event.extendedProps.type!=="single"&&(y.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){y.common.color=e.simulation.common.color||y.common.color,delete y.native.start;const u=Z(n.event.start,"cron",e.serverTimeZone);u.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[n.event.start.getDay()],u.dates=["?"],u.months=["*"],y.native.cron=F(u),y._id=`${e.simulationId}.event-${(0,M.Z)()}`,y.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(y._id,y),e.updateEvents(),setTimeout(()=>o(y._id),100)}),select:n=>U(this,null,function*(){if(n.view.calendar.unselect(),e.readOnly)return;const u={_id:`${e.calendarPrefix}.event-${(0,M.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:Z(n.date||n.start,"date",e.serverTimeZone),intervals:n.end&&!e.isSimulation?[{value:"",timeOffset:n.end.getTime()-n.start.getTime()}]:void 0,type:n.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(u.common.color=e.simulation.common.color||u.common.color),yield e.setEvent(u._id,u),yield e.updateEvents(),setTimeout(()=>o(u._id),100)})})))))}ae.propTypes={events:g().array,serverTimeZone:g().number,systemConfig:g().object,theme:g().object,socket:g().object,readOnly:g().bool,hideLeftBlock:g().bool,hideTopBlock:g().bool,hideLeftBlockHint:g().bool,hideTopBlockButtons:g().bool,hideWeekends:g().bool,viewMode:g().bool,updateEvents:g().func,t:g().func.isRequired,widget:g().bool,language:g().string.isRequired,storageName:g().string,calendarPrefix:g().string,isSimulation:g().bool,simulationId:g().string,setEvent:g().func,adapterConfig:g().object,button:g().any};var ze=(0,K.withTheme)((0,K.withStyles)(We)(ae))}}]);

//# sourceMappingURL=src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1.2ac5debd.chunk.js.map