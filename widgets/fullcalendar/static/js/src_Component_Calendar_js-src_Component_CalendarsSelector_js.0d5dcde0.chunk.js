"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{74095:function(Se,oe,u){u.d(oe,{Z:function(){return qe}});var S=u(4819),Q=u(15854),h=u.n(Q),j=u(10651),U=u(58503),fe=u(76516),ee=u(40387),ge=u(24990),X=u(44251),he=u(33634),te=u(51172),J=u(25177),De=u(33841),x=u(49582),ne=u(36513),ae=u(4302),Ie=u(43007),we=u(43223),xe=u(96933),Ne=u(93484),Pe=u(80809),d=u(94427),N=u(75606),le=u(14853),Me=u(98667),ie=u.n(Me),et={},ye=(e,o,a)=>new Promise((s,v)=>{var E=r=>{try{C(a.next(r))}catch(T){v(T)}},i=r=>{try{C(a.throw(r))}catch(T){v(T)}},C=r=>r.done?s(r.value):Promise.resolve(r.value).then(E,i);C((a=a.apply(e,o)).next())});function R(e){if(e==="*"||e==="?"||e==="")return e;const o=e.split(","),a=[];for(let s=0;s<o.length;s++){const v=o[s].match(/(\d+)-(\d+)/);if(v)for(let E=parseInt(v[1],10);E<=parseInt(v[2],10);E++)a.push(E);else a.push(parseInt(o[s],10))}return a}function B(e,o){const a={};if(o){const s=o.split(/\D/);a.seconds=[parseInt(s[5],10)],a.minutes=[parseInt(s[4],10)],a.hours=[parseInt(s[3],10)],a.dates=[parseInt(s[2],10)],a.months=[parseInt(s[1],10)],a.dows="?"}else{const s=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");s.length===6?(a.seconds=R(s[0]),a.minutes=R(s[1]),a.hours=R(s[2]),a.dates=R(s[3]),a.months=R(s[4]),a.dows=R(s[5])):(a.seconds=[0],a.minutes=R(s[0]),a.hours=R(s[1]),a.dates=R(s[2]),a.months=R(s[3]),a.dows=R(s[4]))}return a}function G(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort((v,E)=>v-E),e.length<3)return e.join(",");const o=[];let a=e[0],s=e[0];for(let v=1;v<e.length;v++)e[v]===s+1?s++:(a!==s?a+1===s?o.push(`${a},${s}`):o.push(`${a}-${s}`):o.push(a),a=e[v],s=e[v]);return a!==s?a+1===s?o.push(`${a},${s}`):o.push(`${a}-${s}`):o.push(a),o.join(",")}function H(e){const o=[];return e.seconds&&o.push(G(e.seconds)),o.push(G(e.minutes)),o.push(G(e.hours)),o.push(G(e.dates)),o.push(G(e.months)),o.push(G(e.dows)),o.join(" ")}function q(e,o){if(o==="cron"){const a=B(e),s=new Date;return s.setHours(a.hours[0]),s.setMinutes(a.minutes[0]),s.setSeconds(a.seconds[0]),Array.isArray(a.dows)&&s.setDate(s.getDate()+a.dows[0]-s.getDay()),s}return o==="date"?new Date(e):null}function $(e,o){if(o==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(o==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const a=e.toISOString();return a.substring(0,a.length-5)}return null}const w={},tt=null;function nt(e,o,a){const s={};e.forEach(E=>{var i,C;const T=E.split(".")[1];s[T]=s[T]||[],o[E]&&((C=(i=o[E].common)==null?void 0:i.members)==null||C.forEach(D=>!a.includes(D)&&!s[T].includes(D)&&s[T].push(D)))});let v=[];return Object.keys(s).forEach((E,i)=>{const C=s[E];i?v=v.filter(r=>C.includes(r)):v=C}),v.filter((E,i)=>v.indexOf(E)===i)}function at(e){var o,a,s,v,E,i;if(w[e]){if((o=w[e].common)!=null&&o.icon)return(a=w[e].common)==null?void 0:a.icon;if(w[e].type==="state"||w[e].type==="channel"){let C=e.split(".");C.pop();let r=C.join(".");if(w[r]&&((s=w[r].common)!=null&&s.icon))return(v=w[r].common)==null?void 0:v.icon;if(w[r]&&w[r].type==="channel"&&(C=e.split("."),C.pop(),r=C.join("."),w[r]&&((E=w[r].common)!=null&&E.icon)))return(i=w[r].common)==null?void 0:i.icon}}}function re(e,o){return ye(this,null,function*(){if(w[e]===void 0){try{w[e]=yield o.getObject(e)}catch(a){}w[e]=w[e]||null}return w[e]})}function lt(e,o){return ye(this,null,function*(){var a,s,v,E,i,C;let r=yield re(e,o);if(r){if((a=r.common)!=null&&a.icon)return(s=r.common)==null?void 0:s.icon;if(r.type==="state"||r.type==="channel"){let T=e.split(".");T.pop();let D=T.join(".");if(r=yield re(D,o),r&&((v=r.common)!=null&&v.icon))return(E=r.common)==null?void 0:E.icon;if(r&&r.type==="channel"&&(T=e.split("."),T.pop(),D=T.join("."),r=yield re(D,o),r&&((i=r.common)!=null&&i.icon)))return(C=r.common)==null?void 0:C.icon}}})}var ke=u(36105),ce=u.n(ke),it=u(63460),st=u(79117),ot=u(83994),rt=u(28301),ct=u(19867),dt=u(68582),ut=u(37529),mt=u(69850),vt=u(15552),ft=u(97712),Ae=u(92631),Re=u(71373),$e=u(38809),de=u(59665),l=u(4819),Le=Object.defineProperty,Ze=Object.defineProperties,je=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,Ce=(e,o,a)=>o in e?Le(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,Fe=(e,o)=>{for(var a in o||(o={}))Be.call(o,a)&&Ce(e,a,o[a]);if(Ee)for(var a of Ee(o))We.call(o,a)&&Ce(e,a,o[a]);return e},Ve=(e,o)=>Ze(e,je(o)),ue=(e,o,a)=>new Promise((s,v)=>{var E=r=>{try{C(a.next(r))}catch(T){v(T)}},i=r=>{try{C(a.throw(r))}catch(T){v(T)}},C=r=>r.done?s(r.value):Promise.resolve(r.value).then(E,i);C((a=a.apply(e,o)).next())});const Ue={single:"single_description",double:"double_description",toggle:"toggle_description"},He={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},Ke=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function ze(e,o){return e&&typeof e=="object"?e[o]||e.en:e}function Je(e,o){return ue(this,null,function*(){let a;typeof e=="string"?a=yield o.getObject(e):a=e;let s=null;if(a&&a.common&&a.common.icon)s=N.Utils.getObjectIcon(a);else if(a.type==="state"){let v=a._id.split(".");v.pop();let E=v.join(".");a=yield o.getObject(E),a&&a.common&&a.common.icon?s=N.Utils.getObjectIcon(a):(!a||a.type==="channel"||a.type==="device")&&(v=a._id.split("."),v.pop(),E=v.join("."),a=yield o.getObject(E),a&&a.common&&a.common.icon&&(s=N.Utils.getObjectIcon(a)))}return s})}const be=e=>{var o;const a=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,s=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[v,E]=(0,S.useState)(!1),[i,C]=(0,S.useState)(e.event),[r,T]=(0,S.useState)(null),[D,k]=(0,S.useState)(!1),[A,ve]=(0,S.useState)(a),[L,K]=(0,S.useState)(s),[W,z]=(0,S.useState)({});ce().locale(e.language);const t=(0,S.useCallback)(n=>{const c=JSON.parse(JSON.stringify(i));n(c),C(c)},[i]);(0,S.useEffect)(()=>{const n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const c=ie().getTimes(n,e.systemConfig.latitude,e.systemConfig.longitude);if(z(c),i.native.oid){if(!r||r._id!==i.native.oid)try{e.socket.getObject(i.native.oid).then(y=>{JSON.stringify(i.native.states)!==JSON.stringify(y.common.states)&&t(b=>b.native.states=y.common.states),(r||e.event.native.oid!==i.native.oid)&&Je(y,e.socket).then(b=>t(I=>I.common.icon=b)),T(y)})}catch(y){console.error(`Cannot get object ${i.native.oid}: ${y}`),T(null)}}else T(null)},[i.native.oid,e.socket,t,i.native.states,r,e.event.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);const f=i.native.cron?B(i.native.cron):null;let m="once";Array.isArray(f==null?void 0:f.months)?m="monthly":Array.isArray(f==null?void 0:f.dows)&&(m="daily");let g;i&&(m==="once"?g=q(i.native.start,"date",e.serverTimeZone):(m==="monthly"||m==="daily")&&(g=q(i.native.cron,"cron",e.serverTimeZone)));const P=JSON.stringify(e.event)!==JSON.stringify(i)||A!==a||L!==s,Z=(n,c)=>r?r.common.type==="boolean"?(n==="startValue"&&typeof i.native[n]!="boolean"&&setTimeout(()=>t(y=>y.native[n]=!!y.native[n]),100),l.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(d.Checkbox,{checked:!!i.native[n],disabled:e.readOnly,onChange:y=>t(b=>b.native[n]=y.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t(c)),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):r.common.states?l.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(d.InputLabel,null,e.t(c)),l.createElement(d.Select,{value:i.native[n]||"",disabled:e.readOnly,onChange:y=>t(b=>b.native[n]=y.target.value)},Object.keys(r.common.states).map(y=>l.createElement(d.MenuItem,{key:y,value:y},r.common.states[y])))):l.createElement(d.TextField,{className:e.classes.narrowText2,label:e.t(c),value:i.native[n]||"",disabled:e.readOnly,onChange:y=>t(b=>b.native[n]=y.target.value),variant:"standard"}):null,se=()=>r?r.common.type==="boolean"?(typeof L!="boolean"&&setTimeout(()=>K(!!L),100),l.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(d.Checkbox,{checked:!!L,disabled:e.readOnly,onChange:n=>K(n.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t("End value")),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):r.common.states?l.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(d.InputLabel,null,e.t("End value")),l.createElement(d.Select,{value:L||"",disabled:e.readOnly,onChange:n=>K(n.target.value)},Object.keys(r.common.states).map(n=>l.createElement(d.MenuItem,{key:n,value:n},r.common.states[n])))):l.createElement(d.TextField,{label:e.t("End value"),value:L||"",disabled:e.readOnly,onChange:n=>K(n.target.value),variant:"standard",className:e.classes.narrowText2}):null,p=((o=e.systemConfig)==null?void 0:o.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],F=i.native.astro&&W?W[i.native.astro]:"",_=F?F.toLocaleTimeString().replace(/:\d\d$/,""):"";let V="";i.native.astro&&i.native.offset&&F&&(V=new Date(F.getTime()+i.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let M=i.common.icon;return M&&!M.startsWith("data:image")&&!M.startsWith("http")&&!M.startsWith("/")&&(M=`../../${M}`),l.createElement(d.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},l.createElement(d.DialogTitle,null,e.t("Configure event")),l.createElement(d.DialogContent,null,v&&l.createElement(N.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:n=>{t(c=>c.native.oid=n),E(!1)},onClose:()=>E(!1),socket:e.socket}),l.createElement("div",{className:e.classes.field},l.createElement(d.FormControlLabel,{control:l.createElement(d.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:n=>t(c=>c.common.enabled=n.target.checked)}),label:e.t("Active")})),l.createElement("div",{className:e.classes.field},l.createElement(d.FormControl,{variant:"standard",className:e.classes.timeType},l.createElement(d.InputLabel,null,e.t("Time type")),l.createElement(d.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:n=>t(c=>{n.target.value==="astro"?c.native.astro="sunrise":delete c.native.astro}),renderValue:n=>e.t(n)},["time","astro"].map(n=>l.createElement(d.MenuItem,{key:n,value:n},l.createElement("div",null,e.t(n)))))),i.native.astro?l.createElement(d.FormControl,{className:e.classes.narrowText,variant:"standard"},l.createElement(d.InputLabel,null,e.t("Astronomic event")),l.createElement(d.Select,{value:i.native.astro||"",onChange:n=>t(c=>c.native.astro=n.target.value),renderValue:n=>e.t(n)},Ke.map(n=>l.createElement(d.MenuItem,{key:n,value:n},l.createElement("div",{style:{display:"flex",width:"100%"}},l.createElement("span",null,e.t(n)),l.createElement("span",{style:{flexGrow:1}}),l.createElement("span",null," ","- [",W&&W[n]?W[n].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):l.createElement($e._,{dateAdapter:Re.Z},l.createElement(Ae.j,{label:e.t("Time"),value:g||null,disabled:e.readOnly,onChange:n=>{if(n)try{t(c=>{if(m==="once")c.native.start=$(n.toDate(),"date",e.serverTimeZone);else if(m==="monthly"||m==="daily"){const y=B(c.native.cron),b=$(n.toDate(),"cron",e.serverTimeZone);y.hours=b.hours,y.minutes=b.minutes,c.native.cron=H(y)}})}catch(c){}},renderInput:n=>l.createElement(d.TextField,Ve(Fe({},n),{variant:"standard",className:e.classes.narrowText,helperText:g.getSeconds()?g.toLocaleTimeString():""})),ampm:!1})),i.native.astro?l.createElement(d.FormControl,{variant:"standard",className:e.classes.width60},l.createElement(d.InputLabel,null,e.t("Offset")),l.createElement(d.Select,{value:i.native.offset||0,disabled:e.readOnly,onChange:n=>t(c=>c.native.offset=n.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(n=>l.createElement(d.MenuItem,{key:n.value,value:n.value},n.value<0?`- ${e.t(n.label)}`:e.t(n.label))))):null,e.isSimulation&&l.createElement(d.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:n=>t(c=>c.native.timeRandomOffset=parseInt(n.target.value)),variant:"standard",InputProps:{endAdornment:l.createElement(d.InputAdornment,{position:"end"},e.t("ms"))}})),i.native.astro?l.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(i.native.astro),_),"\xA0",i.native.offset?e.t("With offset at %s.",V):null):null,l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},l.createElement(d.InputLabel,null,e.t("Event type")),l.createElement(d.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:n=>t(c=>c.native.type=n.target.value),renderValue:n=>e.t(n)},["single","double","toggle"].map(n=>l.createElement(d.MenuItem,{key:n,value:n},l.createElement("div",null,l.createElement("div",null,e.t(n)),l.createElement("div",{className:e.classes.typeDescription},e.t(Ue[n]))))))),i.native.type!=="single"&&l.createElement(d.TextField,{label:e.t("Duration"),value:A,disabled:e.readOnly,onChange:n=>ve(n.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:l.createElement(d.InputAdornment,{position:"end"},e.t("minutes"))}})),l.createElement("div",{className:e.classes.field},l.createElement("div",{className:e.classes.selectId},l.createElement(N.Icon,{src:M||"",style:{width:32,height:32}}),l.createElement(d.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:n=>t(c=>c.native.oid=n.target.value),variant:"standard",helperText:ze((r==null?void 0:r.common.name)||"",e.language),fullWidth:!0}),l.createElement(d.Button,{onClick:()=>E(!0)},"..."))),l.createElement("div",{className:e.classes.field},Z("startValue",i.native.type==="toggle"?"First value":i.native.type==="single"?"Desired value":"Start value"),i.native.type==="double"&&se()),l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(d.FormControl,{variant:"standard"},l.createElement(d.InputLabel,null,e.t("Period")),l.createElement(d.Select,{value:m||"once",disabled:e.readOnly,onChange:n=>{n.target.value!==i.native.cron&&t(c=>{if(n.target.value==="once")delete c.native.cron,c.native.start=$(g,"date",e.serverTimeZone);else if(n.target.value==="daily"){delete c.native.start;const y=B("0 0 ? * 0-6"),b=$(g,"cron",e.serverTimeZone);y.hours=b.hours,y.minutes=b.minutes,c.native.cron=H(y)}else if(n.target.value==="monthly"){delete c.native.start;const y=B("0 0 * 1-12 *"),b=$(g,"cron",e.serverTimeZone);y.hours=b.hours,y.minutes=b.minutes,c.native.cron=H(y)}})}},["once","daily","monthly"].map(n=>l.createElement(d.MenuItem,{key:n,value:n},e.t(n))))),m==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&l.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},l.createElement("thead",null,l.createElement("tr",null,p.map(n=>l.createElement("td",{key:n,className:e.classes.tableCell},ce()().day(n).format("ddd"))))),l.createElement("tbody",null,l.createElement("tr",null,p.map(n=>{var c;return l.createElement("td",{key:n},l.createElement(d.Checkbox,{checked:((c=f==null?void 0:f.dows)==null?void 0:c.includes(n))||!1,disabled:e.readOnly,onChange:y=>{t(b=>{const I=B(b.native.cron);y.target.checked?I.dows.push(n):I.dows=I.dows.filter(Y=>Y!==n),b.native.cron=H(I)})},size:"small"}))}))))),m==="monthly"&&l.createElement("div",{className:e.classes.field},l.createElement("table",null,l.createElement("thead",null,l.createElement("tr",null,new Array(12).fill(null).map((n,c)=>l.createElement("td",{key:c,className:e.classes.tableCell},ce()().month(c).format("MMM"))))),l.createElement("tbody",null,l.createElement("tr",null,new Array(12).fill(null).map((n,c)=>{var y;return l.createElement("td",{key:c},l.createElement(d.Checkbox,{checked:((y=f==null?void 0:f.months)==null?void 0:y.includes(c+1))||!1,disabled:e.readOnly,onChange:b=>{t(I=>{const Y=B(I.native.cron);b.target.checked?Y.months.push(c+1):Y.months=Y.months.filter(pe=>pe!==c+1),I.native.cron=H(Y)})},size:"small"}))}))))),l.createElement("div",{className:e.classes.field},l.createElement(d.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:n=>t(c=>c.common.name=n.target.value),variant:"standard",fullWidth:!0})),l.createElement("div",{className:e.classes.narrowColor},l.createElement(N.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:n=>t(c=>c.common.color=n),name:e.t("Color")}))),l.createElement(d.DialogActions,null,e.readOnly?null:l.createElement(d.Button,{variant:"contained",color:"secondary",startIcon:l.createElement(de.Delete,null),onClick:()=>k(!0)},e.t("Delete")),!e.readOnly&&!e.widget?l.createElement("div",{style:{flex:1}}):null,e.readOnly?null:l.createElement(d.Button,{variant:"contained",color:"primary",disabled:!P,startIcon:l.createElement(de.Save,null),onClick:()=>ue(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(A)||1)*6e4,i.native.intervals[0].value=L):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(A)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),l.createElement(d.Button,{variant:"contained",color:"grey",startIcon:l.createElement(de.Cancel,null),onClick:e.onClose},e.readOnly||!P?e.t("ra_Close"):e.t("ra_Cancel"))),D&&l.createElement(N.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:n=>ue(void 0,null,function*(){if(n){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(c){window.alert(`Cannot delete event: ${c}`)}e.onClose()}k(!1)})}))};be.propTypes={systemConfig:h().object,classes:h().object.isRequired,socket:h().object.isRequired,onClose:h().func.isRequired,event:h().object,readOnly:h().bool,updateEvents:h().func.isRequired,serverTimeZone:h().number.isRequired,t:h().func.isRequired,language:h().string.isRequired,widget:h().bool,setEvent:h().func.isRequired,deleteEvent:h().func.isRequired};var Ge=(0,U.withStyles)(He)(be),O=u(4819),me=(e,o,a)=>new Promise((s,v)=>{var E=r=>{try{C(a.next(r))}catch(T){v(T)}},i=r=>{try{C(a.throw(r))}catch(T){v(T)}},C=r=>r.done?s(r.value):Promise.resolve(r.value).then(E,i);C((a=a.apply(e,o)).next())});const _e=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ye=[1,2,3,5,10,15,20,30,60],Qe=({type:e,t:o,color:a})=>{const s=(0,S.useRef)(null);return(0,S.useEffect)(()=>{const v=new X._l(s.current,{eventData:()=>({id:e.type,title:o(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{v.destroy()}},[]),O.createElement("div",{style:{backgroundColor:a||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:s},o(e.name))},Xe=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function Te(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function Oe(e){var o,a;const[s,v]=(0,S.useState)(null),[E,i]=(0,S.useState)(e.dayStep||parseInt(window.localStorage.getItem("calendarStep"),10)||30),C=e.storageName||"calendar",r=(0,S.useRef)(null),T=(0,S.useRef)(null),D=(0,S.useRef)(null),k=(0,S.useRef)(null),[A,ve]=(0,S.useState)({start:null,end:null});let L=(!e.widget&&window.localStorage.getItem(`${C}Start`),new Date),K=e.viewMode||window.localStorage.getItem(`${C}View`)||"dayGridMonth";e.isSimulation&&(L=new Date,K=((o=e.simulation)==null?void 0:o.native.interval)==="day"?"timeGridDay":"timeGridWeek");let W=_e;e.isSimulation&&(W=W.filter(t=>t.type==="single"));const z=[];return e.events.forEach(t=>{var f,m,g,P,Z,se,p;if(!t)return;const F=(f=t.native)!=null&&f.intervals&&t.native.intervals[0]&&t.native.intervals[0].timeOffset?t.native.intervals[0].timeOffset:30;t.common.color=t.common.color||"#3a87b2";const _=t.common.enabled?t.common.color:Te(t.common.color);let V=N.Utils.invertColor(t.common.color,!0);t.common.enabled||(V=Te(V));let M=t.common.name;if(t.native.oid){let n=t.native.startValue;typeof n=="boolean"?n=n?N.I18n.t("ON"):N.I18n.t("OFF"):t.native.states&&t.native.states[n]&&(n=t.native.states[n]);let c=(g=(m=t.native.intervals)==null?void 0:m[0])==null?void 0:g.value;typeof c=="boolean"?c=c?N.I18n.t("ON"):N.I18n.t("OFF"):t.native.states&&t.native.states[c]&&(c=t.native.states[c]),M=`${t.common.name} \u2192 ${n}`,t.native.type==="double"&&(M+=` \u2192 ${(((Z=(P=t.native.intervals)==null?void 0:P[0])==null?void 0:Z.timeOffset)||0)/1e3/60} ${N.I18n.t("min")}. \u2192 ${c}`),t.native.type==="toggle"&&(M+=` \u2192 ${(((p=(se=t.native.intervals)==null?void 0:se[0])==null?void 0:p.timeOffset)||0)/1e3/60} ${N.I18n.t("min")}. \u2192 ${N.I18n.t("initial")}`)}if(t.native.cron){const n=q(t.native.cron,"cron",e.serverTimeZone),c=B(t.native.cron);n.setFullYear(new Date().getFullYear()-1),Array.isArray(c.months)?new le.Ci({dtstart:n,until:A.end||new Date,freq:le.Ci.WEEKLY,bymonth:c.months}).between(A.start||new Date,A.end||new Date).forEach(b=>{const I=t.native.astro?ie().getTimes(b,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:b;t.native.astro&&t.native.offset&&I.setMinutes(I.getMinutes()+t.native.offset),z.push({extendedProps:{eventId:t._id,icon:t.common.icon,type:t.native.type,seconds:I.getSeconds()},title:M,backgroundColor:_,textColor:V,start:I,duration:F,allDay:!1,display:"block"})}):Array.isArray(c.dows)?new le.Ci({dtstart:n,until:A.end||new Date,freq:le.Ci.WEEKLY,byweekday:c.dows.map(b=>b===0?6:b-1)}).between(A.start||new Date,A.end||new Date).forEach(b=>{const I=t.native.astro?ie().getTimes(b,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:b;t.native.astro&&t.native.offset&&I.setMinutes(I.getMinutes()+t.native.offset),z.push({extendedProps:{eventId:t._id,icon:t.common.icon,type:t.native.type,seconds:I.getSeconds()},title:M,backgroundColor:_,textColor:V,start:I,duration:F,allDay:!1,display:"block"})}):z.push({extendedProps:{eventId:t._id,icon:t.common.icon,type:t.native.type,seconds:0},title:M,duration:F,backgroundColor:_,textColor:V,icon:t.common.icon})}else{const n=t.native.astro?ie().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:t.native.start;t.native.astro&&t.native.offset&&n.setMinutes(n.getMinutes()+t.native.offset),z.push({extendedProps:{eventId:t._id,icon:t.common.icon,type:t.native.type,seconds:0},title:M,display:"block",backgroundColor:_,textColor:V,start:q(n,"date",e.serverTimeZone),end:q(new Date(new Date(n).getTime()+F),"date",e.serverTimeZone)})}}),(0,S.useEffect)(()=>{if(e.widget){const t=()=>{var f;const m=(f=r.current)==null?void 0:f.getApi();m&&(console.log("Scroll to now"),m.scrollToTime(new Date().getTime())),D.current?k.current=null:k.current=setTimeout(()=>t,3e5)};setTimeout(t,1e3)}return()=>{k.current&&clearTimeout(k.current),k.current=null,D.current&&clearTimeout(D.current),D.current=null}},[]),(0,S.useEffect)(()=>{var t,f;if(e.isSimulation){const m=(t=r.current)==null?void 0:t.getApi();m==null||m.changeView(((f=e.simulation)==null?void 0:f.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.isSimulation,(a=e.simulation)==null?void 0:a.native.interval]),e.isSimulation&&!e.simulation?null:O.createElement(O.Fragment,null,O.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),s?O.createElement(Ge,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(t=>t._id===s),onClose:()=>v(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,O.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&O.createElement("div",{className:e.classes.leftBlock},O.createElement(d.Paper,{elevation:4,className:e.classes.leftPaper},O.createElement("div",{className:e.classes.leftContent},O.createElement("h4",null,e.t("Events")),W.map((t,f)=>{var m,g;return O.createElement(Qe,{t:e.t,type:t,name:e.t(t.name),key:t.type,index:f,color:e.isSimulation?(g=(m=e.simulation)==null?void 0:m.common)==null?void 0:g.color:void 0})}),e.hideLeftBlockHint?null:O.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:O.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:O.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:O.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:O.createElement("div",null,e.t("Use double click on calendar to add new events.")),e.hideLeftBlockHint?null:O.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:O.createElement(d.FormControl,{fullWidth:!0,variant:"standard"},O.createElement(d.InputLabel,null,e.t("Zoom")),O.createElement(d.Select,{value:E,onChange:t=>{window.localStorage.setItem("calendarStep",t.target.value.toString()),i(t.target.value)}},Ye.map(t=>O.createElement(d.MenuItem,{key:t,value:t},t,e.t("min"))))))),e.button),O.createElement("div",{className:e.classes.calendarBlock},O.createElement("div",{className:e.classes.calendar},O.createElement(fe.Z,{ref:r,plugins:[te.Z,ee.Z,ge.Z,X.ZP,he.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},slotDuration:`00:${E.toString().padStart(2,"0")}:00`,eventMinHeight:20,initialView:K,initialDate:L,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:z,height:"calc(100% - 20px)",locales:[J.Z,De.Z,x.Z,ne.Z,ae.Z,Ie.Z,we.Z,xe.Z,Ne.Z,Pe.Z],locale:e.language,datesSet:t=>{var f,m;(t.start.toString()!==((f=A.start)==null?void 0:f.toString())||t.end.toString()!==((m=A.end)==null?void 0:m.toString()))&&ve({start:t.start,end:t.end}),e.widget?(k.current&&clearTimeout(k.current),k.current=null,D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{D.current=null;const g=()=>{var P;const Z=(P=r.current)==null?void 0:P.getApi();Z==null||Z.scrollToTime(new Date().getTime()),D.current?k.current=null:k.current=setTimeout(()=>g,1e3*60*5)};g()},6e4)):window.localStorage.setItem(`${C}View`,t.view.type)},eventClick:t=>v(t.event.extendedProps.eventId),eventResize:t=>{var f;const m=e.events.find(g=>g._id===t.event.extendedProps.eventId);if((f=m.native.intervals)!=null&&f[0].timeOffset){const g=JSON.parse(JSON.stringify(m));g.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(g._id,g),e.updateEvents()}else t.revert()},eventDrop:t=>me(this,null,function*(){var f;const m=e.events.find(g=>g._id===t.event.extendedProps.eventId);if((f=m==null?void 0:m.native)!=null&&f.cron){const g=JSON.parse(JSON.stringify(m));t.jsEvent.altKey&&(g._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`);const P=B(g.native.cron),Z=$(t.event.start,"cron",e.serverTimeZone);P.hours=Z.hours,P.minutes=Z.minutes,g.native.cron=H(P),yield e.setEvent(g._id,g),e.updateEvents()}else{const g=JSON.parse(JSON.stringify(m));t.jsEvent.altKey&&(g._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`),g.native.start=$(t.event.start,"date",e.serverTimeZone),yield e.setEvent(g._id,g),e.updateEvents()}}),eventReceive:t=>me(this,null,function*(){const f={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:t.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.event.start,"date",e.serverTimeZone),type:t.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(t.event.extendedProps.type!=="single"&&(f.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){f.common.color=e.simulation.common.color||f.common.color,delete f.native.start;const m=$(t.event.start,"cron",e.serverTimeZone);m.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[t.event.start.getDay()],m.dates=["?"],m.months=["*"],f.native.cron=H(m),f.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(f._id,f),e.updateEvents(),setTimeout(()=>v(f._id),100)}),eventDidMount:t=>{let f=t.event.extendedProps.icon;if(f){const m=window.document.createElement("img");!f.startsWith("data:image")&&!f.startsWith("http")&&!f.startsWith("/")&&(f=`../../${f}`),m.setAttribute("src",f),m.className="icon",m.style.width="20px",m.style.height="20px";const g=t.el.getElementsByClassName("fc-event-title-container");if(g.length){g[0].prepend(m);const P=g[0].getElementsByClassName("fc-event-title");P.length&&(P[0].style.marginLeft="23px")}}if(t.event.extendedProps.seconds){const m=t.el.getElementsByClassName("fc-event-time");m.length&&(m[0].innerText=`${m[0].innerText}:${t.event.extendedProps.seconds.toString().padStart(2,"0")}`)}},select:t=>me(this,null,function*(){if(t.view.calendar.unselect(),e.readOnly)return;const m=t.end.getTime()-t.start.getTime();if((!T.current||Date.now()-T.current>500)&&m===30*60*1e3){T.current=Date.now();return}const g={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.date||t.start,"date",e.serverTimeZone),intervals:t.end&&!e.isSimulation?[{value:"",timeOffset:t.end.getTime()-t.start.getTime()}]:void 0,type:t.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(g.common.color=e.simulation.common.color||g.common.color),yield e.setEvent(g._id,g),yield e.updateEvents(),setTimeout(()=>v(g._id),100)})})))))}Oe.propTypes={events:h().array,serverTimeZone:h().number,systemConfig:h().object,theme:h().object,socket:h().object,readOnly:h().bool,hideLeftBlock:h().bool,hideTopBlock:h().bool,hideLeftBlockHint:h().bool,hideTopBlockButtons:h().bool,hideWeekends:h().bool,viewMode:h().bool,updateEvents:h().func,t:h().func.isRequired,widget:h().bool,language:h().string.isRequired,storageName:h().string,calendarPrefix:h().string,isSimulation:h().bool,simulationId:h().string,setEvent:h().func,button:h().any,dayStep:h().number};var qe=(0,U.withTheme)((0,U.withStyles)(Xe)(Oe))},82809:function(Se,oe,u){var S=u(4819),Q=u.n(S),h=u(15854),j=u.n(h),U=u(94427),fe=u.n(U),ee=u(75606),ge=u.n(ee),X=u(88411),he=u.n(X);const te=window.visRxWidget||X.VisRxWidget;class J extends Q().Component{constructor(x){super(x),this.state={list:[{value:"",label:te.t("default")}]}}static getText(x){return typeof x=="object"?x[ee.I18n.getLanguage()]||x.en:x}componentDidMount(){this.props.instance&&this.props.socket.getObjectViewSystem("folder",`fullcalendar.${this.props.instance}.Calendars.`,`fullcalendar.${this.props.instance}.Calendars.\u9999`).then(x=>{const ne=Object.keys(x).map(ae=>({value:ae,label:J.getText(x[ae].common.name)}));ne.unshift({value:"",label:te.t("default")}),this.setState({list:ne})})}render(){return Q().createElement(U.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:x=>this.props.onChange(x.target.value)},this.state.list.map(x=>Q().createElement(U.MenuItem,{key:x.value},x.label)))}}J.propTypes={value:j().string,socket:j().object,onChange:j().func,instance:j().number},oe.Z=J}}]);

//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.0d5dcde0.chunk.js.map