"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1"],{83178:function(Ne,Q,d){d.d(Q,{Z:function(){return ke}});var U=d(76516),Y=d(40387),X=d(24990),J=d(44251),q=d(10367),_=d(51172),p=d(25177),ee=d(33841),te=d(49582),ne=d(36513),le=d(4302),ae=d(43007),ie=d(43223),re=d(96933),se=d(93484),oe=d(80809),T=d(4819),c=d(94427),A=d(10651),R=d(58503),ce=d(15854),g=d.n(ce);function de(e,i){return e-i}function S(e){if(e==="*"||e==="?"||e==="")return e;const i=e.split(","),t=[];for(let r=0;r<i.length;r++){const l=i[r].match(/(\d+)-(\d+)/);if(l)for(let D=parseInt(l[1],10);D<=parseInt(l[2],10);D++)t.push(D);else t.push(parseInt(i[r],10))}return t}function w(e,i){const t={};if(i){const r=i.split(/\D/);t.seconds=[parseInt(r[5],10)],t.minutes=[parseInt(r[4],10)],t.hours=[parseInt(r[3],10)],t.dates=[parseInt(r[2],10)],t.months=[parseInt(r[1],10)],t.dows="?"}else{const r=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");r.length===6?(t.seconds=S(r[0]),t.minutes=S(r[1]),t.hours=S(r[2]),t.dates=S(r[3]),t.months=S(r[4]),t.dows=S(r[5])):(t.seconds=[0],t.minutes=S(r[0]),t.hours=S(r[1]),t.dates=S(r[2]),t.months=S(r[3]),t.dows=S(r[4]))}return t}function k(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(de),e.length<3)return e.join(",");const i=[];let t=e[0],r=e[0];for(let l=1;l<e.length;l++)e[l]===r+1?r++:(t!==r?t+1===r?i.push(`${t},${r}`):i.push(`${t}-${r}`):i.push(t),t=e[l],r=e[l]);return t!==r?t+1===r?i.push(`${t},${r}`):i.push(`${t}-${r}`):i.push(t),i.join(",")}function N(e){const i=["*","*","*","*","*","?"];return e.seconds&&(i[0]=k(e.seconds)),i[1]=k(e.minutes),i[2]=k(e.hours),i[3]=k(e.dates),i[4]=k(e.months),i[5]=k(e.dows),i[0]==="0"&&i.shift(),i.join(" ")}function P(e,i,t){if(i==="cron"){const r=w(e);let l=new Date;return l.setHours(r.hours[0],r.minutes[0]),l=new Date(l.getTime()-(l.getTimezoneOffset()+t)*6e4),l}return i==="date"?(e+="Z",new Date(new Date(e).getTime()-t*6e4)):null}function Z(e,i,t){if(i==="cron")return e=new Date(e.getTime()+(e.getTimezoneOffset()+t)*6e4),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(i==="date"){e=new Date(e.getTime()+t*6e4);const r=e.toISOString();return r.substring(0,r.length-5)}return null}var $=d(59665),M=d(75606),ue=d(71373),me=d(38809),ve=d(95431),fe=d(36105),L=d.n(fe),n=d(4819),ge=Object.defineProperty,he=Object.defineProperties,ye=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,V=(e,i,t)=>i in e?ge(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,Oe=(e,i)=>{for(var t in i||(i={}))Ee.call(i,t)&&V(e,t,i[t]);if(W)for(var t of W(i))Ce.call(i,t)&&V(e,t,i[t]);return e},be=(e,i)=>he(e,ye(i)),F=(e,i,t)=>new Promise((r,l)=>{var D=v=>{try{m(t.next(v))}catch(u){l(u)}},a=v=>{try{m(t.throw(v))}catch(u){l(u)}},m=v=>v.done?r(v.value):Promise.resolve(v.value).then(D,a);m((t=t.apply(e,i)).next())});const De={single:"single_description",double:"double_description",toggle:"toggle_description"},Se={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},dialogActions:{justifyContent:"space-between"},dialogActionsRight:{display:"flex",gap:8},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex"}},G=e=>{var i;const[t,r]=(0,T.useState)(!1),[l,D]=(0,T.useState)(e.event),[a,m]=(0,T.useState)(null),[v,u]=(0,T.useState)(!1),C=s=>F(void 0,null,function*(){m(s?yield e.socket.getObject(s):null)});(0,T.useEffect)(()=>{D(e.event),C(l==null?void 0:l.native.oid)},[e.open]);const E=l!=null&&l.native.cron?w(l==null?void 0:l.native.cron):null;let O="once";Array.isArray(E==null?void 0:E.months)?O="monthly":Array.isArray(E==null?void 0:E.dows)&&(O="daily");let I;l&&(O==="once"?I=P(l.native.start,"date",e.serverTimeZone):(O==="monthly"||O==="daily")&&(I=P(l.native.cron,"cron",e.serverTimeZone)));const b=s=>{const o=JSON.parse(JSON.stringify(l));s(o),D(o)},K=(s,o)=>a?a.common.type==="boolean"?n.createElement(c.FormControlLabel,{control:n.createElement(c.Checkbox,{checked:!!(l!=null&&l.native[s]),disabled:e.readOnly,onChange:f=>{b(h=>h.native[s]=f.target.checked)}}),label:e.t(o)}):a.common.states?n.createElement(c.FormControl,{fullWidth:!0,variant:"standard"},n.createElement(c.InputLabel,null,e.t(o)),n.createElement(c.Select,{value:(l==null?void 0:l.native[s])||"",disabled:e.readOnly,onChange:f=>{b(h=>h.native[s]=f.target.value)}},Object.keys(a.common.states).map(f=>n.createElement(c.MenuItem,{key:f,value:f},a.common.states[f])))):n.createElement(c.TextField,{label:e.t(o),value:(l==null?void 0:l.native[s])||"",disabled:e.readOnly,onChange:f=>b(h=>h.native[s]=f.target.value),variant:"standard",fullWidth:!0}):null;return n.createElement(c.Dialog,{open:e.open,onClose:e.onClose,fullWidth:!0},n.createElement(c.DialogTitle,null,e.t("Configure event")),n.createElement(c.DialogContent,null,t&&n.createElement(M.SelectID,{selected:l==null?void 0:l.native.oid,disabled:e.readOnly,onOk:s=>{b(o=>o.native.oid=s),r(!1),C(s)},onClose:()=>r(!1),socket:e.socket}),n.createElement("div",{className:e.classes.field},n.createElement(c.FormControlLabel,{control:n.createElement(c.Checkbox,{checked:!!(l!=null&&l.common.enabled),disabled:e.readOnly,onChange:s=>b(o=>o.common.enabled=s.target.checked)}),label:e.t("Active")})),n.createElement("div",{className:e.classes.field},n.createElement(c.FormControl,{fullWidth:!0,variant:"standard"},n.createElement(c.InputLabel,null,e.t("Event type")),n.createElement(c.Select,{value:(l==null?void 0:l.native.type)||"",disabled:e.readOnly,onChange:s=>b(o=>o.native.type=s.target.value),renderValue:s=>e.t(s)},["single","double","toggle"].map(s=>n.createElement(c.MenuItem,{key:s,value:s},n.createElement("div",null,n.createElement("div",null,e.t(s)),n.createElement("div",{className:e.classes.typeDescription},e.t(De[s])))))))),n.createElement("div",{className:e.classes.field},n.createElement(me._,{dateAdapter:ue.Z},n.createElement(ve.j,{label:e.t("Time"),value:I||null,disabled:e.readOnly,onChange:s=>{if(s)try{b(o=>{if(O==="once")o.native.start=Z(s.toDate(),"date",e.serverTimeZone);else if(O==="monthly"||O==="daily"){const f=w(o.native.cron),h=Z(s.toDate(),"cron",e.serverTimeZone);f.hours=h.hours,f.minutes=h.minutes,o.native.cron=N(f)}})}catch(o){}},renderInput:s=>n.createElement(c.TextField,be(Oe({},s),{variant:"standard",fullWidth:!0})),ampm:!1}))),(l==null?void 0:l.native.type)!=="single"&&n.createElement("div",{className:e.classes.field},n.createElement(c.TextField,{label:e.t("Duration"),value:(((i=l==null?void 0:l.native.intervals)==null?void 0:i[0].timeOffset)||0)/1e3/60,disabled:e.readOnly,onChange:s=>b(o=>o.native.intervals[0].timeOffset=s.target.value*1e3*60),variant:"standard",fullWidth:!0,InputProps:{endAdornment:n.createElement(c.InputAdornment,{position:"end"},e.t("minutes"))}})),n.createElement("div",{className:e.classes.field},n.createElement("div",{className:e.classes.selectId},n.createElement(c.TextField,{label:"Object ID",value:(l==null?void 0:l.native.oid)||"",disabled:e.readOnly,onChange:s=>{b(o=>o.native.oid=s.target.value),C(s.target.value)},variant:"standard",fullWidth:!0}),n.createElement(c.Button,{onClick:()=>r(!0)},"..."))),n.createElement("div",{className:e.classes.field},K("startValue",(l==null?void 0:l.native.type)==="toggle"?"First value":"Start value")),(l==null?void 0:l.native.type)==="double"&&n.createElement("div",{className:e.classes.field},K("endValue","End value")),n.createElement("div",{className:e.classes.field},n.createElement(c.FormControl,{fullWidth:!0,variant:"standard"},n.createElement(c.InputLabel,null,e.t("Period")),n.createElement(c.Select,{value:O||"once",disabled:e.readOnly,onChange:s=>{s.target.value!==l.native.cron&&b(o=>{if(s.target.value==="once")delete o.native.cron,o.native.start=Z(I,"date",e.serverTimeZone);else if(s.target.value==="daily"){delete o.native.start;const f=w("0 0 ? * 0-6"),h=Z(I,"cron",e.serverTimeZone);f.hours=h.hours,f.minutes=h.minutes,o.native.cron=N(f)}else if(s.target.value==="monthly"){delete o.native.start;const f=w("0 0 ? 1-12 ?"),h=Z(I,"cron",e.serverTimeZone);f.hours=h.hours,f.minutes=h.minutes,o.native.cron=N(f)}})}},["once","daily","monthly"].map(s=>n.createElement(c.MenuItem,{key:s,value:s},e.t(s)))))),O==="monthly"&&n.createElement("div",{className:e.classes.field},n.createElement("table",null,n.createElement("tr",null,new Array(12).fill(null).map((s,o)=>n.createElement("td",{className:e.classes.tableCell},L()().month(o).format("MMM")))),n.createElement("tr",null,new Array(12).fill(null).map((s,o)=>{var f;return n.createElement("td",null,n.createElement(c.Checkbox,{checked:((f=E==null?void 0:E.months)==null?void 0:f.includes(o+1))||!1,disabled:e.readOnly,onChange:h=>{b(j=>{const x=w(j.native.cron);h.target.checked?x.months.push(o+1):x.months=x.months.filter(z=>z!==o+1),j.native.cron=N(x)})},size:"small"}))})))),O==="daily"&&n.createElement("div",{className:e.classes.field},n.createElement("table",null,n.createElement("tr",null,new Array(7).fill(null).map((s,o)=>n.createElement("td",{className:e.classes.tableCell},L()().day(o).format("ddd")))),n.createElement("tr",null,new Array(7).fill(null).map((s,o)=>{var f;return n.createElement("td",null,n.createElement(c.Checkbox,{checked:((f=E==null?void 0:E.dows)==null?void 0:f.includes(o))||!1,disabled:e.readOnly,onChange:h=>{b(j=>{const x=w(j.native.cron);h.target.checked?x.dows.push(o):x.dows=x.dows.filter(z=>z!==o),j.native.cron=N(x)})},size:"small"}))})))),n.createElement("div",{className:e.classes.field},n.createElement(c.TextField,{label:"Description",value:(l==null?void 0:l.common.name)||"",disabled:e.readOnly,onChange:s=>b(o=>o.common.name=s.target.value),variant:"standard",fullWidth:!0})),n.createElement("div",{className:e.classes.field},n.createElement(M.ColorPicker,{value:(l==null?void 0:l.native.color)||"",disabled:e.readOnly,onChange:s=>b(o=>o.native.color=s),name:e.t("Color")}))),n.createElement(c.DialogActions,{className:e.classes.dialogActions},n.createElement(c.Button,{variant:"contained",color:"secondary",startIcon:n.createElement($.Delete,null),disabled:e.readOnly,onClick:()=>u(!0)},e.t("Delete")),n.createElement("div",{className:e.classes.dialogActionsRight},n.createElement(c.Button,{variant:"contained",color:"primary",disabled:JSON.stringify(e.event)===JSON.stringify(l)||e.readOnly,startIcon:n.createElement($.Save,null),onClick:()=>F(void 0,null,function*(){yield e.socket.setObject(l._id,l),e.updateEvents(),e.onClose()})},e.t("Save")),n.createElement(c.Button,{variant:"contained",color:"grey",startIcon:n.createElement($.Cancel,null),onClick:e.onClose},e.t("Cancel")))),v&&n.createElement(M.Confirm,{title:e.t("Delete event"),text:e.t("All data will be lost. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",onClose:s=>F(void 0,null,function*(){s&&(yield e.socket.delObject(l._id),e.updateEvents(),e.onClose()),u(!1)})}))};G.propTypes={classes:g().object.isRequired,socket:g().object.isRequired,open:g().bool.isRequired,onClose:g().func.isRequired,event:g().object,updateEvents:g().func.isRequired,serverTimeZone:g().number.isRequired,t:g().func.isRequired};var Te=(0,R.withStyles)(Se)(G),y=d(4819),B=(e,i,t)=>new Promise((r,l)=>{var D=v=>{try{m(t.next(v))}catch(u){l(u)}},a=v=>{try{m(t.throw(v))}catch(u){l(u)}},m=v=>v.done?r(v.value):Promise.resolve(v.value).then(D,a);m((t=t.apply(e,i)).next())});const we=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ze=({type:e,t:i})=>{const t=(0,T.useRef)(null);return(0,T.useEffect)(()=>{const r=new J._l(t.current,{eventData:()=>({id:e.type,title:i(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{r.destroy()}},[]),y.createElement("div",{style:{backgroundColor:"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:t},i(e.name))},xe=()=>({container:{display:"flex",height:"100%",width:"100%"},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function H(e){const[i,t]=(0,T.useState)(null),[r,l]=(0,T.useState)(null),D=e.events.map(a=>{var m,v,u;if(a.native.cron){const C=P(a.native.cron,"cron",e.serverTimeZone),E=w(a.native.cron);return C.setFullYear(1970),Array.isArray(E.months)?{id:a._id,title:a.common.name,backgroundColor:a.native.color,start:C,duration:((m=a.native.intervals)==null?void 0:m[0].timeOffset)||0,allDay:!1,rrule:{dtstart:new Date(C.getTime()-C.getTimezoneOffset()*6e4),freq:"daily",bymonth:E.months}}:Array.isArray(E.dows)?{id:a._id,title:a.common.name,backgroundColor:a.native.color,start:C,duration:((v=a.native.intervals)==null?void 0:v[0].timeOffset)||0,allDay:!1,display:"block",rrule:{dtstart:new Date(C.getTime()-C.getTimezoneOffset()*6e4),freq:"weekly",byweekday:E.dows.map(O=>O===0?6:O-1)}}:{id:a._id,title:a.common.name,backgroundColor:a.native.color}}return{id:a._id,title:a.common.name,display:"block",backgroundColor:a.native.color,start:P(a.native.start,"date",e.serverTimeZone),end:new Date(a.native.start).getTime()+(((u=a.native.intervals)==null?void 0:u[0].timeOffset)||0)}});return y.createElement(y.Fragment,null,y.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),y.createElement(Te,{open:!!i,event:e.events.find(a=>a._id===i),onClose:()=>t(null),socket:e.socket,updateEvents:e.updateEvents,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t}),y.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&y.createElement("div",{className:e.classes.leftBlock},y.createElement(c.Paper,{elevation:4,className:e.classes.leftPaper},y.createElement("div",{className:e.classes.leftContent},y.createElement("h4",null,e.t("Events")),we.map((a,m)=>y.createElement(Ze,{t:e.t,type:a,name:e.t(a.name),key:a.type,index:m})),y.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),y.createElement("hr",{className:e.classes.hr}),y.createElement("div",null,e.t("Use ALT by dragging it to copy the events."))))),y.createElement("div",{className:e.classes.calendarBlock},y.createElement("div",{className:e.classes.calendar},y.createElement(U.Z,{plugins:[_.Z,Y.Z,X.Z,J.ZP,q.Z],headerToolbar:e.hideTopBlock?!1:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:e.viewMode||localStorage.getItem("calendarView")||"dayGridMonth",initialDate:localStorage.getItem("calendarStart")?new Date(parseInt(localStorage.getItem("calendarStart"))):new Date,editable:!e.readOnly,selectable:!0,selectMirror:!0,dayMaxEvents:!0,events:D,height:"calc(100% - 20px)",locales:[p.Z,ee.Z,te.Z,ne.Z,le.Z,ae.Z,ie.Z,re.Z,se.Z,oe.Z],locale:e.language,datesSet:a=>{localStorage.setItem("calendarStart",a.view.currentStart.getTime()),localStorage.setItem("calendarView",a.view.type)},eventClick:a=>t(a.event.id),eventResize:a=>{var m;const v=e.events.find(u=>u._id===a.event.id);if((m=v.native.intervals)!=null&&m[0].timeOffset){const u=JSON.parse(JSON.stringify(v));u.native.intervals[0].timeOffset+=a.endDelta.milliseconds,e.socket.setObject(u._id,u),e.updateEvents()}else a.revert()},eventDrop:a=>B(this,null,function*(){var m;const v=e.events.find(u=>u._id===a.event.id);if((m=v==null?void 0:v.native)!=null&&m.cron){const u=JSON.parse(JSON.stringify(v));a.jsEvent.altKey&&(u._id=`fullcalendar.${e.instance}.event-${(0,A.Z)()}`);const C=w(u.native.cron),E=Z(a.event.start,"cron",e.serverTimeZone);C.hours=E.hours,C.minutes=E.minutes,u.native.cron=N(C),yield e.socket.setObject(u._id,u),e.updateEvents()}else{const u=JSON.parse(JSON.stringify(v));a.jsEvent.altKey&&(u._id=`fullcalendar.${e.instance}.event-${(0,A.Z)()}`),u.native.start=Z(a.event.start,"date",e.serverTimeZone),yield e.socket.setObject(u._id,u),e.updateEvents()}}),eventReceive:a=>B(this,null,function*(){const m={_id:`fullcalendar.${e.instance}.event-${(0,A.Z)()}`,common:{name:a.event.title,enabled:!0},native:{id:Date.now(),start:Z(a.event.start,"date",e.serverTimeZone),type:a.event.extendedProps.type,durationEditable:!1,oid:"",startValue:"",color:"#3A87AD"},type:"schedule"};a.event.extendedProps.type!=="single"&&(m.native.intervals=[{timeOffset:30*60*1e3}]),yield e.socket.setObject(m._id,m),e.updateEvents(),setTimeout(()=>t(m._id),100)}),dateClick:a=>B(this,null,function*(){if(r&&a.dateStr===r.dateStr&&Date.now()-r.ts<300){l(null);const m={_id:`fullcalendar.${e.instance}.event-${(0,A.Z)()}`,common:{name:e.t("Single event"),enabled:!0},native:{id:Date.now(),start:Z(a.date,"date",e.serverTimeZone),type:"single",durationEditable:!1,oid:"",startValue:"",color:"#3A87AD"},type:"schedule"};yield e.socket.setObject(m._id,m),yield e.updateEvents(),setTimeout(()=>t(m._id),100)}else l({dateStr:a.dateStr,ts:Date.now()})})})))))}H.propTypes={events:g().array,serverTimeZone:g().number,theme:g().object,socket:g().object,readOnly:g().bool,hideLeftBlock:g().bool,viewMode:g().bool,updateEvents:g().func,instance:g().oneOfType([g().string,g().number]),t:g().func.isRequired,language:g().string.isRequired};var ke=(0,R.withTheme)((0,R.withStyles)(xe)(H))}}]);

//# sourceMappingURL=src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1.9fe897d3.chunk.js.map