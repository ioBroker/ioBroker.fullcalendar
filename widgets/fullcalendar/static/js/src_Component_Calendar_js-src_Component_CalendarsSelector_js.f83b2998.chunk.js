"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{74095:function(Te,oe,u){u.d(oe,{Z:function(){return Xe}});var D=u(4819),Q=u(15854),E=u.n(Q),j=u(10651),V=u(58503),ve=u(76516),p=u(40387),fe=u(24990),X=u(44251),ge=u(33634),ee=u(51172),J=u(25177),Oe=u(33841),P=u(49582),te=u(36513),ne=u(4302),De=u(43007),Se=u(43223),Ie=u(96933),we=u(93484),xe=u(80809),m=u(94427),M=u(75606),ae=u(14853),Ne=u(98667),le=u.n(Ne),qe={},Pe=(e,r,n)=>new Promise((s,f)=>{var y=o=>{try{b(n.next(o))}catch(C){f(C)}},i=o=>{try{b(n.throw(o))}catch(C){f(C)}},b=o=>o.done?s(o.value):Promise.resolve(o.value).then(y,i);b((n=n.apply(e,r)).next())});function A(e){if(e==="*"||e==="?"||e==="")return e;const r=e.split(","),n=[];for(let s=0;s<r.length;s++){const f=r[s].match(/(\d+)-(\d+)/);if(f)for(let y=parseInt(f[1],10);y<=parseInt(f[2],10);y++)n.push(y);else n.push(parseInt(r[s],10))}return n}function B(e,r){const n={};if(r){const s=r.split(/\D/);n.seconds=[parseInt(s[5],10)],n.minutes=[parseInt(s[4],10)],n.hours=[parseInt(s[3],10)],n.dates=[parseInt(s[2],10)],n.months=[parseInt(s[1],10)],n.dows="?"}else{const s=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");s.length===6?(n.seconds=A(s[0]),n.minutes=A(s[1]),n.hours=A(s[2]),n.dates=A(s[3]),n.months=A(s[4]),n.dows=A(s[5])):(n.seconds=[0],n.minutes=A(s[0]),n.hours=A(s[1]),n.dates=A(s[2]),n.months=A(s[3]),n.dows=A(s[4]))}return n}function G(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort((f,y)=>f-y),e.length<3)return e.join(",");const r=[];let n=e[0],s=e[0];for(let f=1;f<e.length;f++)e[f]===s+1?s++:(n!==s?n+1===s?r.push(`${n},${s}`):r.push(`${n}-${s}`):r.push(n),n=e[f],s=e[f]);return n!==s?n+1===s?r.push(`${n},${s}`):r.push(`${n}-${s}`):r.push(n),r.join(",")}function U(e){const r=[];return e.seconds&&r.push(G(e.seconds)),r.push(G(e.minutes)),r.push(G(e.hours)),r.push(G(e.dates)),r.push(G(e.months)),r.push(G(e.dows)),r.join(" ")}function _(e,r){if(r==="cron"){const n=B(e),s=new Date;return s.setHours(n.hours[0]),s.setMinutes(n.minutes[0]),s.setSeconds(n.seconds[0]),Array.isArray(n.dows)&&s.setDate(s.getDate()+n.dows[0]-s.getDay()),s}return r==="date"?new Date(e):null}function $(e,r){if(r==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(r==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const n=e.toISOString();return n.substring(0,n.length-5)}return null}const x={},pe=null;function et(e,r,n){const s={};e.forEach(y=>{var i,b;const C=y.split(".")[1];s[C]=s[C]||[],r[y]&&((b=(i=r[y].common)==null?void 0:i.members)==null||b.forEach(k=>!n.includes(k)&&!s[C].includes(k)&&s[C].push(k)))});let f=[];return Object.keys(s).forEach((y,i)=>{const b=s[y];i?f=f.filter(o=>b.includes(o)):f=b}),f.filter((y,i)=>f.indexOf(y)===i)}function tt(e){var r,n,s,f,y,i;if(x[e]){if((r=x[e].common)!=null&&r.icon)return(n=x[e].common)==null?void 0:n.icon;if(x[e].type==="state"||x[e].type==="channel"){let b=e.split(".");b.pop();let o=b.join(".");if(x[o]&&((s=x[o].common)!=null&&s.icon))return(f=x[o].common)==null?void 0:f.icon;if(x[o]&&x[o].type==="channel"&&(b=e.split("."),b.pop(),o=b.join("."),x[o]&&((y=x[o].common)!=null&&y.icon)))return(i=x[o].common)==null?void 0:i.icon}}}function nt(e,r){return Pe(this,null,function*(){if(x[e]===void 0){try{x[e]=yield r.getObject(e)}catch(n){}x[e]=x[e]||null}return x[e]})}var Me=u(36105),ce=u.n(Me),at=u(63460),lt=u(79117),it=u(83994),st=u(28301),rt=u(19867),ot=u(68582),ct=u(37529),dt=u(69850),ut=u(15552),mt=u(97712),ke=u(92631),Ae=u(71373),Re=u(38809),de=u(59665),l=u(4819),Ze=Object.defineProperty,$e=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,Ee=(e,r,n)=>r in e?Ze(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,We=(e,r)=>{for(var n in r||(r={}))je.call(r,n)&&Ee(e,n,r[n]);if(he)for(var n of he(r))Be.call(r,n)&&Ee(e,n,r[n]);return e},Fe=(e,r)=>$e(e,Le(r)),ue=(e,r,n)=>new Promise((s,f)=>{var y=o=>{try{b(n.next(o))}catch(C){f(C)}},i=o=>{try{b(n.throw(o))}catch(C){f(C)}},b=o=>o.done?s(o.value):Promise.resolve(o.value).then(y,i);b((n=n.apply(e,r)).next())});const Ve={single:"single_description",double:"double_description",toggle:"toggle_description"},Ue={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},Ke=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function ze(e,r){return e&&typeof e=="object"?e[r]||e.en:e}function Je(e,r){return ue(this,null,function*(){let n;typeof e=="string"?n=yield r.getObject(e):n=e;let s=null;if(n&&n.common&&n.common.icon)s=M.Utils.getObjectIcon(n);else if(n.type==="state"){let f=n._id.split(".");f.pop();let y=f.join(".");n=yield r.getObject(y),n&&n.common&&n.common.icon?s=M.Utils.getObjectIcon(n):(!n||n.type==="channel"||n.type==="device")&&(f=n._id.split("."),f.pop(),y=f.join("."),n=yield r.getObject(y),n&&n.common&&n.common.icon&&(s=M.Utils.getObjectIcon(n)))}return s})}const ye=e=>{var r;const n=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,s=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[f,y]=(0,D.useState)(!1),[i,b]=(0,D.useState)(e.event),[o,C]=(0,D.useState)(null),[k,ie]=(0,D.useState)(!1),[K,se]=(0,D.useState)(n),[R,L]=(0,D.useState)(s),[t,h]=(0,D.useState)({});ce().locale(e.language);const d=(0,D.useCallback)(a=>{const c=JSON.parse(JSON.stringify(i));a(c),b(c)},[i]);(0,D.useEffect)(()=>{const a=new Date;a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0);const c=le().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude);if(h(c),i.native.oid){if(!o||o._id!==i.native.oid)try{e.socket.getObject(i.native.oid).then(g=>{JSON.stringify(i.native.states)!==JSON.stringify(g.common.states)&&d(O=>O.native.states=g.common.states),(o||e.event.native.oid!==i.native.oid)&&Je(g,e.socket).then(O=>d(F=>F.common.icon=O)),C(g)})}catch(g){console.error(`Cannot get object ${i.native.oid}: ${g}`),C(null)}}else C(null)},[i.native.oid,e.socket,d,i.native.states,o,e.event.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);const v=i.native.cron?B(i.native.cron):null;let T="once";Array.isArray(v==null?void 0:v.months)?T="monthly":Array.isArray(v==null?void 0:v.dows)&&(T="daily");let N;i&&(T==="once"?N=_(i.native.start,"date",e.serverTimeZone):(T==="monthly"||T==="daily")&&(N=_(i.native.cron,"cron",e.serverTimeZone)));const q=JSON.stringify(e.event)!==JSON.stringify(i)||K!==n||R!==s,re=(a,c)=>o?o.common.type==="boolean"?(a==="startValue"&&typeof i.native[a]!="boolean"&&setTimeout(()=>d(g=>g.native[a]=!!g.native[a]),100),l.createElement(m.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(m.Checkbox,{checked:!!i.native[a],disabled:e.readOnly,onChange:g=>d(O=>O.native[a]=g.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t(c)),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):o.common.states?l.createElement(m.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(m.InputLabel,null,e.t(c)),l.createElement(m.Select,{value:i.native[a]||"",disabled:e.readOnly,onChange:g=>d(O=>O.native[a]=g.target.value)},Object.keys(o.common.states).map(g=>l.createElement(m.MenuItem,{key:g,value:g},o.common.states[g])))):l.createElement(m.TextField,{className:e.classes.narrowText2,label:e.t(c),value:i.native[a]||"",disabled:e.readOnly,onChange:g=>d(O=>O.native[a]=g.target.value),variant:"standard"}):null,H=()=>o?o.common.type==="boolean"?(typeof R!="boolean"&&setTimeout(()=>L(!!R),100),l.createElement(m.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(m.Checkbox,{checked:!!R,disabled:e.readOnly,onChange:a=>L(a.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t("End value")),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):o.common.states?l.createElement(m.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(m.InputLabel,null,e.t("End value")),l.createElement(m.Select,{value:R||"",disabled:e.readOnly,onChange:a=>L(a.target.value)},Object.keys(o.common.states).map(a=>l.createElement(m.MenuItem,{key:a,value:a},o.common.states[a])))):l.createElement(m.TextField,{label:e.t("End value"),value:R||"",disabled:e.readOnly,onChange:a=>L(a.target.value),variant:"standard",className:e.classes.narrowText2}):null,z=((r=e.systemConfig)==null?void 0:r.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],Z=i.native.astro&&t?t[i.native.astro]:"",W=Z?Z.toLocaleTimeString().replace(/:\d\d$/,""):"";let w="";i.native.astro&&i.native.offset&&Z&&(w=new Date(Z.getTime()+i.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let S=i.common.icon;return S&&!S.startsWith("data:image")&&!S.startsWith("http")&&!S.startsWith("/")&&(S=`../../${S}`),l.createElement(m.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},l.createElement(m.DialogTitle,null,e.t("Configure event")),l.createElement(m.DialogContent,null,f&&l.createElement(M.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:a=>{d(c=>c.native.oid=a),y(!1)},onClose:()=>y(!1),socket:e.socket}),l.createElement("div",{className:e.classes.field},l.createElement(m.FormControlLabel,{control:l.createElement(m.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:a=>d(c=>c.common.enabled=a.target.checked)}),label:e.t("Active")})),l.createElement("div",{className:e.classes.field},l.createElement(m.FormControl,{variant:"standard",className:e.classes.timeType},l.createElement(m.InputLabel,null,e.t("Time type")),l.createElement(m.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:a=>d(c=>{a.target.value==="astro"?c.native.astro="sunrise":delete c.native.astro}),renderValue:a=>e.t(a)},["time","astro"].map(a=>l.createElement(m.MenuItem,{key:a,value:a},l.createElement("div",null,e.t(a)))))),i.native.astro?l.createElement(m.FormControl,{className:e.classes.narrowText,variant:"standard"},l.createElement(m.InputLabel,null,e.t("Astronomic event")),l.createElement(m.Select,{value:i.native.astro||"",onChange:a=>d(c=>c.native.astro=a.target.value),renderValue:a=>e.t(a)},Ke.map(a=>l.createElement(m.MenuItem,{key:a,value:a},l.createElement("div",{style:{display:"flex",width:"100%"}},l.createElement("span",null,e.t(a)),l.createElement("span",{style:{flexGrow:1}}),l.createElement("span",null," ","- [",t&&t[a]?t[a].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):l.createElement(Re._,{dateAdapter:Ae.Z},l.createElement(ke.j,{label:e.t("Time"),value:N||null,disabled:e.readOnly,onChange:a=>{if(a)try{d(c=>{if(T==="once")c.native.start=$(a.toDate(),"date",e.serverTimeZone);else if(T==="monthly"||T==="daily"){const g=B(c.native.cron),O=$(a.toDate(),"cron",e.serverTimeZone);g.hours=O.hours,g.minutes=O.minutes,c.native.cron=U(g)}})}catch(c){}},renderInput:a=>l.createElement(m.TextField,Fe(We({},a),{variant:"standard",className:e.classes.narrowText,helperText:N.getSeconds()?N.toLocaleTimeString():""})),ampm:!1})),i.native.astro?l.createElement(m.FormControl,{variant:"standard",className:e.classes.width60},l.createElement(m.InputLabel,null,e.t("Offset")),l.createElement(m.Select,{value:i.native.offset||0,disabled:e.readOnly,onChange:a=>d(c=>c.native.offset=a.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(a=>l.createElement(m.MenuItem,{key:a.value,value:a.value},a.value<0?`- ${e.t(a.label)}`:e.t(a.label))))):null,e.isSimulation&&l.createElement(m.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:a=>d(c=>c.native.timeRandomOffset=parseInt(a.target.value)),variant:"standard",InputProps:{endAdornment:l.createElement(m.InputAdornment,{position:"end"},e.t("ms"))}})),i.native.astro?l.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(i.native.astro),W),"\xA0",i.native.offset?e.t("With offset at %s.",w):null):null,l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(m.FormControl,{variant:"standard",className:e.classes.narrowText2},l.createElement(m.InputLabel,null,e.t("Event type")),l.createElement(m.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:a=>d(c=>c.native.type=a.target.value),renderValue:a=>e.t(a)},["single","double","toggle"].map(a=>l.createElement(m.MenuItem,{key:a,value:a},l.createElement("div",null,l.createElement("div",null,e.t(a)),l.createElement("div",{className:e.classes.typeDescription},e.t(Ve[a]))))))),i.native.type!=="single"&&l.createElement(m.TextField,{label:e.t("Duration"),value:K,disabled:e.readOnly,onChange:a=>se(a.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:l.createElement(m.InputAdornment,{position:"end"},e.t("minutes"))}})),l.createElement("div",{className:e.classes.field},l.createElement("div",{className:e.classes.selectId},l.createElement(M.Icon,{src:S||"",style:{width:32,height:32}}),l.createElement(m.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:a=>d(c=>c.native.oid=a.target.value),variant:"standard",helperText:ze((o==null?void 0:o.common.name)||"",e.language),fullWidth:!0}),l.createElement(m.Button,{onClick:()=>y(!0)},"..."))),l.createElement("div",{className:e.classes.field},re("startValue",i.native.type==="toggle"?"First value":i.native.type==="single"?"Desired value":"Start value"),i.native.type==="double"&&H()),l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(m.FormControl,{variant:"standard"},l.createElement(m.InputLabel,null,e.t("Period")),l.createElement(m.Select,{value:T||"once",disabled:e.readOnly,onChange:a=>{a.target.value!==i.native.cron&&d(c=>{if(a.target.value==="once")delete c.native.cron,c.native.start=$(N,"date",e.serverTimeZone);else if(a.target.value==="daily"){delete c.native.start;const g=B("0 0 ? * 0-6"),O=$(N,"cron",e.serverTimeZone);g.hours=O.hours,g.minutes=O.minutes,c.native.cron=U(g)}else if(a.target.value==="monthly"){delete c.native.start;const g=B("0 0 * 1-12 *"),O=$(N,"cron",e.serverTimeZone);g.hours=O.hours,g.minutes=O.minutes,c.native.cron=U(g)}})}},["once","daily","monthly"].map(a=>l.createElement(m.MenuItem,{key:a,value:a},e.t(a))))),T==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&l.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},l.createElement("thead",null,l.createElement("tr",null,z.map(a=>l.createElement("td",{key:a,className:e.classes.tableCell},ce()().day(a).format("ddd"))))),l.createElement("tbody",null,l.createElement("tr",null,z.map(a=>{var c;return l.createElement("td",{key:a},l.createElement(m.Checkbox,{checked:((c=v==null?void 0:v.dows)==null?void 0:c.includes(a))||!1,disabled:e.readOnly,onChange:g=>{d(O=>{const F=B(O.native.cron);g.target.checked?F.dows.push(a):F.dows=F.dows.filter(Y=>Y!==a),O.native.cron=U(F)})},size:"small"}))}))))),T==="monthly"&&l.createElement("div",{className:e.classes.field},l.createElement("table",null,l.createElement("thead",null,l.createElement("tr",null,new Array(12).fill(null).map((a,c)=>l.createElement("td",{key:c,className:e.classes.tableCell},ce()().month(c).format("MMM"))))),l.createElement("tbody",null,l.createElement("tr",null,new Array(12).fill(null).map((a,c)=>{var g;return l.createElement("td",{key:c},l.createElement(m.Checkbox,{checked:((g=v==null?void 0:v.months)==null?void 0:g.includes(c+1))||!1,disabled:e.readOnly,onChange:O=>{d(F=>{const Y=B(F.native.cron);O.target.checked?Y.months.push(c+1):Y.months=Y.months.filter(_e=>_e!==c+1),F.native.cron=U(Y)})},size:"small"}))}))))),l.createElement("div",{className:e.classes.field},l.createElement(m.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:a=>d(c=>c.common.name=a.target.value),variant:"standard",fullWidth:!0})),l.createElement("div",{className:e.classes.narrowColor},l.createElement(M.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:a=>d(c=>c.common.color=a),name:e.t("Color")}))),l.createElement(m.DialogActions,null,e.readOnly?null:l.createElement(m.Button,{variant:"contained",color:"secondary",startIcon:l.createElement(de.Delete,null),onClick:()=>ie(!0)},e.t("Delete")),!e.readOnly&&!e.widget?l.createElement("div",{style:{flex:1}}):null,e.readOnly?null:l.createElement(m.Button,{variant:"contained",color:"primary",disabled:!q,startIcon:l.createElement(de.Save,null),onClick:()=>ue(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(K)||1)*6e4,i.native.intervals[0].value=R):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(K)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),l.createElement(m.Button,{variant:"contained",color:"grey",startIcon:l.createElement(de.Cancel,null),onClick:e.onClose},e.readOnly||!q?e.t("ra_Close"):e.t("ra_Cancel"))),k&&l.createElement(M.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:a=>ue(void 0,null,function*(){if(a){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(c){window.alert(`Cannot delete event: ${c}`)}e.onClose()}ie(!1)})}))};ye.propTypes={systemConfig:E().object,classes:E().object.isRequired,socket:E().object.isRequired,onClose:E().func.isRequired,event:E().object,readOnly:E().bool,updateEvents:E().func.isRequired,serverTimeZone:E().number.isRequired,t:E().func.isRequired,language:E().string.isRequired,widget:E().bool,setEvent:E().func.isRequired,deleteEvent:E().func.isRequired};var Ge=(0,V.withStyles)(Ue)(ye),I=u(4819),me=(e,r,n)=>new Promise((s,f)=>{var y=o=>{try{b(n.next(o))}catch(C){f(C)}},i=o=>{try{b(n.throw(o))}catch(C){f(C)}},b=o=>o.done?s(o.value):Promise.resolve(o.value).then(y,i);b((n=n.apply(e,r)).next())});const He=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ye=({type:e,t:r,color:n})=>{const s=(0,D.useRef)(null);return(0,D.useEffect)(()=>{const f=new X._l(s.current,{eventData:()=>({id:e.type,title:r(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{f.destroy()}},[]),I.createElement("div",{style:{backgroundColor:n||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:s},r(e.name))},Qe=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function Ce(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function be(e){var r,n;const[s,f]=(0,D.useState)(null),y=e.storageName||"calendar",i=(0,D.useRef)(null),b=(0,D.useRef)(null),o=(0,D.useRef)(null),C=(0,D.useRef)(null),[k,ie]=(0,D.useState)({start:null,end:null});let K=(!e.widget&&window.localStorage.getItem(`${y}Start`),new Date),se=e.viewMode||window.localStorage.getItem(`${y}View`)||"dayGridMonth";e.isSimulation&&(K=new Date,se=((r=e.simulation)==null?void 0:r.native.interval)==="day"?"timeGridDay":"timeGridWeek");let R=He;e.isSimulation&&(R=R.filter(t=>t.type==="single"));const L=[];return e.events.forEach(t=>{var h,d,v,T,N,q,re;if(!t)return;const H=(h=t.native)!=null&&h.intervals&&t.native.intervals[0]&&t.native.intervals[0].timeOffset?t.native.intervals[0].timeOffset:30;t.common.color=t.common.color||"#3a87b2";const z=t.common.enabled?t.common.color:Ce(t.common.color);let Z=M.Utils.invertColor(t.common.color,!0);t.common.enabled||(Z=Ce(Z));let W=t.common.name;if(t.native.oid){let w=t.native.startValue;typeof w=="boolean"?w=w?M.I18n.t("ON"):M.I18n.t("OFF"):t.native.states&&t.native.states[w]&&(w=t.native.states[w]);let S=(v=(d=t.native.intervals)==null?void 0:d[0])==null?void 0:v.value;typeof S=="boolean"?S=S?M.I18n.t("ON"):M.I18n.t("OFF"):t.native.states&&t.native.states[S]&&(S=t.native.states[S]),W=`${t.common.name} \u2192 ${w}`,t.native.type==="double"&&(W+=` \u2192 ${(((N=(T=t.native.intervals)==null?void 0:T[0])==null?void 0:N.timeOffset)||0)/1e3/60} ${M.I18n.t("min")}. \u2192 ${S}`),t.native.type==="toggle"&&(W+=` \u2192 ${(((re=(q=t.native.intervals)==null?void 0:q[0])==null?void 0:re.timeOffset)||0)/1e3/60} ${M.I18n.t("min")}. \u2192 ${M.I18n.t("initial")}`)}if(t.native.cron){const w=_(t.native.cron,"cron",e.serverTimeZone),S=B(t.native.cron);w.setFullYear(new Date().getFullYear()-1),Array.isArray(S.months)?new ae.Ci({dtstart:w,until:k.end||new Date,freq:ae.Ci.WEEKLY,bymonth:S.months}).between(k.start||new Date,k.end||new Date).forEach(c=>{const g=t.native.astro?le().getTimes(c,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:c;t.native.astro&&t.native.offset&&g.setMinutes(g.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,backgroundColor:z,textColor:Z,start:g,duration:H,allDay:!1,display:"block"})}):Array.isArray(S.dows)?new ae.Ci({dtstart:w,until:k.end||new Date,freq:ae.Ci.WEEKLY,byweekday:S.dows.map(c=>c===0?6:c-1)}).between(k.start||new Date,k.end||new Date).forEach(c=>{const g=t.native.astro?le().getTimes(c,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:c;t.native.astro&&t.native.offset&&g.setMinutes(g.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,backgroundColor:z,textColor:Z,start:g,duration:H,allDay:!1,display:"block"})}):L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,duration:H,backgroundColor:z,textColor:Z,icon:t.common.icon})}else{const w=t.native.astro?le().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:t.native.start;t.native.astro&&t.native.offset&&w.setMinutes(w.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,display:"block",backgroundColor:z,textColor:Z,start:_(w,"date",e.serverTimeZone),end:_(new Date(new Date(w).getTime()+H),"date",e.serverTimeZone)})}}),(0,D.useEffect)(()=>{if(e.widget){const t=()=>{var h;const d=(h=i.current)==null?void 0:h.getApi();d&&(console.log("Scroll to now"),d.scrollToTime(new Date().getTime())),o.current?C.current=null:C.current=setTimeout(()=>t,3e5)};setTimeout(t,1e3)}return()=>{C.current&&clearTimeout(C.current),C.current=null,o.current&&clearTimeout(o.current),o.current=null}},[]),(0,D.useEffect)(()=>{var t,h;if(e.isSimulation){const d=(t=i.current)==null?void 0:t.getApi();d==null||d.changeView(((h=e.simulation)==null?void 0:h.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.isSimulation,(n=e.simulation)==null?void 0:n.native.interval]),e.isSimulation&&!e.simulation?null:I.createElement(I.Fragment,null,I.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),s?I.createElement(Ge,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(t=>t._id===s),onClose:()=>f(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,I.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&I.createElement("div",{className:e.classes.leftBlock},I.createElement(m.Paper,{elevation:4,className:e.classes.leftPaper},I.createElement("div",{className:e.classes.leftContent},I.createElement("h4",null,e.t("Events")),R.map((t,h)=>{var d,v;return I.createElement(Ye,{t:e.t,type:t,name:e.t(t.name),key:t.type,index:h,color:e.isSimulation?(v=(d=e.simulation)==null?void 0:d.common)==null?void 0:v.color:void 0})}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:I.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:I.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Use double click on calendar to add new events.")))),e.button),I.createElement("div",{className:e.classes.calendarBlock},I.createElement("div",{className:e.classes.calendar},I.createElement(ve.Z,{ref:i,plugins:[ee.Z,p.Z,fe.Z,X.ZP,ge.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:se,initialDate:K,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:L,height:"calc(100% - 20px)",locales:[J.Z,Oe.Z,P.Z,te.Z,ne.Z,De.Z,Se.Z,Ie.Z,we.Z,xe.Z],locale:e.language,datesSet:t=>{var h,d;(t.start.toString()!==((h=k.start)==null?void 0:h.toString())||t.end.toString()!==((d=k.end)==null?void 0:d.toString()))&&ie({start:t.start,end:t.end}),e.widget?(C.current&&clearTimeout(C.current),C.current=null,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{o.current=null;const v=()=>{var T;const N=(T=i.current)==null?void 0:T.getApi();N==null||N.scrollToTime(new Date().getTime()),o.current?C.current=null:C.current=setTimeout(()=>v,1e3*60*5)};v()},6e4)):window.localStorage.setItem(`${y}View`,t.view.type)},eventClick:t=>f(t.event.extendedProps.eventId),eventResize:t=>{var h;const d=e.events.find(v=>v._id===t.event.extendedProps.eventId);if((h=d.native.intervals)!=null&&h[0].timeOffset){const v=JSON.parse(JSON.stringify(d));v.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(v._id,v),e.updateEvents()}else t.revert()},eventDrop:t=>me(this,null,function*(){var h;const d=e.events.find(v=>v._id===t.event.extendedProps.eventId);if((h=d==null?void 0:d.native)!=null&&h.cron){const v=JSON.parse(JSON.stringify(d));t.jsEvent.altKey&&(v._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`);const T=B(v.native.cron),N=$(t.event.start,"cron",e.serverTimeZone);T.hours=N.hours,T.minutes=N.minutes,v.native.cron=U(T),yield e.setEvent(v._id,v),e.updateEvents()}else{const v=JSON.parse(JSON.stringify(d));t.jsEvent.altKey&&(v._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`),v.native.start=$(t.event.start,"date",e.serverTimeZone),yield e.setEvent(v._id,v),e.updateEvents()}}),eventReceive:t=>me(this,null,function*(){const h={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:t.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.event.start,"date",e.serverTimeZone),type:t.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(t.event.extendedProps.type!=="single"&&(h.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){h.common.color=e.simulation.common.color||h.common.color,delete h.native.start;const d=$(t.event.start,"cron",e.serverTimeZone);d.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[t.event.start.getDay()],d.dates=["?"],d.months=["*"],h.native.cron=U(d),h.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(h._id,h),e.updateEvents(),setTimeout(()=>f(h._id),100)}),eventDidMount:t=>{let h=t.event.extendedProps.icon;if(h){const d=window.document.createElement("img");!h.startsWith("data:image")&&!h.startsWith("http")&&!h.startsWith("/")&&(h=`../../${h}`),d.setAttribute("src",h),d.className="icon",d.style.width="20px",d.style.height="20px";const v=t.el.getElementsByClassName("fc-event-title-container");if(v.length){v[0].prepend(d);const T=v[0].getElementsByClassName("fc-event-title");T.length&&(T[0].style.marginLeft="23px")}}},select:t=>me(this,null,function*(){if(t.view.calendar.unselect(),e.readOnly)return;const d=t.end.getTime()-t.start.getTime();if((!b.current||Date.now()-b.current>500)&&d===30*60*1e3){b.current=Date.now();return}const v={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.date||t.start,"date",e.serverTimeZone),intervals:t.end&&!e.isSimulation?[{value:"",timeOffset:t.end.getTime()-t.start.getTime()}]:void 0,type:t.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(v.common.color=e.simulation.common.color||v.common.color),yield e.setEvent(v._id,v),yield e.updateEvents(),setTimeout(()=>f(v._id),100)})})))))}be.propTypes={events:E().array,serverTimeZone:E().number,systemConfig:E().object,theme:E().object,socket:E().object,readOnly:E().bool,hideLeftBlock:E().bool,hideTopBlock:E().bool,hideLeftBlockHint:E().bool,hideTopBlockButtons:E().bool,hideWeekends:E().bool,viewMode:E().bool,updateEvents:E().func,t:E().func.isRequired,widget:E().bool,language:E().string.isRequired,storageName:E().string,calendarPrefix:E().string,isSimulation:E().bool,simulationId:E().string,setEvent:E().func,button:E().any};var Xe=(0,V.withTheme)((0,V.withStyles)(Qe)(be))},82809:function(Te,oe,u){var D=u(4819),Q=u.n(D),E=u(15854),j=u.n(E),V=u(94427),ve=u.n(V),p=u(75606),fe=u.n(p),X=u(88411),ge=u.n(X);const ee=window.visRxWidget||X.VisRxWidget;class J extends Q().Component{constructor(P){super(P),this.state={list:[{value:"",label:ee.t("default")}]}}static getText(P){return typeof P=="object"?P[p.I18n.getLanguage()]||P.en:P}componentDidMount(){this.props.instance&&this.props.socket.getObjectViewSystem("folder",`fullcalendar.${this.props.instance}.Calendars.`,`fullcalendar.${this.props.instance}.Calendars.\u9999`).then(P=>{const te=Object.keys(P).map(ne=>({value:ne,label:J.getText(P[ne].common.name)}));te.unshift({value:"",label:ee.t("default")}),this.setState({list:te})})}render(){return Q().createElement(V.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:P=>this.props.onChange(P.target.value)},this.state.list.map(P=>Q().createElement(V.MenuItem,{key:P.value},P.label)))}}J.propTypes={value:j().string,socket:j().object,onChange:j().func,instance:j().number},oe.Z=J}}]);

//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.f83b2998.chunk.js.map