"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{83178:function(Ce,re,d){d.d(re,{Z:function(){return Qe}});var O=d(4819),Y=d(15854),h=d.n(Y),B=d(10651),F=d(58503),me=d(76516),q=d(40387),ve=d(24990),Q=d(44251),fe=d(33634),p=d(51172),z=d(25177),Oe=d(33841),x=d(49582),ee=d(36513),te=d(4302),Te=d(43007),De=d(43223),Se=d(96933),we=d(93484),xe=d(80809),u=d(94427),I=d(75606),ne=d(14853),Ie=d(98667),ae=d.n(Ie);function Pe(e,s){return e-s}function k(e){if(e==="*"||e==="?"||e==="")return e;const s=e.split(","),l=[];for(let o=0;o<s.length;o++){const y=s[o].match(/(\d+)-(\d+)/);if(y)for(let S=parseInt(y[1],10);S<=parseInt(y[2],10);S++)l.push(S);else l.push(parseInt(s[o],10))}return l}function R(e,s){const l={};if(s){const o=s.split(/\D/);l.seconds=[parseInt(o[5],10)],l.minutes=[parseInt(o[4],10)],l.hours=[parseInt(o[3],10)],l.dates=[parseInt(o[2],10)],l.months=[parseInt(o[1],10)],l.dows="?"}else{const o=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");o.length===6?(l.seconds=k(o[0]),l.minutes=k(o[1]),l.hours=k(o[2]),l.dates=k(o[3]),l.months=k(o[4]),l.dows=k(o[5])):(l.seconds=[0],l.minutes=k(o[0]),l.hours=k(o[1]),l.dates=k(o[2]),l.months=k(o[3]),l.dows=k(o[4]))}return l}function J(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(Pe),e.length<3)return e.join(",");const s=[];let l=e[0],o=e[0];for(let y=1;y<e.length;y++)e[y]===o+1?o++:(l!==o?l+1===o?s.push(`${l},${o}`):s.push(`${l}-${o}`):s.push(l),l=e[y],o=e[y]);return l!==o?l+1===o?s.push(`${l},${o}`):s.push(`${l}-${o}`):s.push(l),s.join(",")}function V(e){const s=["*","*","*","*","?"];return e.seconds&&(s[0]=J(e.seconds)),s[0]=J(e.minutes),s[1]=J(e.hours),s[2]=J(e.dates),s[3]=J(e.months),s[4]=J(e.dows),s.join(" ")}function X(e,s){if(s==="cron"){const l=R(e),o=new Date;return o.setHours(l.hours[0],l.minutes[0]),Array.isArray(l.dows)&&o.setDate(o.getDate()+l.dows[0]-o.getDay()),o}return s==="date"?new Date(e):null}function $(e,s){if(s==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(s==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const l=e.toISOString();return l.substring(0,l.length-5)}return null}var Ne=d(36105),oe=d.n(Ne),_e=d(63460),qe=d(79117),pe=d(83994),et=d(28301),tt=d(19867),nt=d(68582),at=d(37529),lt=d(69850),it=d(15552),st=d(97712),ke=d(92631),Me=d(71373),Ze=d(38809),ce=d(59665),a=d(4819),$e=Object.defineProperty,Ae=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,he=(e,s,l)=>s in e?$e(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,je=(e,s)=>{for(var l in s||(s={}))Be.call(s,l)&&he(e,l,s[l]);if(ge)for(var l of ge(s))Re.call(s,l)&&he(e,l,s[l]);return e},We=(e,s)=>Ae(e,Le(s)),de=(e,s,l)=>new Promise((o,y)=>{var S=f=>{try{N(l.next(f))}catch(C){y(C)}},i=f=>{try{N(l.throw(f))}catch(C){y(C)}},N=f=>f.done?o(f.value):Promise.resolve(f.value).then(S,i);N((l=l.apply(e,s)).next())});const Fe={single:"single_description",double:"double_description",toggle:"toggle_description"},Ve={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},Ue=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function Ke(e,s){return e&&typeof e=="object"?e[s]||e.en:e}function ze(e,s){return de(this,null,function*(){let l;typeof e=="string"?l=yield s.getObject(e):l=e;let o=null;if(l&&l.common&&l.common.icon)o=I.Utils.getObjectIcon(l);else if(l.type==="state"){let y=l._id.split(".");y.pop();let S=y.join(".");l=yield s.getObject(S),l&&l.common&&l.common.icon?o=I.Utils.getObjectIcon(l):(!l||l.type==="channel"||l.type==="device")&&(y=l._id.split("."),y.pop(),S=y.join("."),l=yield s.getObject(S),l&&l.common&&l.common.icon&&(o=I.Utils.getObjectIcon(l)))}return o})}const ye=e=>{var s;const l=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,o=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[y,S]=(0,O.useState)(!1),[i,N]=(0,O.useState)(e.event),[f,C]=(0,O.useState)(null),[A,le]=(0,O.useState)(!1),[U,ie]=(0,O.useState)(l),[M,L]=(0,O.useState)(o),[t,g]=(0,O.useState)({});oe().locale(e.language);const c=(0,O.useCallback)(n=>{const r=JSON.parse(JSON.stringify(i));n(r),N(r)},[i]);(0,O.useEffect)(()=>{const n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const r=ae().getTimes(n,e.systemConfig.latitude,e.systemConfig.longitude);if(g(r),i.native.oid){if(!f||f._id!==i.native.oid)try{e.socket.getObject(i.native.oid).then(v=>{JSON.stringify(i.native.states)!==JSON.stringify(v.common.states)&&c(b=>b.native.states=v.common.states),(f||e.event.native.oid!==i.native.oid)&&ze(v,e.socket).then(b=>c(W=>W.common.icon=b)),C(v)})}catch(v){console.error(`Cannot get object ${i.native.oid}: ${v}`),C(null)}}else C(null)},[i.native.oid,e.socket,c,i.native.states,f,e.event.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);const m=i.native.cron?R(i.native.cron):null;let E="once";Array.isArray(m==null?void 0:m.months)?E="monthly":Array.isArray(m==null?void 0:m.dows)&&(E="daily");let P;i&&(E==="once"?P=X(i.native.start,"date",e.serverTimeZone):(E==="monthly"||E==="daily")&&(P=X(i.native.cron,"cron",e.serverTimeZone)));const _=JSON.stringify(e.event)!==JSON.stringify(i)||U!==l||M!==o,se=(n,r)=>f?f.common.type==="boolean"?(n==="startValue"&&typeof i.native[n]!="boolean"&&setTimeout(()=>c(v=>v.native[n]=!!v.native[n]),100),a.createElement(u.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(u.Checkbox,{checked:!!i.native[n],disabled:e.readOnly,onChange:v=>c(b=>b.native[n]=v.target.checked)}),label:a.createElement("div",null,a.createElement("div",null,e.t(r)),a.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):f.common.states?a.createElement(u.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(u.InputLabel,null,e.t(r)),a.createElement(u.Select,{value:i.native[n]||"",disabled:e.readOnly,onChange:v=>c(b=>b.native[n]=v.target.value)},Object.keys(f.common.states).map(v=>a.createElement(u.MenuItem,{key:v,value:v},f.common.states[v])))):a.createElement(u.TextField,{className:e.classes.narrowText2,label:e.t(r),value:i.native[n]||"",disabled:e.readOnly,onChange:v=>c(b=>b.native[n]=v.target.value),variant:"standard"}):null,H=()=>f?f.common.type==="boolean"?(typeof M!="boolean"&&setTimeout(()=>L(!!M),100),a.createElement(u.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(u.Checkbox,{checked:!!M,disabled:e.readOnly,onChange:n=>L(n.target.checked)}),label:a.createElement("div",null,a.createElement("div",null,e.t("End value")),a.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):f.common.states?a.createElement(u.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(u.InputLabel,null,e.t("End value")),a.createElement(u.Select,{value:M||"",disabled:e.readOnly,onChange:n=>L(n.target.value)},Object.keys(f.common.states).map(n=>a.createElement(u.MenuItem,{key:n,value:n},f.common.states[n])))):a.createElement(u.TextField,{label:e.t("End value"),value:M||"",disabled:e.readOnly,onChange:n=>L(n.target.value),variant:"standard",className:e.classes.narrowText2}):null,K=((s=e.systemConfig)==null?void 0:s.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],Z=i.native.astro&&t?t[i.native.astro]:"",j=Z?Z.toLocaleTimeString().replace(/:\d\d$/,""):"";let w="";i.native.astro&&i.native.offset&&Z&&(w=new Date(Z.getTime()+i.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let T=i.common.icon;return T&&!T.startsWith("data:image")&&!T.startsWith("http")&&!T.startsWith("/")&&(T=`../../${T}`),a.createElement(u.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},a.createElement(u.DialogTitle,null,e.t("Configure event")),a.createElement(u.DialogContent,null,y&&a.createElement(I.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:n=>{c(r=>r.native.oid=n),S(!1)},onClose:()=>S(!1),socket:e.socket}),a.createElement("div",{className:e.classes.field},a.createElement(u.FormControlLabel,{control:a.createElement(u.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:n=>c(r=>r.common.enabled=n.target.checked)}),label:e.t("Active")})),a.createElement("div",{className:e.classes.field},a.createElement(u.FormControl,{variant:"standard",className:e.classes.timeType},a.createElement(u.InputLabel,null,e.t("Time type")),a.createElement(u.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:n=>c(r=>{n.target.value==="astro"?r.native.astro="sunrise":delete r.native.astro}),renderValue:n=>e.t(n)},["time","astro"].map(n=>a.createElement(u.MenuItem,{key:n,value:n},a.createElement("div",null,e.t(n)))))),i.native.astro?a.createElement(u.FormControl,{className:e.classes.narrowText,variant:"standard"},a.createElement(u.InputLabel,null,e.t("Astronomic event")),a.createElement(u.Select,{value:i.native.astro||"",onChange:n=>c(r=>r.native.astro=n.target.value),renderValue:n=>e.t(n)},Ue.map(n=>a.createElement(u.MenuItem,{key:n,value:n},a.createElement("div",{style:{display:"flex",width:"100%"}},a.createElement("span",null,e.t(n)),a.createElement("span",{style:{flexGrow:1}}),a.createElement("span",null," ","- [",t&&t[n]?t[n].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):a.createElement(Ze._,{dateAdapter:Me.Z},a.createElement(ke.j,{label:e.t("Time"),value:P||null,disabled:e.readOnly,onChange:n=>{if(n)try{c(r=>{if(E==="once")r.native.start=$(n.toDate(),"date",e.serverTimeZone);else if(E==="monthly"||E==="daily"){const v=R(r.native.cron),b=$(n.toDate(),"cron",e.serverTimeZone);v.hours=b.hours,v.minutes=b.minutes,r.native.cron=V(v)}})}catch(r){}},renderInput:n=>a.createElement(u.TextField,We(je({},n),{variant:"standard",className:e.classes.narrowText})),ampm:!1})),i.native.astro?a.createElement(u.FormControl,{variant:"standard",className:e.classes.width60},a.createElement(u.InputLabel,null,e.t("Offset")),a.createElement(u.Select,{value:i.native.offset||0,disabled:e.readOnly,onChange:n=>c(r=>r.native.offset=n.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(n=>a.createElement(u.MenuItem,{key:n.value,value:n.value},n.value<0?`- ${e.t(n.label)}`:e.t(n.label))))):null,e.isSimulation&&a.createElement(u.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:n=>c(r=>r.native.timeRandomOffset=parseInt(n.target.value)),variant:"standard",InputProps:{endAdornment:a.createElement(u.InputAdornment,{position:"end"},e.t("ms"))}})),i.native.astro?a.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(i.native.astro),j),"\xA0",i.native.offset?e.t("With offset at %s.",w):null):null,a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(u.FormControl,{variant:"standard",className:e.classes.narrowText2},a.createElement(u.InputLabel,null,e.t("Event type")),a.createElement(u.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:n=>c(r=>r.native.type=n.target.value),renderValue:n=>e.t(n)},["single","double","toggle"].map(n=>a.createElement(u.MenuItem,{key:n,value:n},a.createElement("div",null,a.createElement("div",null,e.t(n)),a.createElement("div",{className:e.classes.typeDescription},e.t(Fe[n]))))))),i.native.type!=="single"&&a.createElement(u.TextField,{label:e.t("Duration"),value:U,disabled:e.readOnly,onChange:n=>ie(n.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:a.createElement(u.InputAdornment,{position:"end"},e.t("minutes"))}})),a.createElement("div",{className:e.classes.field},a.createElement("div",{className:e.classes.selectId},a.createElement(I.Icon,{src:T||"",style:{width:32,height:32}}),a.createElement(u.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:n=>c(r=>r.native.oid=n.target.value),variant:"standard",helperText:Ke((f==null?void 0:f.common.name)||"",e.language),fullWidth:!0}),a.createElement(u.Button,{onClick:()=>S(!0)},"..."))),a.createElement("div",{className:e.classes.field},se("startValue",i.native.type==="toggle"?"First value":i.native.type==="single"?"Desired value":"Start value"),i.native.type==="double"&&H()),a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(u.FormControl,{variant:"standard"},a.createElement(u.InputLabel,null,e.t("Period")),a.createElement(u.Select,{value:E||"once",disabled:e.readOnly,onChange:n=>{n.target.value!==i.native.cron&&c(r=>{if(n.target.value==="once")delete r.native.cron,r.native.start=$(P,"date",e.serverTimeZone);else if(n.target.value==="daily"){delete r.native.start;const v=R("0 0 ? * 0-6"),b=$(P,"cron",e.serverTimeZone);v.hours=b.hours,v.minutes=b.minutes,r.native.cron=V(v)}else if(n.target.value==="monthly"){delete r.native.start;const v=R("0 0 ? 1-12 ?"),b=$(P,"cron",e.serverTimeZone);v.hours=b.hours,v.minutes=b.minutes,r.native.cron=V(v)}})}},["once","daily","monthly"].map(n=>a.createElement(u.MenuItem,{key:n,value:n},e.t(n))))),E==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&a.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},a.createElement("thead",null,a.createElement("tr",null,K.map(n=>a.createElement("td",{key:n,className:e.classes.tableCell},oe()().day(n).format("ddd"))))),a.createElement("tbody",null,a.createElement("tr",null,K.map(n=>{var r;return a.createElement("td",{key:n},a.createElement(u.Checkbox,{checked:((r=m==null?void 0:m.dows)==null?void 0:r.includes(n))||!1,disabled:e.readOnly,onChange:v=>{c(b=>{const W=R(b.native.cron);v.target.checked?W.dows.push(n):W.dows=W.dows.filter(G=>G!==n),b.native.cron=V(W)})},size:"small"}))}))))),E==="monthly"&&a.createElement("div",{className:e.classes.field},a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,new Array(12).fill(null).map((n,r)=>a.createElement("td",{key:r,className:e.classes.tableCell},oe()().month(r).format("MMM"))))),a.createElement("tbody",null,a.createElement("tr",null,new Array(12).fill(null).map((n,r)=>{var v;return a.createElement("td",{key:r},a.createElement(u.Checkbox,{checked:((v=m==null?void 0:m.months)==null?void 0:v.includes(r+1))||!1,disabled:e.readOnly,onChange:b=>{c(W=>{const G=R(W.native.cron);b.target.checked?G.months.push(r+1):G.months=G.months.filter(Xe=>Xe!==r+1),W.native.cron=V(G)})},size:"small"}))}))))),a.createElement("div",{className:e.classes.field},a.createElement(u.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:n=>c(r=>r.common.name=n.target.value),variant:"standard",fullWidth:!0})),a.createElement("div",{className:e.classes.narrowColor},a.createElement(I.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:n=>c(r=>r.common.color=n),name:e.t("Color")}))),a.createElement(u.DialogActions,null,e.readOnly?null:a.createElement(u.Button,{variant:"contained",color:"secondary",startIcon:a.createElement(ce.Delete,null),onClick:()=>le(!0)},e.t("Delete")),!e.readOnly&&!e.widget?a.createElement("div",{style:{flex:1}}):null,e.readOnly?null:a.createElement(u.Button,{variant:"contained",color:"primary",disabled:!_,startIcon:a.createElement(ce.Save,null),onClick:()=>de(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(U)||1)*6e4,i.native.intervals[0].value=M):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(U)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),a.createElement(u.Button,{variant:"contained",color:"grey",startIcon:a.createElement(ce.Cancel,null),onClick:e.onClose},e.readOnly||!_?e.t("ra_Close"):e.t("ra_Cancel"))),A&&a.createElement(I.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:n=>de(void 0,null,function*(){if(n){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(r){window.alert(`Cannot delete event: ${r}`)}e.onClose()}le(!1)})}))};ye.propTypes={systemConfig:h().object,classes:h().object.isRequired,socket:h().object.isRequired,onClose:h().func.isRequired,event:h().object,readOnly:h().bool,updateEvents:h().func.isRequired,serverTimeZone:h().number.isRequired,t:h().func.isRequired,language:h().string.isRequired,widget:h().bool,setEvent:h().func.isRequired,deleteEvent:h().func.isRequired};var Je=(0,F.withStyles)(Ve)(ye),D=d(4819),ue=(e,s,l)=>new Promise((o,y)=>{var S=f=>{try{N(l.next(f))}catch(C){y(C)}},i=f=>{try{N(l.throw(f))}catch(C){y(C)}},N=f=>f.done?o(f.value):Promise.resolve(f.value).then(S,i);N((l=l.apply(e,s)).next())});const He=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ge=({type:e,t:s,color:l})=>{const o=(0,O.useRef)(null);return(0,O.useEffect)(()=>{const y=new Q._l(o.current,{eventData:()=>({id:e.type,title:s(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{y.destroy()}},[]),D.createElement("div",{style:{backgroundColor:l||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:o},s(e.name))},Ye=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function Ee(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function be(e){var s,l;const[o,y]=(0,O.useState)(null),S=e.storageName||"calendar",i=(0,O.useRef)(null),N=(0,O.useRef)(null),f=(0,O.useRef)(null),C=(0,O.useRef)(null),[A,le]=(0,O.useState)({start:null,end:null});let U=(!e.widget&&window.localStorage.getItem(`${S}Start`),new Date),ie=e.viewMode||window.localStorage.getItem(`${S}View`)||"dayGridMonth";e.isSimulation&&(U=new Date,ie=((s=e.simulation)==null?void 0:s.native.interval)==="day"?"timeGridDay":"timeGridWeek");let M=He;e.isSimulation&&(M=M.filter(t=>t.type==="single"));const L=[];return e.events.forEach(t=>{var g,c,m,E,P,_,se;if(!t)return;const H=(g=t.native)!=null&&g.intervals&&t.native.intervals[0]&&t.native.intervals[0].timeOffset?t.native.intervals[0].timeOffset:30;t.common.color=t.common.color||"#3a87b2";const K=t.common.enabled?t.common.color:Ee(t.common.color);let Z=I.Utils.invertColor(t.common.color,!0);t.common.enabled||(Z=Ee(Z));let j=t.common.name;if(t.native.oid){let w=t.native.startValue;typeof w=="boolean"?w=w?I.I18n.t("ON"):I.I18n.t("OFF"):t.native.states&&t.native.states[w]&&(w=t.native.states[w]);let T=(m=(c=t.native.intervals)==null?void 0:c[0])==null?void 0:m.value;typeof T=="boolean"?T=T?I.I18n.t("ON"):I.I18n.t("OFF"):t.native.states&&t.native.states[T]&&(T=t.native.states[T]),j=`${t.common.name} \u2192 ${w}`,t.native.type==="double"&&(j+=` \u2192 ${(((P=(E=t.native.intervals)==null?void 0:E[0])==null?void 0:P.timeOffset)||0)/1e3/60} ${I.I18n.t("min")}. \u2192 ${T}`),t.native.type==="toggle"&&(j+=` \u2192 ${(((se=(_=t.native.intervals)==null?void 0:_[0])==null?void 0:se.timeOffset)||0)/1e3/60} ${I.I18n.t("min")}. \u2192 ${I.I18n.t("initial")}`)}if(t.native.cron){const w=X(t.native.cron,"cron",e.serverTimeZone),T=R(t.native.cron);w.setFullYear(new Date().getFullYear()-1),Array.isArray(T.months)?new ne.Ci({dtstart:w,until:A.end||new Date,freq:ne.Ci.WEEKLY,bymonth:T.months}).between(A.start||new Date,A.end||new Date).forEach(r=>{const v=t.native.astro?ae().getTimes(r,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:r;t.native.astro&&t.native.offset&&v.setMinutes(v.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:j,backgroundColor:K,textColor:Z,start:v,duration:H,allDay:!1,display:"block"})}):Array.isArray(T.dows)?new ne.Ci({dtstart:w,until:A.end||new Date,freq:ne.Ci.WEEKLY,byweekday:T.dows.map(r=>r===0?6:r-1)}).between(A.start||new Date,A.end||new Date).forEach(r=>{const v=t.native.astro?ae().getTimes(r,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:r;t.native.astro&&t.native.offset&&v.setMinutes(v.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:j,backgroundColor:K,textColor:Z,start:v,duration:H,allDay:!1,display:"block"})}):L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:j,duration:H,backgroundColor:K,textColor:Z,icon:t.common.icon})}else{const w=t.native.astro?ae().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:t.native.start;t.native.astro&&t.native.offset&&w.setMinutes(w.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:j,display:"block",backgroundColor:K,textColor:Z,start:X(w,"date",e.serverTimeZone),end:X(new Date(new Date(w).getTime()+H),"date",e.serverTimeZone)})}}),(0,O.useEffect)(()=>{if(e.widget){const t=()=>{var g;const c=(g=i.current)==null?void 0:g.getApi();c&&(console.log("Scroll to now"),c.scrollToTime(new Date().getTime())),f.current?C.current=null:C.current=setTimeout(()=>t,3e5)};setTimeout(t,1e3)}return()=>{C.current&&clearTimeout(C.current),C.current=null,f.current&&clearTimeout(f.current),f.current=null}},[]),(0,O.useEffect)(()=>{var t,g;if(e.isSimulation){const c=(t=i.current)==null?void 0:t.getApi();c==null||c.changeView(((g=e.simulation)==null?void 0:g.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.isSimulation,(l=e.simulation)==null?void 0:l.native.interval]),e.isSimulation&&!e.simulation?null:D.createElement(D.Fragment,null,D.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),o?D.createElement(Je,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(t=>t._id===o),onClose:()=>y(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,D.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&D.createElement("div",{className:e.classes.leftBlock},D.createElement(u.Paper,{elevation:4,className:e.classes.leftPaper},D.createElement("div",{className:e.classes.leftContent},D.createElement("h4",null,e.t("Events")),M.map((t,g)=>{var c,m;return D.createElement(Ge,{t:e.t,type:t,name:e.t(t.name),key:t.type,index:g,color:e.isSimulation?(m=(c=e.simulation)==null?void 0:c.common)==null?void 0:m.color:void 0})}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Use double click on calendar to add new events.")))),e.button),D.createElement("div",{className:e.classes.calendarBlock},D.createElement("div",{className:e.classes.calendar},D.createElement(me.Z,{ref:i,plugins:[p.Z,q.Z,ve.Z,Q.ZP,fe.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:ie,initialDate:U,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:L,height:"calc(100% - 20px)",locales:[z.Z,Oe.Z,x.Z,ee.Z,te.Z,Te.Z,De.Z,Se.Z,we.Z,xe.Z],locale:e.language,datesSet:t=>{var g,c;(t.start.toString()!==((g=A.start)==null?void 0:g.toString())||t.end.toString()!==((c=A.end)==null?void 0:c.toString()))&&le({start:t.start,end:t.end}),e.widget?(C.current&&clearTimeout(C.current),C.current=null,f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{f.current=null;const m=()=>{var E;const P=(E=i.current)==null?void 0:E.getApi();P==null||P.scrollToTime(new Date().getTime()),f.current?C.current=null:C.current=setTimeout(()=>m,1e3*60*5)};m()},6e4)):window.localStorage.setItem(`${S}View`,t.view.type)},eventClick:t=>y(t.event.extendedProps.eventId),eventResize:t=>{var g;const c=e.events.find(m=>m._id===t.event.extendedProps.eventId);if((g=c.native.intervals)!=null&&g[0].timeOffset){const m=JSON.parse(JSON.stringify(c));m.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(m._id,m),e.updateEvents()}else t.revert()},eventDrop:t=>ue(this,null,function*(){var g;const c=e.events.find(m=>m._id===t.event.extendedProps.eventId);if((g=c==null?void 0:c.native)!=null&&g.cron){const m=JSON.parse(JSON.stringify(c));t.jsEvent.altKey&&(m._id=`${e.calendarPrefix||e.simulationId}.event-${(0,B.Z)()}`);const E=R(m.native.cron),P=$(t.event.start,"cron",e.serverTimeZone);E.hours=P.hours,E.minutes=P.minutes,m.native.cron=V(E),yield e.setEvent(m._id,m),e.updateEvents()}else{const m=JSON.parse(JSON.stringify(c));t.jsEvent.altKey&&(m._id=`${e.calendarPrefix||e.simulationId}.event-${(0,B.Z)()}`),m.native.start=$(t.event.start,"date",e.serverTimeZone),yield e.setEvent(m._id,m),e.updateEvents()}}),eventReceive:t=>ue(this,null,function*(){const g={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,B.Z)()}`,common:{name:t.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.event.start,"date",e.serverTimeZone),type:t.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(t.event.extendedProps.type!=="single"&&(g.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){g.common.color=e.simulation.common.color||g.common.color,delete g.native.start;const c=$(t.event.start,"cron",e.serverTimeZone);c.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[t.event.start.getDay()],c.dates=["?"],c.months=["*"],g.native.cron=V(c),g.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(g._id,g),e.updateEvents(),setTimeout(()=>y(g._id),100)}),eventDidMount:t=>{let g=t.event.extendedProps.icon;if(g){const c=window.document.createElement("img");!g.startsWith("data:image")&&!g.startsWith("http")&&!g.startsWith("/")&&(g=`../../${g}`),c.setAttribute("src",g),c.className="icon",c.style.width="20px",c.style.height="20px";const m=t.el.getElementsByClassName("fc-event-title-container");if(m.length){m[0].prepend(c);const E=m[0].getElementsByClassName("fc-event-title");E.length&&(E[0].style.marginLeft="23px")}}},select:t=>ue(this,null,function*(){if(t.view.calendar.unselect(),e.readOnly)return;const c=t.end.getTime()-t.start.getTime();if((!N.current||Date.now()-N.current>500)&&c===30*60*1e3){N.current=Date.now();return}const m={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,B.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.date||t.start,"date",e.serverTimeZone),intervals:t.end&&!e.isSimulation?[{value:"",timeOffset:t.end.getTime()-t.start.getTime()}]:void 0,type:t.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(m.common.color=e.simulation.common.color||m.common.color),yield e.setEvent(m._id,m),yield e.updateEvents(),setTimeout(()=>y(m._id),100)})})))))}be.propTypes={events:h().array,serverTimeZone:h().number,systemConfig:h().object,theme:h().object,socket:h().object,readOnly:h().bool,hideLeftBlock:h().bool,hideTopBlock:h().bool,hideLeftBlockHint:h().bool,hideTopBlockButtons:h().bool,hideWeekends:h().bool,viewMode:h().bool,updateEvents:h().func,t:h().func.isRequired,widget:h().bool,language:h().string.isRequired,storageName:h().string,calendarPrefix:h().string,isSimulation:h().bool,simulationId:h().string,setEvent:h().func,button:h().any};var Qe=(0,F.withTheme)((0,F.withStyles)(Ye)(be))},82809:function(Ce,re,d){var O=d(4819),Y=d.n(O),h=d(15854),B=d.n(h),F=d(94427),me=d.n(F),q=d(75606),ve=d.n(q),Q=d(88411),fe=d.n(Q);const p=window.visRxWidget||Q.VisRxWidget;class z extends Y().Component{constructor(x){super(x),this.state={list:[{value:"",label:p.t("default")}]}}static getText(x){return typeof x=="object"?x[q.I18n.getLanguage()]||x.en:x}componentDidMount(){this.props.instance&&this.props.socket.getObjectViewSystem("folder",`fullcalendar.${this.props.instance}.Calendars.`,`fullcalendar.${this.props.instance}.Calendars.\u9999`).then(x=>{const ee=Object.keys(x).map(te=>({value:te,label:z.getText(x[te].common.name)}));ee.unshift({value:"",label:p.t("default")}),this.setState({list:ee})})}render(){return Y().createElement(F.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:x=>this.props.onChange(x.target.value)},this.state.list.map(x=>Y().createElement(F.MenuItem,{key:x.value},x.label)))}}z.propTypes={value:B().string,socket:B().object,onChange:B().func,instance:B().number},re.Z=z}}]);

//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.0f7e42f8.chunk.js.map