"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1"],{83178:function(Xe,ce,u){u.d(ce,{Z:function(){return Ye}});var S=u(4819),de=u(15854),h=u.n(de),Y=u(10651),q=u(58503),ue=u(76516),me=u(40387),ve=u(24990),ae=u(44251),fe=u(33634),ge=u(51172),he=u(25177),ye=u(33841),Ee=u(49582),be=u(36513),Ce=u(4302),Te=u(43007),Oe=u(43223),we=u(96933),De=u(93484),Se=u(80809),d=u(94427),I=u(75606),Q=u(14853),xe=u(98667),X=u.n(xe);function Ie(e,s){return e-s}function $(e){if(e==="*"||e==="?"||e==="")return e;const s=e.split(","),l=[];for(let o=0;o<s.length;o++){const y=s[o].match(/(\d+)-(\d+)/);if(y)for(let C=parseInt(y[1],10);C<=parseInt(y[2],10);C++)l.push(C);else l.push(parseInt(s[o],10))}return l}function A(e,s){const l={};if(s){const o=s.split(/\D/);l.seconds=[parseInt(o[5],10)],l.minutes=[parseInt(o[4],10)],l.hours=[parseInt(o[3],10)],l.dates=[parseInt(o[2],10)],l.months=[parseInt(o[1],10)],l.dows="?"}else{const o=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");o.length===6?(l.seconds=$(o[0]),l.minutes=$(o[1]),l.hours=$(o[2]),l.dates=$(o[3]),l.months=$(o[4]),l.dows=$(o[5])):(l.seconds=[0],l.minutes=$(o[0]),l.hours=$(o[1]),l.dates=$(o[2]),l.months=$(o[3]),l.dows=$(o[4]))}return l}function W(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(Ie),e.length<3)return e.join(",");const s=[];let l=e[0],o=e[0];for(let y=1;y<e.length;y++)e[y]===o+1?o++:(l!==o?l+1===o?s.push(`${l},${o}`):s.push(`${l}-${o}`):s.push(l),l=e[y],o=e[y]);return l!==o?l+1===o?s.push(`${l},${o}`):s.push(`${l}-${o}`):s.push(l),s.join(",")}function M(e){const s=["*","*","*","*","?"];return e.seconds&&(s[0]=W(e.seconds)),s[0]=W(e.minutes),s[1]=W(e.hours),s[2]=W(e.dates),s[3]=W(e.months),s[4]=W(e.dows),s.join(" ")}function H(e,s){if(s==="cron"){const l=A(e),o=new Date;return o.setHours(l.hours[0],l.minutes[0]),Array.isArray(l.dows)&&o.setDate(o.getDate()+l.dows[0]-o.getDay()),o}return s==="date"?new Date(e):null}function P(e,s){if(s==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(s==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const l=e.toISOString();return l.substring(0,l.length-5)}return null}var Ne=u(36105),_=u.n(Ne),qe=u(63460),_e=u(79117),pe=u(83994),et=u(28301),tt=u(19867),nt=u(68582),at=u(37529),lt=u(69850),it=u(15552),st=u(97712),ke=u(92631),Ze=u(71373),$e=u(38809),p=u(59665),a=u(4819),Pe=Object.defineProperty,Ae=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,ie=(e,s,l)=>s in e?Pe(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,Le=(e,s)=>{for(var l in s||(s={}))je.call(s,l)&&ie(e,l,s[l]);if(le)for(var l of le(s))Be.call(s,l)&&ie(e,l,s[l]);return e},Me=(e,s)=>Ae(e,Fe(s)),ee=(e,s,l)=>new Promise((o,y)=>{var C=v=>{try{D(l.next(v))}catch(T){y(T)}},i=v=>{try{D(l.throw(v))}catch(T){y(T)}},D=v=>v.done?o(v.value):Promise.resolve(v.value).then(C,i);D((l=l.apply(e,s)).next())});const Re={single:"single_description",double:"double_description",toggle:"toggle_description"},We={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},Ve=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function ze(e,s){return e&&typeof e=="object"?e[s]||e.en:e}function Je(e,s){return ee(this,null,function*(){let l;typeof e=="string"?l=yield s.getObject(e):l=e;let o=null;if(l&&l.common&&l.common.icon)o=I.Utils.getObjectIcon(l);else if(l.type==="state"){let y=l._id.split(".");y.pop();let C=y.join(".");l=yield s.getObject(C),l&&l.common&&l.common.icon?o=I.Utils.getObjectIcon(l):(!l||l.type==="channel"||l.type==="device")&&(y=l._id.split("."),y.pop(),C=y.join("."),l=yield s.getObject(C),l&&l.common&&l.common.icon&&(o=I.Utils.getObjectIcon(l)))}return o})}const se=e=>{var s;const l=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,o=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[y,C]=(0,S.useState)(!1),[i,D]=(0,S.useState)(e.event),[v,T]=(0,S.useState)(null),[ne,G]=(0,S.useState)(!1),[R,U]=(0,S.useState)(l),[k,n]=(0,S.useState)(o),[m,f]=(0,S.useState)({});_().locale(e.language);const c=t=>{const r=JSON.parse(JSON.stringify(i));t(r),D(r)};(0,S.useEffect)(()=>{const t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);const r=X().getTimes(t,e.systemConfig.latitude,e.systemConfig.longitude);if(f(r),i.native.oid){if(!v||v._id!==i.native.oid)try{e.socket.getObject(i.native.oid).then(g=>{JSON.stringify(i.native.states)!==JSON.stringify(g.common.states)&&c(E=>E.native.states=g.common.states),(v||e.event.native.oid!==i.native.oid)&&Je(g,e.socket).then(E=>c(L=>L.common.icon=E)),T(g)})}catch(g){console.error(`Cannot get object ${i.native.oid}: ${g}`),T(null)}}else T(null)},[i.native.oid,e.socket]);const b=i.native.cron?A(i.native.cron):null;let O="once";Array.isArray(b==null?void 0:b.months)?O="monthly":Array.isArray(b==null?void 0:b.dows)&&(O="daily");let F;i&&(O==="once"?F=H(i.native.start,"date",e.serverTimeZone):(O==="monthly"||O==="daily")&&(F=H(i.native.cron,"cron",e.serverTimeZone)));const K=JSON.stringify(e.event)!==JSON.stringify(i)||R!==l||k!==o,V=(t,r)=>v?v.common.type==="boolean"?(t==="startValue"&&typeof i.native[t]!="boolean"&&setTimeout(()=>c(g=>g.native[t]=!!g.native[t]),100),a.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(d.Checkbox,{checked:!!i.native[t],disabled:e.readOnly,onChange:g=>c(E=>E.native[t]=g.target.checked)}),label:a.createElement("div",null,a.createElement("div",null,e.t(r)),a.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):v.common.states?a.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(d.InputLabel,null,e.t(r)),a.createElement(d.Select,{value:i.native[t]||"",disabled:e.readOnly,onChange:g=>c(E=>E.native[t]=g.target.value)},Object.keys(v.common.states).map(g=>a.createElement(d.MenuItem,{key:g,value:g},v.common.states[g])))):a.createElement(d.TextField,{className:e.classes.narrowText2,label:e.t(r),value:i.native[t]||"",disabled:e.readOnly,onChange:g=>c(E=>E.native[t]=g.target.value),variant:"standard"}):null,z=()=>v?v.common.type==="boolean"?(typeof k!="boolean"&&setTimeout(()=>n(!!k),100),a.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:a.createElement(d.Checkbox,{checked:!!k,disabled:e.readOnly,onChange:t=>n(t.target.checked)}),label:a.createElement("div",null,a.createElement("div",null,e.t("End value")),a.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):v.common.states?a.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},a.createElement(d.InputLabel,null,e.t("End value")),a.createElement(d.Select,{value:k||"",disabled:e.readOnly,onChange:t=>n(t.target.value)},Object.keys(v.common.states).map(t=>a.createElement(d.MenuItem,{key:t,value:t},v.common.states[t])))):a.createElement(d.TextField,{label:e.t("End value"),value:k||"",disabled:e.readOnly,onChange:t=>n(t.target.value),variant:"standard",className:e.classes.narrowText2}):null,j=((s=e.systemConfig)==null?void 0:s.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],Z=i.native.astro&&m?m[i.native.astro]:"",x=Z?Z.toLocaleTimeString().replace(/:\d\d$/,""):"";let N="";i.native.astro&&i.native.offset&&Z&&(N=new Date(Z.getTime()+i.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let B=i.common.icon;return B&&!B.startsWith("data:image")&&!B.startsWith("http")&&!B.startsWith("/")&&(B=`../../${B}`),a.createElement(d.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},a.createElement(d.DialogTitle,null,e.t("Configure event")),a.createElement(d.DialogContent,null,y&&a.createElement(I.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:t=>{c(r=>r.native.oid=t),C(!1)},onClose:()=>C(!1),socket:e.socket}),a.createElement("div",{className:e.classes.field},a.createElement(d.FormControlLabel,{control:a.createElement(d.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:t=>c(r=>r.common.enabled=t.target.checked)}),label:e.t("Active")})),a.createElement("div",{className:e.classes.field},a.createElement(d.FormControl,{variant:"standard",className:e.classes.timeType},a.createElement(d.InputLabel,null,e.t("Time type")),a.createElement(d.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:t=>c(r=>{t.target.value==="astro"?r.native.astro="sunrise":delete r.native.astro}),renderValue:t=>e.t(t)},["time","astro"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},a.createElement("div",null,e.t(t)))))),i.native.astro?a.createElement(d.FormControl,{className:e.classes.narrowText,variant:"standard"},a.createElement(d.InputLabel,null,e.t("Astronomic event")),a.createElement(d.Select,{value:i.native.astro||"",onChange:t=>c(r=>r.native.astro=t.target.value),renderValue:t=>e.t(t)},Ve.map(t=>a.createElement(d.MenuItem,{key:t,value:t},a.createElement("div",{style:{display:"flex",width:"100%"}},a.createElement("span",null,e.t(t)),a.createElement("span",{style:{flexGrow:1}}),a.createElement("span",null," ","- [",m&&m[t]?m[t].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):a.createElement($e._,{dateAdapter:Ze.Z},a.createElement(ke.j,{label:e.t("Time"),value:F||null,disabled:e.readOnly,onChange:t=>{if(t)try{c(r=>{if(O==="once")r.native.start=P(t.toDate(),"date",e.serverTimeZone);else if(O==="monthly"||O==="daily"){const g=A(r.native.cron),E=P(t.toDate(),"cron",e.serverTimeZone);g.hours=E.hours,g.minutes=E.minutes,r.native.cron=M(g)}})}catch(r){}},renderInput:t=>a.createElement(d.TextField,Me(Le({},t),{variant:"standard",className:e.classes.narrowText})),ampm:!1})),i.native.astro?a.createElement(d.FormControl,{variant:"standard",className:e.classes.width60},a.createElement(d.InputLabel,null,e.t("Offset")),a.createElement(d.Select,{value:i.native.offset||0,disabled:e.readOnly,onChange:t=>c(r=>r.native.offset=t.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(t=>a.createElement(d.MenuItem,{key:t.value,value:t.value},t.value<0?`- ${e.t(t.label)}`:e.t(t.label))))):null,e.isSimulation&&a.createElement(d.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:t=>c(r=>r.native.timeRandomOffset=parseInt(t.target.value)),variant:"standard",InputProps:{endAdornment:a.createElement(d.InputAdornment,{position:"end"},e.t("ms"))}})),i.native.astro?a.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(i.native.astro),x),"\xA0",i.native.offset?e.t("With offset at %s.",N):null):null,a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},a.createElement(d.InputLabel,null,e.t("Event type")),a.createElement(d.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:t=>c(r=>r.native.type=t.target.value),renderValue:t=>e.t(t)},["single","double","toggle"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},a.createElement("div",null,a.createElement("div",null,e.t(t)),a.createElement("div",{className:e.classes.typeDescription},e.t(Re[t]))))))),i.native.type!=="single"&&a.createElement(d.TextField,{label:e.t("Duration"),value:R,disabled:e.readOnly,onChange:t=>U(t.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:a.createElement(d.InputAdornment,{position:"end"},e.t("minutes"))}})),a.createElement("div",{className:e.classes.field},a.createElement("div",{className:e.classes.selectId},a.createElement(I.Icon,{src:B||"",style:{width:32,height:32}}),a.createElement(d.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:t=>c(r=>r.native.oid=t.target.value),variant:"standard",helperText:ze((v==null?void 0:v.common.name)||"",e.language),fullWidth:!0}),a.createElement(d.Button,{onClick:()=>C(!0)},"..."))),a.createElement("div",{className:e.classes.field},V("startValue",i.native.type==="toggle"?"First value":i.native.type==="single"?"Desired value":"Start value"),i.native.type==="double"&&z()),a.createElement("div",{className:e.classes.field},!e.isSimulation&&a.createElement(d.FormControl,{variant:"standard"},a.createElement(d.InputLabel,null,e.t("Period")),a.createElement(d.Select,{value:O||"once",disabled:e.readOnly,onChange:t=>{t.target.value!==i.native.cron&&c(r=>{if(t.target.value==="once")delete r.native.cron,r.native.start=P(F,"date",e.serverTimeZone);else if(t.target.value==="daily"){delete r.native.start;const g=A("0 0 ? * 0-6"),E=P(F,"cron",e.serverTimeZone);g.hours=E.hours,g.minutes=E.minutes,r.native.cron=M(g)}else if(t.target.value==="monthly"){delete r.native.start;const g=A("0 0 ? 1-12 ?"),E=P(F,"cron",e.serverTimeZone);g.hours=E.hours,g.minutes=E.minutes,r.native.cron=M(g)}})}},["once","daily","monthly"].map(t=>a.createElement(d.MenuItem,{key:t,value:t},e.t(t))))),O==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&a.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},a.createElement("thead",null,a.createElement("tr",null,j.map(t=>a.createElement("td",{key:t,className:e.classes.tableCell},_()().day(t).format("ddd"))))),a.createElement("tbody",null,a.createElement("tr",null,j.map(t=>{var r;return a.createElement("td",{key:t},a.createElement(d.Checkbox,{checked:((r=b==null?void 0:b.dows)==null?void 0:r.includes(t))||!1,disabled:e.readOnly,onChange:g=>{c(E=>{const L=A(E.native.cron);g.target.checked?L.dows.push(t):L.dows=L.dows.filter(J=>J!==t),E.native.cron=M(L)})},size:"small"}))}))))),O==="monthly"&&a.createElement("div",{className:e.classes.field},a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,new Array(12).fill(null).map((t,r)=>a.createElement("td",{key:r,className:e.classes.tableCell},_()().month(r).format("MMM"))))),a.createElement("tbody",null,a.createElement("tr",null,new Array(12).fill(null).map((t,r)=>{var g;return a.createElement("td",{key:r},a.createElement(d.Checkbox,{checked:((g=b==null?void 0:b.months)==null?void 0:g.includes(r+1))||!1,disabled:e.readOnly,onChange:E=>{c(L=>{const J=A(L.native.cron);E.target.checked?J.months.push(r+1):J.months=J.months.filter(Qe=>Qe!==r+1),L.native.cron=M(J)})},size:"small"}))}))))),a.createElement("div",{className:e.classes.field},a.createElement(d.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:t=>c(r=>r.common.name=t.target.value),variant:"standard",fullWidth:!0})),a.createElement("div",{className:e.classes.narrowColor},a.createElement(I.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:t=>c(r=>r.common.color=t),name:e.t("Color")}))),a.createElement(d.DialogActions,null,e.readOnly?null:a.createElement(d.Button,{variant:"contained",color:"secondary",startIcon:a.createElement(p.Delete,null),onClick:()=>G(!0)},e.t("Delete")),!e.readOnly&&!e.widget?a.createElement("div",{style:{flex:1}}):null,e.readOnly?null:a.createElement(d.Button,{variant:"contained",color:"primary",disabled:!K,startIcon:a.createElement(p.Save,null),onClick:()=>ee(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(R)||1)*6e4,i.native.intervals[0].value=k):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(R)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),a.createElement(d.Button,{variant:"contained",color:"grey",startIcon:a.createElement(p.Cancel,null),onClick:e.onClose},e.readOnly||!K?e.t("ra_Close"):e.t("ra_Cancel"))),ne&&a.createElement(I.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:t=>ee(void 0,null,function*(){if(t){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(r){window.alert(`Cannot delete event: ${r}`)}e.onClose()}G(!1)})}))};se.propTypes={systemConfig:h().object,classes:h().object.isRequired,socket:h().object.isRequired,onClose:h().func.isRequired,event:h().object,readOnly:h().bool,updateEvents:h().func.isRequired,serverTimeZone:h().number.isRequired,t:h().func.isRequired,language:h().string.isRequired,widget:h().bool,setEvent:h().func.isRequired,deleteEvent:h().func.isRequired};var He=(0,q.withStyles)(We)(se),w=u(4819),te=(e,s,l)=>new Promise((o,y)=>{var C=v=>{try{D(l.next(v))}catch(T){y(T)}},i=v=>{try{D(l.throw(v))}catch(T){y(T)}},D=v=>v.done?o(v.value):Promise.resolve(v.value).then(C,i);D((l=l.apply(e,s)).next())});const Ge=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Ue=({type:e,t:s,color:l})=>{const o=(0,S.useRef)(null);return(0,S.useEffect)(()=>{const y=new ae._l(o.current,{eventData:()=>({id:e.type,title:s(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{y.destroy()}},[]),w.createElement("div",{style:{backgroundColor:l||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:o},s(e.name))},Ke=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function re(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function oe(e){var s;const[l,o]=(0,S.useState)(null),y=e.storageName||"calendar",C=(0,S.useRef)(null),i=(0,S.useRef)(null),D=(0,S.useRef)(null),v=(0,S.useRef)(null),[T,ne]=(0,S.useState)({start:null,end:null});let G=(!e.widget&&window.localStorage.getItem(`${y}Start`),new Date),R=e.viewMode||window.localStorage.getItem(`${y}View`)||"dayGridMonth";e.isSimulation&&(G=new Date,R=((s=e.simulation)==null?void 0:s.native.interval)==="day"?"timeGridDay":"timeGridWeek");let U=Ge;e.isSimulation&&(U=U.filter(n=>n.type==="single"));const k=[];return e.events.forEach(n=>{var m,f,c,b,O,F,K;if(!n)return;const V=(m=n.native)!=null&&m.intervals&&n.native.intervals[0]&&n.native.intervals[0].timeOffset?n.native.intervals[0].timeOffset:30;n.common.color=n.common.color||"#3a87b2";const z=n.common.enabled?n.common.color:re(n.common.color);let j=I.Utils.invertColor(n.common.color,!0);n.common.enabled||(j=re(j));let Z=n.common.name;if(n.native.oid){let x=n.native.startValue;typeof x=="boolean"?x=x?I.I18n.t("ON"):I.I18n.t("OFF"):n.native.states&&n.native.states[x]&&(x=n.native.states[x]);let N=(c=(f=n.native.intervals)==null?void 0:f[0])==null?void 0:c.value;typeof N=="boolean"?N=N?I.I18n.t("ON"):I.I18n.t("OFF"):n.native.states&&n.native.states[N]&&(N=n.native.states[N]),Z=`${n.common.name} \u2192 ${x}`,n.native.type==="double"&&(Z+=` \u2192 ${(((O=(b=n.native.intervals)==null?void 0:b[0])==null?void 0:O.timeOffset)||0)/1e3/60} ${I.I18n.t("min")}. \u2192 ${N}`),n.native.type==="toggle"&&(Z+=` \u2192 ${(((K=(F=n.native.intervals)==null?void 0:F[0])==null?void 0:K.timeOffset)||0)/1e3/60} ${I.I18n.t("min")}. \u2192 ${I.I18n.t("initial")}`)}if(n.native.cron){const x=H(n.native.cron,"cron",e.serverTimeZone),N=A(n.native.cron);x.setFullYear(new Date().getFullYear()-1),Array.isArray(N.months)?new Q.Ci({dtstart:x,until:T.end||new Date,freq:Q.Ci.WEEKLY,bymonth:N.months}).between(T.start||new Date,T.end||new Date).forEach(t=>{const r=n.native.astro?X().getTimes(t,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:t;n.native.astro&&n.native.offset&&r.setMinutes(r.getMinutes()+n.native.offset),k.push({extendedProps:{eventId:n._id,icon:n.common.icon},title:Z,backgroundColor:z,textColor:j,start:r,duration:V,allDay:!1,display:"block"})}):Array.isArray(N.dows)?new Q.Ci({dtstart:x,until:T.end||new Date,freq:Q.Ci.WEEKLY,byweekday:N.dows.map(t=>t===0?6:t-1)}).between(T.start||new Date,T.end||new Date).forEach(t=>{const r=n.native.astro?X().getTimes(t,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:t;n.native.astro&&n.native.offset&&r.setMinutes(r.getMinutes()+n.native.offset),k.push({extendedProps:{eventId:n._id,icon:n.common.icon},title:Z,backgroundColor:z,textColor:j,start:r,duration:V,allDay:!1,display:"block"})}):k.push({extendedProps:{eventId:n._id,icon:n.common.icon},title:Z,duration:V,backgroundColor:z,textColor:j,icon:n.common.icon})}else{const x=n.native.astro?X().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:n.native.start;n.native.astro&&n.native.offset&&x.setMinutes(x.getMinutes()+n.native.offset),k.push({extendedProps:{eventId:n._id,icon:n.common.icon},title:Z,display:"block",backgroundColor:z,textColor:j,start:H(x,"date",e.serverTimeZone),end:H(new Date(new Date(x).getTime()+V),"date",e.serverTimeZone)})}}),(0,S.useEffect)(()=>{if(e.widget){const n=()=>{var m;const f=(m=C.current)==null?void 0:m.getApi();f&&(console.log("Scroll to now"),f.scrollToTime(new Date().getTime())),D.current?v.current=null:v.current=setTimeout(()=>n,3e5)};setTimeout(n,1e3)}return()=>{v.current&&clearTimeout(v.current),v.current=null,D.current&&clearTimeout(D.current),D.current=null}},[]),(0,S.useEffect)(()=>{var n,m;if(e.isSimulation){const f=(n=C.current)==null?void 0:n.getApi();f==null||f.changeView(((m=e.simulation)==null?void 0:m.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.simulations,e.simulationId]),e.isSimulation&&!e.simulation?null:w.createElement(w.Fragment,null,w.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),l?w.createElement(He,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(n=>n._id===l),onClose:()=>o(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,w.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&w.createElement("div",{className:e.classes.leftBlock},w.createElement(d.Paper,{elevation:4,className:e.classes.leftPaper},w.createElement("div",{className:e.classes.leftContent},w.createElement("h4",null,e.t("Events")),U.map((n,m)=>{var f,c;return w.createElement(Ue,{t:e.t,type:n,name:e.t(n.name),key:n.type,index:m,color:e.isSimulation?(c=(f=e.simulation)==null?void 0:f.common)==null?void 0:c.color:void 0})}),e.hideLeftBlockHint?null:w.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:w.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:w.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:w.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:w.createElement("div",null,e.t("Use double click on calendar to add new events.")))),e.button),w.createElement("div",{className:e.classes.calendarBlock},w.createElement("div",{className:e.classes.calendar},w.createElement(ue.Z,{ref:C,plugins:[ge.Z,me.Z,ve.Z,ae.ZP,fe.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:R,initialDate:G,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:k,height:"calc(100% - 20px)",locales:[he.Z,ye.Z,Ee.Z,be.Z,Ce.Z,Te.Z,Oe.Z,we.Z,De.Z,Se.Z],locale:e.language,datesSet:n=>{var m,f;(n.start.toString()!==((m=T.start)==null?void 0:m.toString())||n.end.toString()!==((f=T.end)==null?void 0:f.toString()))&&ne({start:n.start,end:n.end}),e.widget?(v.current&&clearTimeout(v.current),v.current=null,D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{D.current=null;const c=()=>{var b;const O=(b=C.current)==null?void 0:b.getApi();O==null||O.scrollToTime(new Date().getTime()),D.current?v.current=null:v.current=setTimeout(()=>c,1e3*60*5)};c()},6e4)):window.localStorage.setItem(`${y}View`,n.view.type)},eventClick:n=>o(n.event.extendedProps.eventId),eventResize:n=>{var m;const f=e.events.find(c=>c._id===n.event.extendedProps.eventId);if((m=f.native.intervals)!=null&&m[0].timeOffset){const c=JSON.parse(JSON.stringify(f));c.native.intervals[0].timeOffset+=n.endDelta.milliseconds,e.setEvent(c._id,c),e.updateEvents()}else n.revert()},eventDrop:n=>te(this,null,function*(){var m;const f=e.events.find(c=>c._id===n.event.extendedProps.eventId);if((m=f==null?void 0:f.native)!=null&&m.cron){const c=JSON.parse(JSON.stringify(f));n.jsEvent.altKey&&(c._id=`${e.calendarPrefix||e.simulationId}.event-${(0,Y.Z)()}`);const b=A(c.native.cron),O=P(n.event.start,"cron",e.serverTimeZone);b.hours=O.hours,b.minutes=O.minutes,c.native.cron=M(b),yield e.setEvent(c._id,c),e.updateEvents()}else{const c=JSON.parse(JSON.stringify(f));n.jsEvent.altKey&&(c._id=`${e.calendarPrefix||e.simulationId}.event-${(0,Y.Z)()}`),c.native.start=P(n.event.start,"date",e.serverTimeZone),yield e.setEvent(c._id,c),e.updateEvents()}}),eventReceive:n=>te(this,null,function*(){const m={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,Y.Z)()}`,common:{name:n.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:P(n.event.start,"date",e.serverTimeZone),type:n.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(n.event.extendedProps.type!=="single"&&(m.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){m.common.color=e.simulation.common.color||m.common.color,delete m.native.start;const f=P(n.event.start,"cron",e.serverTimeZone);f.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[n.event.start.getDay()],f.dates=["?"],f.months=["*"],m.native.cron=M(f),m.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(m._id,m),e.updateEvents(),setTimeout(()=>o(m._id),100)}),eventDidMount:n=>{let m=n.event.extendedProps.icon;if(m){const f=window.document.createElement("img");!m.startsWith("data:image")&&!m.startsWith("http")&&!m.startsWith("/")&&(m=`../../${m}`),f.setAttribute("src",m),f.className="icon",f.style.width="20px",f.style.height="20px";const c=n.el.getElementsByClassName("fc-event-title-container");if(c.length){c[0].prepend(f);const b=c[0].getElementsByClassName("fc-event-title");b.length&&(b[0].style.marginLeft="23px")}}},select:n=>te(this,null,function*(){if(n.view.calendar.unselect(),e.readOnly)return;const f=n.end.getTime()-n.start.getTime();if((!i.current||Date.now()-i.current>500)&&f===30*60*1e3){i.current=Date.now();return}const c={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,Y.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:P(n.date||n.start,"date",e.serverTimeZone),intervals:n.end&&!e.isSimulation?[{value:"",timeOffset:n.end.getTime()-n.start.getTime()}]:void 0,type:n.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(c.common.color=e.simulation.common.color||c.common.color),yield e.setEvent(c._id,c),yield e.updateEvents(),setTimeout(()=>o(c._id),100)})})))))}oe.propTypes={events:h().array,serverTimeZone:h().number,systemConfig:h().object,theme:h().object,socket:h().object,readOnly:h().bool,hideLeftBlock:h().bool,hideTopBlock:h().bool,hideLeftBlockHint:h().bool,hideTopBlockButtons:h().bool,hideWeekends:h().bool,viewMode:h().bool,updateEvents:h().func,t:h().func.isRequired,widget:h().bool,language:h().string.isRequired,storageName:h().string,calendarPrefix:h().string,isSimulation:h().bool,simulationId:h().string,setEvent:h().func,button:h().any};var Ye=(0,q.withTheme)((0,q.withStyles)(Ke)(oe))}}]);

//# sourceMappingURL=src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1.a940a13b.chunk.js.map