"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{74095:function(Oe,oe,u){u.d(oe,{Z:function(){return _e}});var D=u(4819),Q=u(15854),E=u.n(Q),j=u(10651),V=u(58503),ve=u(76516),p=u(40387),fe=u(24990),X=u(44251),ge=u(33634),ee=u(51172),J=u(25177),Te=u(33841),N=u(49582),te=u(36513),ne=u(4302),De=u(43007),Se=u(43223),Ie=u(96933),we=u(93484),xe=u(80809),m=u(94427),P=u(75606),ae=u(14853),Ne=u(98667),le=u.n(Ne),pe={},Pe=(e,s,a)=>new Promise((r,g)=>{var y=o=>{try{b(a.next(o))}catch(C){g(C)}},i=o=>{try{b(a.throw(o))}catch(C){g(C)}},b=o=>o.done?r(o.value):Promise.resolve(o.value).then(y,i);b((a=a.apply(e,s)).next())});function Me(e,s){return e-s}function A(e){if(e==="*"||e==="?"||e==="")return e;const s=e.split(","),a=[];for(let r=0;r<s.length;r++){const g=s[r].match(/(\d+)-(\d+)/);if(g)for(let y=parseInt(g[1],10);y<=parseInt(g[2],10);y++)a.push(y);else a.push(parseInt(s[r],10))}return a}function B(e,s){const a={};if(s){const r=s.split(/\D/);a.seconds=[parseInt(r[5],10)],a.minutes=[parseInt(r[4],10)],a.hours=[parseInt(r[3],10)],a.dates=[parseInt(r[2],10)],a.months=[parseInt(r[1],10)],a.dows="?"}else{const r=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");r.length===6?(a.seconds=A(r[0]),a.minutes=A(r[1]),a.hours=A(r[2]),a.dates=A(r[3]),a.months=A(r[4]),a.dows=A(r[5])):(a.seconds=[0],a.minutes=A(r[0]),a.hours=A(r[1]),a.dates=A(r[2]),a.months=A(r[3]),a.dows=A(r[4]))}return a}function G(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(Me),e.length<3)return e.join(",");const s=[];let a=e[0],r=e[0];for(let g=1;g<e.length;g++)e[g]===r+1?r++:(a!==r?a+1===r?s.push(`${a},${r}`):s.push(`${a}-${r}`):s.push(a),a=e[g],r=e[g]);return a!==r?a+1===r?s.push(`${a},${r}`):s.push(`${a}-${r}`):s.push(a),s.join(",")}function U(e){const s=["*","*","*","*","?"];return e.seconds&&(s[0]=G(e.seconds)),s[0]=G(e.minutes),s[1]=G(e.hours),s[2]=G(e.dates),s[3]=G(e.months),s[4]=G(e.dows),s.join(" ")}function _(e,s){if(s==="cron"){const a=B(e),r=new Date;return r.setHours(a.hours[0],a.minutes[0]),Array.isArray(a.dows)&&r.setDate(r.getDate()+a.dows[0]-r.getDay()),r}return s==="date"?new Date(e):null}function $(e,s){if(s==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(s==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const a=e.toISOString();return a.substring(0,a.length-5)}return null}const x={},et=null;function tt(e,s,a){const r={};e.forEach(y=>{var i,b;const C=y.split(".")[1];r[C]=r[C]||[],s[y]&&((b=(i=s[y].common)==null?void 0:i.members)==null||b.forEach(k=>!a.includes(k)&&!r[C].includes(k)&&r[C].push(k)))});let g=[];return Object.keys(r).forEach((y,i)=>{const b=r[y];i?g=g.filter(o=>b.includes(o)):g=b}),g.filter((y,i)=>g.indexOf(y)===i)}function nt(e){var s,a,r,g,y,i;if(x[e]){if((s=x[e].common)!=null&&s.icon)return(a=x[e].common)==null?void 0:a.icon;if(x[e].type==="state"||x[e].type==="channel"){let b=e.split(".");b.pop();let o=b.join(".");if(x[o]&&((r=x[o].common)!=null&&r.icon))return(g=x[o].common)==null?void 0:g.icon;if(x[o]&&x[o].type==="channel"&&(b=e.split("."),b.pop(),o=b.join("."),x[o]&&((y=x[o].common)!=null&&y.icon)))return(i=x[o].common)==null?void 0:i.icon}}}function at(e,s){return Pe(this,null,function*(){if(x[e]===void 0){try{x[e]=yield s.getObject(e)}catch(a){}x[e]=x[e]||null}return x[e]})}var ke=u(36105),ce=u.n(ke),lt=u(63460),it=u(79117),st=u(83994),rt=u(28301),ot=u(19867),ct=u(68582),dt=u(37529),ut=u(69850),mt=u(15552),vt=u(97712),Ae=u(92631),Re=u(71373),Ze=u(38809),de=u(59665),l=u(4819),$e=Object.defineProperty,Le=Object.defineProperties,je=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,Ee=(e,s,a)=>s in e?$e(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,Fe=(e,s)=>{for(var a in s||(s={}))Be.call(s,a)&&Ee(e,a,s[a]);if(he)for(var a of he(s))We.call(s,a)&&Ee(e,a,s[a]);return e},Ve=(e,s)=>Le(e,je(s)),ue=(e,s,a)=>new Promise((r,g)=>{var y=o=>{try{b(a.next(o))}catch(C){g(C)}},i=o=>{try{b(a.throw(o))}catch(C){g(C)}},b=o=>o.done?r(o.value):Promise.resolve(o.value).then(y,i);b((a=a.apply(e,s)).next())});const Ue={single:"single_description",double:"double_description",toggle:"toggle_description"},Ke={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:120},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}},ze=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function Je(e,s){return e&&typeof e=="object"?e[s]||e.en:e}function Ge(e,s){return ue(this,null,function*(){let a;typeof e=="string"?a=yield s.getObject(e):a=e;let r=null;if(a&&a.common&&a.common.icon)r=P.Utils.getObjectIcon(a);else if(a.type==="state"){let g=a._id.split(".");g.pop();let y=g.join(".");a=yield s.getObject(y),a&&a.common&&a.common.icon?r=P.Utils.getObjectIcon(a):(!a||a.type==="channel"||a.type==="device")&&(g=a._id.split("."),g.pop(),y=g.join("."),a=yield s.getObject(y),a&&a.common&&a.common.icon&&(r=P.Utils.getObjectIcon(a)))}return r})}const ye=e=>{var s;const a=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,r=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[g,y]=(0,D.useState)(!1),[i,b]=(0,D.useState)(e.event),[o,C]=(0,D.useState)(null),[k,ie]=(0,D.useState)(!1),[K,se]=(0,D.useState)(a),[R,L]=(0,D.useState)(r),[t,h]=(0,D.useState)({});ce().locale(e.language);const d=(0,D.useCallback)(n=>{const c=JSON.parse(JSON.stringify(i));n(c),b(c)},[i]);(0,D.useEffect)(()=>{const n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const c=le().getTimes(n,e.systemConfig.latitude,e.systemConfig.longitude);if(h(c),i.native.oid){if(!o||o._id!==i.native.oid)try{e.socket.getObject(i.native.oid).then(f=>{JSON.stringify(i.native.states)!==JSON.stringify(f.common.states)&&d(T=>T.native.states=f.common.states),(o||e.event.native.oid!==i.native.oid)&&Ge(f,e.socket).then(T=>d(F=>F.common.icon=T)),C(f)})}catch(f){console.error(`Cannot get object ${i.native.oid}: ${f}`),C(null)}}else C(null)},[i.native.oid,e.socket,d,i.native.states,o,e.event.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);const v=i.native.cron?B(i.native.cron):null;let O="once";Array.isArray(v==null?void 0:v.months)?O="monthly":Array.isArray(v==null?void 0:v.dows)&&(O="daily");let M;i&&(O==="once"?M=_(i.native.start,"date",e.serverTimeZone):(O==="monthly"||O==="daily")&&(M=_(i.native.cron,"cron",e.serverTimeZone)));const q=JSON.stringify(e.event)!==JSON.stringify(i)||K!==a||R!==r,re=(n,c)=>o?o.common.type==="boolean"?(n==="startValue"&&typeof i.native[n]!="boolean"&&setTimeout(()=>d(f=>f.native[n]=!!f.native[n]),100),l.createElement(m.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(m.Checkbox,{checked:!!i.native[n],disabled:e.readOnly,onChange:f=>d(T=>T.native[n]=f.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t(c)),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):o.common.states?l.createElement(m.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(m.InputLabel,null,e.t(c)),l.createElement(m.Select,{value:i.native[n]||"",disabled:e.readOnly,onChange:f=>d(T=>T.native[n]=f.target.value)},Object.keys(o.common.states).map(f=>l.createElement(m.MenuItem,{key:f,value:f},o.common.states[f])))):l.createElement(m.TextField,{className:e.classes.narrowText2,label:e.t(c),value:i.native[n]||"",disabled:e.readOnly,onChange:f=>d(T=>T.native[n]=f.target.value),variant:"standard"}):null,H=()=>o?o.common.type==="boolean"?(typeof R!="boolean"&&setTimeout(()=>L(!!R),100),l.createElement(m.FormControlLabel,{className:e.classes.narrowText2,control:l.createElement(m.Checkbox,{checked:!!R,disabled:e.readOnly,onChange:n=>L(n.target.checked)}),label:l.createElement("div",null,l.createElement("div",null,e.t("End value")),l.createElement("div",{style:{fontSize:10,fontStyle:"italic"}},e.t("Checked means ON, unchecked means OFF")))})):o.common.states?l.createElement(m.FormControl,{className:e.classes.narrowText2,variant:"standard"},l.createElement(m.InputLabel,null,e.t("End value")),l.createElement(m.Select,{value:R||"",disabled:e.readOnly,onChange:n=>L(n.target.value)},Object.keys(o.common.states).map(n=>l.createElement(m.MenuItem,{key:n,value:n},o.common.states[n])))):l.createElement(m.TextField,{label:e.t("End value"),value:R||"",disabled:e.readOnly,onChange:n=>L(n.target.value),variant:"standard",className:e.classes.narrowText2}):null,z=((s=e.systemConfig)==null?void 0:s.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],Z=i.native.astro&&t?t[i.native.astro]:"",W=Z?Z.toLocaleTimeString().replace(/:\d\d$/,""):"";let w="";i.native.astro&&i.native.offset&&Z&&(w=new Date(Z.getTime()+i.native.offset*6e4).toLocaleTimeString().replace(/:\d\d$/,""));let S=i.common.icon;return S&&!S.startsWith("data:image")&&!S.startsWith("http")&&!S.startsWith("/")&&(S=`../../${S}`),l.createElement(m.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},l.createElement(m.DialogTitle,null,e.t("Configure event")),l.createElement(m.DialogContent,null,g&&l.createElement(P.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:n=>{d(c=>c.native.oid=n),y(!1)},onClose:()=>y(!1),socket:e.socket}),l.createElement("div",{className:e.classes.field},l.createElement(m.FormControlLabel,{control:l.createElement(m.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:n=>d(c=>c.common.enabled=n.target.checked)}),label:e.t("Active")})),l.createElement("div",{className:e.classes.field},l.createElement(m.FormControl,{variant:"standard",className:e.classes.timeType},l.createElement(m.InputLabel,null,e.t("Time type")),l.createElement(m.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:n=>d(c=>{n.target.value==="astro"?c.native.astro="sunrise":delete c.native.astro}),renderValue:n=>e.t(n)},["time","astro"].map(n=>l.createElement(m.MenuItem,{key:n,value:n},l.createElement("div",null,e.t(n)))))),i.native.astro?l.createElement(m.FormControl,{className:e.classes.narrowText,variant:"standard"},l.createElement(m.InputLabel,null,e.t("Astronomic event")),l.createElement(m.Select,{value:i.native.astro||"",onChange:n=>d(c=>c.native.astro=n.target.value),renderValue:n=>e.t(n)},ze.map(n=>l.createElement(m.MenuItem,{key:n,value:n},l.createElement("div",{style:{display:"flex",width:"100%"}},l.createElement("span",null,e.t(n)),l.createElement("span",{style:{flexGrow:1}}),l.createElement("span",null," ","- [",t&&t[n]?t[n].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]")))))):l.createElement(Ze._,{dateAdapter:Re.Z},l.createElement(Ae.j,{label:e.t("Time"),value:M||null,disabled:e.readOnly,onChange:n=>{if(n)try{d(c=>{if(O==="once")c.native.start=$(n.toDate(),"date",e.serverTimeZone);else if(O==="monthly"||O==="daily"){const f=B(c.native.cron),T=$(n.toDate(),"cron",e.serverTimeZone);f.hours=T.hours,f.minutes=T.minutes,c.native.cron=U(f)}})}catch(c){}},renderInput:n=>l.createElement(m.TextField,Ve(Fe({},n),{variant:"standard",className:e.classes.narrowText})),ampm:!1})),i.native.astro?l.createElement(m.FormControl,{variant:"standard",className:e.classes.width60},l.createElement(m.InputLabel,null,e.t("Offset")),l.createElement(m.Select,{value:i.native.offset||0,disabled:e.readOnly,onChange:n=>d(c=>c.native.offset=n.target.value)},[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map(n=>l.createElement(m.MenuItem,{key:n.value,value:n.value},n.value<0?`- ${e.t(n.label)}`:e.t(n.label))))):null,e.isSimulation&&l.createElement(m.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:n=>d(c=>c.native.timeRandomOffset=parseInt(n.target.value)),variant:"standard",InputProps:{endAdornment:l.createElement(m.InputAdornment,{position:"end"},e.t("ms"))}})),i.native.astro?l.createElement("div",{className:e.classes.field},e.t("Today %s is at %s.",e.t(i.native.astro),W),"\xA0",i.native.offset?e.t("With offset at %s.",w):null):null,l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(m.FormControl,{variant:"standard",className:e.classes.narrowText2},l.createElement(m.InputLabel,null,e.t("Event type")),l.createElement(m.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:n=>d(c=>c.native.type=n.target.value),renderValue:n=>e.t(n)},["single","double","toggle"].map(n=>l.createElement(m.MenuItem,{key:n,value:n},l.createElement("div",null,l.createElement("div",null,e.t(n)),l.createElement("div",{className:e.classes.typeDescription},e.t(Ue[n]))))))),i.native.type!=="single"&&l.createElement(m.TextField,{label:e.t("Duration"),value:K,disabled:e.readOnly,onChange:n=>se(n.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:l.createElement(m.InputAdornment,{position:"end"},e.t("minutes"))}})),l.createElement("div",{className:e.classes.field},l.createElement("div",{className:e.classes.selectId},l.createElement(P.Icon,{src:S||"",style:{width:32,height:32}}),l.createElement(m.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:n=>d(c=>c.native.oid=n.target.value),variant:"standard",helperText:Je((o==null?void 0:o.common.name)||"",e.language),fullWidth:!0}),l.createElement(m.Button,{onClick:()=>y(!0)},"..."))),l.createElement("div",{className:e.classes.field},re("startValue",i.native.type==="toggle"?"First value":i.native.type==="single"?"Desired value":"Start value"),i.native.type==="double"&&H()),l.createElement("div",{className:e.classes.field},!e.isSimulation&&l.createElement(m.FormControl,{variant:"standard"},l.createElement(m.InputLabel,null,e.t("Period")),l.createElement(m.Select,{value:O||"once",disabled:e.readOnly,onChange:n=>{n.target.value!==i.native.cron&&d(c=>{if(n.target.value==="once")delete c.native.cron,c.native.start=$(M,"date",e.serverTimeZone);else if(n.target.value==="daily"){delete c.native.start;const f=B("0 0 ? * 0-6"),T=$(M,"cron",e.serverTimeZone);f.hours=T.hours,f.minutes=T.minutes,c.native.cron=U(f)}else if(n.target.value==="monthly"){delete c.native.start;const f=B("0 0 ? 1-12 ?"),T=$(M,"cron",e.serverTimeZone);f.hours=T.hours,f.minutes=T.minutes,c.native.cron=U(f)}})}},["once","daily","monthly"].map(n=>l.createElement(m.MenuItem,{key:n,value:n},e.t(n))))),O==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&l.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},l.createElement("thead",null,l.createElement("tr",null,z.map(n=>l.createElement("td",{key:n,className:e.classes.tableCell},ce()().day(n).format("ddd"))))),l.createElement("tbody",null,l.createElement("tr",null,z.map(n=>{var c;return l.createElement("td",{key:n},l.createElement(m.Checkbox,{checked:((c=v==null?void 0:v.dows)==null?void 0:c.includes(n))||!1,disabled:e.readOnly,onChange:f=>{d(T=>{const F=B(T.native.cron);f.target.checked?F.dows.push(n):F.dows=F.dows.filter(Y=>Y!==n),T.native.cron=U(F)})},size:"small"}))}))))),O==="monthly"&&l.createElement("div",{className:e.classes.field},l.createElement("table",null,l.createElement("thead",null,l.createElement("tr",null,new Array(12).fill(null).map((n,c)=>l.createElement("td",{key:c,className:e.classes.tableCell},ce()().month(c).format("MMM"))))),l.createElement("tbody",null,l.createElement("tr",null,new Array(12).fill(null).map((n,c)=>{var f;return l.createElement("td",{key:c},l.createElement(m.Checkbox,{checked:((f=v==null?void 0:v.months)==null?void 0:f.includes(c+1))||!1,disabled:e.readOnly,onChange:T=>{d(F=>{const Y=B(F.native.cron);T.target.checked?Y.months.push(c+1):Y.months=Y.months.filter(qe=>qe!==c+1),F.native.cron=U(Y)})},size:"small"}))}))))),l.createElement("div",{className:e.classes.field},l.createElement(m.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:n=>d(c=>c.common.name=n.target.value),variant:"standard",fullWidth:!0})),l.createElement("div",{className:e.classes.narrowColor},l.createElement(P.ColorPicker,{value:i.common.color||i.native.color||"",disabled:e.readOnly,onChange:n=>d(c=>c.common.color=n),name:e.t("Color")}))),l.createElement(m.DialogActions,null,e.readOnly?null:l.createElement(m.Button,{variant:"contained",color:"secondary",startIcon:l.createElement(de.Delete,null),onClick:()=>ie(!0)},e.t("Delete")),!e.readOnly&&!e.widget?l.createElement("div",{style:{flex:1}}):null,e.readOnly?null:l.createElement(m.Button,{variant:"contained",color:"primary",disabled:!q,startIcon:l.createElement(de.Save,null),onClick:()=>ue(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(K)||1)*6e4,i.native.intervals[0].value=R):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(K)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),l.createElement(m.Button,{variant:"contained",color:"grey",startIcon:l.createElement(de.Cancel,null),onClick:e.onClose},e.readOnly||!q?e.t("ra_Close"):e.t("ra_Cancel"))),k&&l.createElement(P.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:n=>ue(void 0,null,function*(){if(n){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(c){window.alert(`Cannot delete event: ${c}`)}e.onClose()}ie(!1)})}))};ye.propTypes={systemConfig:E().object,classes:E().object.isRequired,socket:E().object.isRequired,onClose:E().func.isRequired,event:E().object,readOnly:E().bool,updateEvents:E().func.isRequired,serverTimeZone:E().number.isRequired,t:E().func.isRequired,language:E().string.isRequired,widget:E().bool,setEvent:E().func.isRequired,deleteEvent:E().func.isRequired};var He=(0,V.withStyles)(Ke)(ye),I=u(4819),me=(e,s,a)=>new Promise((r,g)=>{var y=o=>{try{b(a.next(o))}catch(C){g(C)}},i=o=>{try{b(a.throw(o))}catch(C){g(C)}},b=o=>o.done?r(o.value):Promise.resolve(o.value).then(y,i);b((a=a.apply(e,s)).next())});const Ye=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Qe=({type:e,t:s,color:a})=>{const r=(0,D.useRef)(null);return(0,D.useEffect)(()=>{const g=new X._l(r.current,{eventData:()=>({id:e.type,title:s(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{g.destroy()}},[]),I.createElement("div",{style:{backgroundColor:a||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:r},s(e.name))},Xe=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function Ce(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function be(e){var s,a;const[r,g]=(0,D.useState)(null),y=e.storageName||"calendar",i=(0,D.useRef)(null),b=(0,D.useRef)(null),o=(0,D.useRef)(null),C=(0,D.useRef)(null),[k,ie]=(0,D.useState)({start:null,end:null});let K=(!e.widget&&window.localStorage.getItem(`${y}Start`),new Date),se=e.viewMode||window.localStorage.getItem(`${y}View`)||"dayGridMonth";e.isSimulation&&(K=new Date,se=((s=e.simulation)==null?void 0:s.native.interval)==="day"?"timeGridDay":"timeGridWeek");let R=Ye;e.isSimulation&&(R=R.filter(t=>t.type==="single"));const L=[];return e.events.forEach(t=>{var h,d,v,O,M,q,re;if(!t)return;const H=(h=t.native)!=null&&h.intervals&&t.native.intervals[0]&&t.native.intervals[0].timeOffset?t.native.intervals[0].timeOffset:30;t.common.color=t.common.color||"#3a87b2";const z=t.common.enabled?t.common.color:Ce(t.common.color);let Z=P.Utils.invertColor(t.common.color,!0);t.common.enabled||(Z=Ce(Z));let W=t.common.name;if(t.native.oid){let w=t.native.startValue;typeof w=="boolean"?w=w?P.I18n.t("ON"):P.I18n.t("OFF"):t.native.states&&t.native.states[w]&&(w=t.native.states[w]);let S=(v=(d=t.native.intervals)==null?void 0:d[0])==null?void 0:v.value;typeof S=="boolean"?S=S?P.I18n.t("ON"):P.I18n.t("OFF"):t.native.states&&t.native.states[S]&&(S=t.native.states[S]),W=`${t.common.name} \u2192 ${w}`,t.native.type==="double"&&(W+=` \u2192 ${(((M=(O=t.native.intervals)==null?void 0:O[0])==null?void 0:M.timeOffset)||0)/1e3/60} ${P.I18n.t("min")}. \u2192 ${S}`),t.native.type==="toggle"&&(W+=` \u2192 ${(((re=(q=t.native.intervals)==null?void 0:q[0])==null?void 0:re.timeOffset)||0)/1e3/60} ${P.I18n.t("min")}. \u2192 ${P.I18n.t("initial")}`)}if(t.native.cron){const w=_(t.native.cron,"cron",e.serverTimeZone),S=B(t.native.cron);w.setFullYear(new Date().getFullYear()-1),Array.isArray(S.months)?new ae.Ci({dtstart:w,until:k.end||new Date,freq:ae.Ci.WEEKLY,bymonth:S.months}).between(k.start||new Date,k.end||new Date).forEach(c=>{const f=t.native.astro?le().getTimes(c,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:c;t.native.astro&&t.native.offset&&f.setMinutes(f.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,backgroundColor:z,textColor:Z,start:f,duration:H,allDay:!1,display:"block"})}):Array.isArray(S.dows)?new ae.Ci({dtstart:w,until:k.end||new Date,freq:ae.Ci.WEEKLY,byweekday:S.dows.map(c=>c===0?6:c-1)}).between(k.start||new Date,k.end||new Date).forEach(c=>{const f=t.native.astro?le().getTimes(c,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:c;t.native.astro&&t.native.offset&&f.setMinutes(f.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,backgroundColor:z,textColor:Z,start:f,duration:H,allDay:!1,display:"block"})}):L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,duration:H,backgroundColor:z,textColor:Z,icon:t.common.icon})}else{const w=t.native.astro?le().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[t.native.astro]:t.native.start;t.native.astro&&t.native.offset&&w.setMinutes(w.getMinutes()+t.native.offset),L.push({extendedProps:{eventId:t._id,icon:t.common.icon},title:W,display:"block",backgroundColor:z,textColor:Z,start:_(w,"date",e.serverTimeZone),end:_(new Date(new Date(w).getTime()+H),"date",e.serverTimeZone)})}}),(0,D.useEffect)(()=>{if(e.widget){const t=()=>{var h;const d=(h=i.current)==null?void 0:h.getApi();d&&(console.log("Scroll to now"),d.scrollToTime(new Date().getTime())),o.current?C.current=null:C.current=setTimeout(()=>t,3e5)};setTimeout(t,1e3)}return()=>{C.current&&clearTimeout(C.current),C.current=null,o.current&&clearTimeout(o.current),o.current=null}},[]),(0,D.useEffect)(()=>{var t,h;if(e.isSimulation){const d=(t=i.current)==null?void 0:t.getApi();d==null||d.changeView(((h=e.simulation)==null?void 0:h.native.interval)==="day"?"timeGridDay":"timeGridWeek",new Date)}},[e.isSimulation,(a=e.simulation)==null?void 0:a.native.interval]),e.isSimulation&&!e.simulation?null:I.createElement(I.Fragment,null,I.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),r?I.createElement(He,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(t=>t._id===r),onClose:()=>g(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,I.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&I.createElement("div",{className:e.classes.leftBlock},I.createElement(m.Paper,{elevation:4,className:e.classes.leftPaper},I.createElement("div",{className:e.classes.leftContent},I.createElement("h4",null,e.t("Events")),R.map((t,h)=>{var d,v;return I.createElement(Qe,{t:e.t,type:t,name:e.t(t.name),key:t.type,index:h,color:e.isSimulation?(v=(d=e.simulation)==null?void 0:d.common)==null?void 0:v.color:void 0})}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:I.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")),e.hideLeftBlockHint?null:I.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:I.createElement("div",null,e.t("Use double click on calendar to add new events.")))),e.button),I.createElement("div",{className:e.classes.calendarBlock},I.createElement("div",{className:e.classes.calendar},I.createElement(ve.Z,{ref:i,plugins:[ee.Z,p.Z,fe.Z,X.ZP,ge.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:se,initialDate:K,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,events:L,height:"calc(100% - 20px)",locales:[J.Z,Te.Z,N.Z,te.Z,ne.Z,De.Z,Se.Z,Ie.Z,we.Z,xe.Z],locale:e.language,datesSet:t=>{var h,d;(t.start.toString()!==((h=k.start)==null?void 0:h.toString())||t.end.toString()!==((d=k.end)==null?void 0:d.toString()))&&ie({start:t.start,end:t.end}),e.widget?(C.current&&clearTimeout(C.current),C.current=null,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{o.current=null;const v=()=>{var O;const M=(O=i.current)==null?void 0:O.getApi();M==null||M.scrollToTime(new Date().getTime()),o.current?C.current=null:C.current=setTimeout(()=>v,1e3*60*5)};v()},6e4)):window.localStorage.setItem(`${y}View`,t.view.type)},eventClick:t=>g(t.event.extendedProps.eventId),eventResize:t=>{var h;const d=e.events.find(v=>v._id===t.event.extendedProps.eventId);if((h=d.native.intervals)!=null&&h[0].timeOffset){const v=JSON.parse(JSON.stringify(d));v.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(v._id,v),e.updateEvents()}else t.revert()},eventDrop:t=>me(this,null,function*(){var h;const d=e.events.find(v=>v._id===t.event.extendedProps.eventId);if((h=d==null?void 0:d.native)!=null&&h.cron){const v=JSON.parse(JSON.stringify(d));t.jsEvent.altKey&&(v._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`);const O=B(v.native.cron),M=$(t.event.start,"cron",e.serverTimeZone);O.hours=M.hours,O.minutes=M.minutes,v.native.cron=U(O),yield e.setEvent(v._id,v),e.updateEvents()}else{const v=JSON.parse(JSON.stringify(d));t.jsEvent.altKey&&(v._id=`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`),v.native.start=$(t.event.start,"date",e.serverTimeZone),yield e.setEvent(v._id,v),e.updateEvents()}}),eventReceive:t=>me(this,null,function*(){const h={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:t.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.event.start,"date",e.serverTimeZone),type:t.event.extendedProps.type,oid:"",startValue:""},type:"schedule"};if(t.event.extendedProps.type!=="single"&&(h.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){h.common.color=e.simulation.common.color||h.common.color,delete h.native.start;const d=$(t.event.start,"cron",e.serverTimeZone);d.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[t.event.start.getDay()],d.dates=["?"],d.months=["*"],h.native.cron=U(d),h.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(h._id,h),e.updateEvents(),setTimeout(()=>g(h._id),100)}),eventDidMount:t=>{let h=t.event.extendedProps.icon;if(h){const d=window.document.createElement("img");!h.startsWith("data:image")&&!h.startsWith("http")&&!h.startsWith("/")&&(h=`../../${h}`),d.setAttribute("src",h),d.className="icon",d.style.width="20px",d.style.height="20px";const v=t.el.getElementsByClassName("fc-event-title-container");if(v.length){v[0].prepend(d);const O=v[0].getElementsByClassName("fc-event-title");O.length&&(O[0].style.marginLeft="23px")}}},select:t=>me(this,null,function*(){if(t.view.calendar.unselect(),e.readOnly)return;const d=t.end.getTime()-t.start.getTime();if((!b.current||Date.now()-b.current>500)&&d===30*60*1e3){b.current=Date.now();return}const v={_id:`${e.calendarPrefix||e.simulationId}.event-${(0,j.Z)()}`,common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:$(t.date||t.start,"date",e.serverTimeZone),intervals:t.end&&!e.isSimulation?[{value:"",timeOffset:t.end.getTime()-t.start.getTime()}]:void 0,type:t.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"};e.isSimulation&&(v.common.color=e.simulation.common.color||v.common.color),yield e.setEvent(v._id,v),yield e.updateEvents(),setTimeout(()=>g(v._id),100)})})))))}be.propTypes={events:E().array,serverTimeZone:E().number,systemConfig:E().object,theme:E().object,socket:E().object,readOnly:E().bool,hideLeftBlock:E().bool,hideTopBlock:E().bool,hideLeftBlockHint:E().bool,hideTopBlockButtons:E().bool,hideWeekends:E().bool,viewMode:E().bool,updateEvents:E().func,t:E().func.isRequired,widget:E().bool,language:E().string.isRequired,storageName:E().string,calendarPrefix:E().string,isSimulation:E().bool,simulationId:E().string,setEvent:E().func,button:E().any};var _e=(0,V.withTheme)((0,V.withStyles)(Xe)(be))},82809:function(Oe,oe,u){var D=u(4819),Q=u.n(D),E=u(15854),j=u.n(E),V=u(94427),ve=u.n(V),p=u(75606),fe=u.n(p),X=u(88411),ge=u.n(X);const ee=window.visRxWidget||X.VisRxWidget;class J extends Q().Component{constructor(N){super(N),this.state={list:[{value:"",label:ee.t("default")}]}}static getText(N){return typeof N=="object"?N[p.I18n.getLanguage()]||N.en:N}componentDidMount(){this.props.instance&&this.props.socket.getObjectViewSystem("folder",`fullcalendar.${this.props.instance}.Calendars.`,`fullcalendar.${this.props.instance}.Calendars.\u9999`).then(N=>{const te=Object.keys(N).map(ne=>({value:ne,label:J.getText(N[ne].common.name)}));te.unshift({value:"",label:ee.t("default")}),this.setState({list:te})})}render(){return Q().createElement(V.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:N=>this.props.onChange(N.target.value)},this.state.list.map(N=>Q().createElement(V.MenuItem,{key:N.value},N.label)))}}J.propTypes={value:j().string,socket:j().object,onChange:j().func,instance:j().number},oe.Z=J}}]);

//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.d4fd0548.chunk.js.map