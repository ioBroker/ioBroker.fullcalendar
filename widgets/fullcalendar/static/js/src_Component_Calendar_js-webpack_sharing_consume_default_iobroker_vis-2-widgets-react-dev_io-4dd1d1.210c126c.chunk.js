"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1"],{83178:function(ze,ae,c){c.d(ae,{Z:function(){return Ve}});var w=c(4819),le=c(15854),u=c.n(le),W=c(10651),H=c(58503),ie=c(76516),re=c(40387),se=c(24990),Q=c(44251),oe=c(33634),de=c(51172),ce=c(25177),ue=c(33841),ve=c(49582),me=c(36513),fe=c(4302),ge=c(43007),ye=c(43223),he=c(96933),Ee=c(93484),Ce=c(80809),d=c(94427),$=c(75606),J=c(14853),be=c(98667),X=c.n(be);function Te(e,r){return e-r}function N(e){if(e==="*"||e==="?"||e==="")return e;const r=e.split(","),l=[];for(let s=0;s<r.length;s++){const h=r[s].match(/(\d+)-(\d+)/);if(h)for(let E=parseInt(h[1],10);E<=parseInt(h[2],10);E++)l.push(E);else l.push(parseInt(r[s],10))}return l}function A(e,r){const l={};if(r){const s=r.split(/\D/);l.seconds=[parseInt(s[5],10)],l.minutes=[parseInt(s[4],10)],l.hours=[parseInt(s[3],10)],l.dates=[parseInt(s[2],10)],l.months=[parseInt(s[1],10)],l.dows="?"}else{const s=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");s.length===6?(l.seconds=N(s[0]),l.minutes=N(s[1]),l.hours=N(s[2]),l.dates=N(s[3]),l.months=N(s[4]),l.dows=N(s[5])):(l.seconds=[0],l.minutes=N(s[0]),l.hours=N(s[1]),l.dates=N(s[2]),l.months=N(s[3]),l.dows=N(s[4]))}return l}function R(e){if(e==="*"||e==="?")return e;if(typeof e=="string"&&(e=parseInt(e,10)),typeof e!="object"&&(e=[e]),e.sort(Te),e.length<3)return e.join(",");const r=[];let l=e[0],s=e[0];for(let h=1;h<e.length;h++)e[h]===s+1?s++:(l!==s?l+1===s?r.push(`${l},${s}`):r.push(`${l}-${s}`):r.push(l),l=e[h],s=e[h]);return l!==s?l+1===s?r.push(`${l},${s}`):r.push(`${l}-${s}`):r.push(l),r.join(",")}function B(e){const r=["*","*","*","*","?"];return e.seconds&&(r[0]=R(e.seconds)),r[0]=R(e.minutes),r[1]=R(e.hours),r[2]=R(e.dates),r[3]=R(e.months),r[4]=R(e.dows),r.join(" ")}function V(e,r,l){if(r==="cron"){const s=A(e),h=new Date;return h.setHours(s.hours[0],s.minutes[0]),Array.isArray(s.dows)&&h.setDate(h.getDate()+s.dows[0]-h.getDay()),h}return r==="date"?new Date(e):null}function k(e,r,l){if(r==="cron")return e=new Date(e.getTime()),{minutes:[e.getMinutes()],hours:[e.getHours()]};if(r==="date"){e=new Date(e.getTime()-new Date().getTimezoneOffset()*6e4);const s=e.toISOString();return s.substring(0,s.length-5)}return null}var K=c(59665),Oe=c(71373),De=c(38809),we=c(92631),xe=c(36105),Y=c.n(xe),Ge=c(63460),He=c(79117),Ke=c(83994),Ye=c(28301),Ue=c(19867),Qe=c(68582),Xe=c(37529),qe=c(69850),_e=c(15552),pe=c(97712),n=c(4819),Se=Object.defineProperty,Ie=Object.defineProperties,Ne=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,_=(e,r,l)=>r in e?Se(e,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[r]=l,Pe=(e,r)=>{for(var l in r||(r={}))ke.call(r,l)&&_(e,l,r[l]);if(q)for(var l of q(r))Ze.call(r,l)&&_(e,l,r[l]);return e},$e=(e,r)=>Ie(e,Ne(r)),p=(e,r,l)=>new Promise((s,h)=>{var E=g=>{try{O(l.next(g))}catch(I){h(I)}},i=g=>{try{O(l.throw(g))}catch(I){h(I)}},O=g=>g.done?s(g.value):Promise.resolve(g.value).then(E,i);O((l=l.apply(e,r)).next())});const Ae={single:"single_description",double:"double_description",toggle:"toggle_description"},je={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex"},narrowText:{width:140,marginLeft:8},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"}},Be=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function Re(e,r){return e&&typeof e=="object"?e[r]||e.en:e}const ee=e=>{var r;const l=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,s=e.event.native.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].value!==void 0?e.event.native.intervals[0].value:"",[h,E]=(0,w.useState)(!1),[i,O]=(0,w.useState)(e.event),[g,I]=(0,w.useState)(null),[z,F]=(0,w.useState)(!1),[Z,a]=(0,w.useState)(l),[v,y]=(0,w.useState)(s);Y().locale(e.language),(0,w.useEffect)(()=>{i.native.oid?e.socket.getObject(i.native.oid).then(t=>I(t)).catch(t=>{console.error(`Cannot get object ${i.native.oid}: ${t}`),I(null)}):I(null)},[i.native.oid,e.socket]);const m=i.native.cron?A(i.native.cron):null;let C="once";Array.isArray(m==null?void 0:m.months)?C="monthly":Array.isArray(m==null?void 0:m.dows)&&(C="daily");let S;i&&(C==="once"?S=V(i.native.start,"date",e.serverTimeZone):(C==="monthly"||C==="daily")&&(S=V(i.native.cron,"cron",e.serverTimeZone)));const G=JSON.stringify(e.event)!==JSON.stringify(i)||Z!==l||v!==s,T=t=>{const o=JSON.parse(JSON.stringify(i));t(o),O(o)},L=(t,o)=>g?g.common.type==="boolean"?n.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:n.createElement(d.Checkbox,{checked:!!i.native[t],disabled:e.readOnly,onChange:f=>T(b=>b.native[t]=f.target.checked)}),label:e.t(o)}):g.common.states?n.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},n.createElement(d.InputLabel,null,e.t(o)),n.createElement(d.Select,{value:i.native[t]||"",disabled:e.readOnly,onChange:f=>T(b=>b.native[t]=f.target.value)},Object.keys(g.common.states).map(f=>n.createElement(d.MenuItem,{key:f,value:f},g.common.states[f])))):n.createElement(d.TextField,{className:e.classes.narrowText2,label:e.t(o),value:i.native[t]||"",disabled:e.readOnly,onChange:f=>T(b=>b.native[t]=f.target.value),variant:"standard"}):null,M=()=>g?g.common.type==="boolean"?n.createElement(d.FormControlLabel,{className:e.classes.narrowText2,control:n.createElement(d.Checkbox,{checked:!!v,disabled:e.readOnly,onChange:t=>y(t.target.checked)}),label:e.t("End value")}):g.common.states?n.createElement(d.FormControl,{className:e.classes.narrowText2,variant:"standard"},n.createElement(d.InputLabel,null,e.t("End value")),n.createElement(d.Select,{value:v||"",disabled:e.readOnly,onChange:t=>y(t.target.value)},Object.keys(g.common.states).map(t=>n.createElement(d.MenuItem,{key:t,value:t},g.common.states[t])))):n.createElement(d.TextField,{label:e.t("End value"),value:v||"",disabled:e.readOnly,onChange:t=>y(t.target.value),variant:"standard",className:e.classes.narrowText2}):null,j=((r=e.systemConfig)==null?void 0:r.firstDayOfWeek)==="monday"?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6];return n.createElement(d.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0},n.createElement(d.DialogTitle,null,e.t("Configure event")),n.createElement(d.DialogContent,null,h&&n.createElement($.SelectID,{imagePrefix:"../..",selected:i.native.oid,disabled:e.readOnly,onOk:t=>{T(o=>o.native.oid=t),E(!1)},onClose:()=>E(!1),socket:e.socket}),n.createElement("div",{className:e.classes.field},n.createElement(d.FormControlLabel,{control:n.createElement(d.Checkbox,{checked:!!(i!=null&&i.common.enabled),disabled:e.readOnly,onChange:t=>T(o=>o.common.enabled=t.target.checked)}),label:e.t("Active")})),n.createElement("div",{className:e.classes.field},n.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},n.createElement(d.InputLabel,null,e.t("Time")),n.createElement(d.Select,{value:i.native.astro?"astro":"time",disabled:e.readOnly,onChange:t=>T(o=>{t.target.value==="astro"?o.native.astro="sunrise":delete o.native.astro}),renderValue:t=>e.t(t)},["time","astro"].map(t=>n.createElement(d.MenuItem,{key:t,value:t},n.createElement("div",null,e.t(t)))))),i.native.astro?n.createElement(d.FormControl,{className:e.classes.narrowText,variant:"standard"},n.createElement(d.InputLabel,null,$.I18n.t("Astronomic event")),n.createElement(d.Select,{value:i.native.astro||"",onChange:t=>T(o=>o.native.astro=t.target.value)},Be.map(t=>n.createElement(d.MenuItem,{key:t,value:t},$.I18n.t(t))))):n.createElement(De._,{dateAdapter:Oe.Z},n.createElement(we.j,{label:e.t("Time"),value:S||null,disabled:e.readOnly,onChange:t=>{if(t)try{T(o=>{if(C==="once")o.native.start=k(t.toDate(),"date",e.serverTimeZone);else if(C==="monthly"||C==="daily"){const f=A(o.native.cron),b=k(t.toDate(),"cron",e.serverTimeZone);f.hours=b.hours,f.minutes=b.minutes,o.native.cron=B(f)}})}catch(o){}},renderInput:t=>n.createElement(d.TextField,$e(Pe({},t),{variant:"standard",className:e.classes.narrowText})),ampm:!1}))),e.isSimulation&&n.createElement("div",{className:e.classes.field},n.createElement(d.TextField,{label:e.t("Time random offset"),value:i.native.timeRandomOffset||0,disabled:e.readOnly,onChange:t=>T(o=>o.native.timeRandomOffset=parseInt(t.target.value)),variant:"standard",InputProps:{endAdornment:n.createElement(d.InputAdornment,{position:"end"},e.t("ms"))}})),n.createElement("div",{className:e.classes.field},!e.isSimulation&&n.createElement(d.FormControl,{variant:"standard",className:e.classes.narrowText2},n.createElement(d.InputLabel,null,e.t("Event type")),n.createElement(d.Select,{value:i.native.type||"",disabled:e.readOnly,onChange:t=>T(o=>o.native.type=t.target.value),renderValue:t=>e.t(t)},["single","double","toggle"].map(t=>n.createElement(d.MenuItem,{key:t,value:t},n.createElement("div",null,n.createElement("div",null,e.t(t)),n.createElement("div",{className:e.classes.typeDescription},e.t(Ae[t]))))))),i.native.type!=="single"&&n.createElement(d.TextField,{label:e.t("Duration"),value:Z,disabled:e.readOnly,onChange:t=>a(t.target.value),variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:n.createElement(d.InputAdornment,{position:"end"},e.t("minutes"))}})),n.createElement("div",{className:e.classes.field},n.createElement("div",{className:e.classes.selectId},n.createElement(d.TextField,{label:"Object ID",value:i.native.oid||"",disabled:e.readOnly,onChange:t=>T(o=>o.native.oid=t.target.value),variant:"standard",helperText:Re((g==null?void 0:g.common.name)||"",e.language),fullWidth:!0}),n.createElement(d.Button,{onClick:()=>E(!0)},"..."))),n.createElement("div",{className:e.classes.field},L("startValue",i.native.type==="toggle"?"First value":"Start value"),i.native.type==="double"&&M()),n.createElement("div",{className:e.classes.field},!e.isSimulation&&n.createElement(d.FormControl,{variant:"standard"},n.createElement(d.InputLabel,null,e.t("Period")),n.createElement(d.Select,{value:C||"once",disabled:e.readOnly,onChange:t=>{t.target.value!==i.native.cron&&T(o=>{if(t.target.value==="once")delete o.native.cron,o.native.start=k(S,"date",e.serverTimeZone);else if(t.target.value==="daily"){delete o.native.start;const f=A("0 0 ? * 0-6"),b=k(S,"cron",e.serverTimeZone);f.hours=b.hours,f.minutes=b.minutes,o.native.cron=B(f)}else if(t.target.value==="monthly"){delete o.native.start;const f=A("0 0 ? 1-12 ?"),b=k(S,"cron",e.serverTimeZone);f.hours=b.hours,f.minutes=b.minutes,o.native.cron=B(f)}})}},["once","daily","monthly"].map(t=>n.createElement(d.MenuItem,{key:t,value:t},e.t(t))))),C==="daily"&&(!e.isSimulation||e.simulation.native.interval==="week")&&n.createElement("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0},n.createElement("thead",null,n.createElement("tr",null,j.map(t=>n.createElement("td",{key:t,className:e.classes.tableCell},Y()().day(t).format("ddd"))))),n.createElement("tbody",null,n.createElement("tr",null,j.map(t=>{var o;return n.createElement("td",{key:t},n.createElement(d.Checkbox,{checked:((o=m==null?void 0:m.dows)==null?void 0:o.includes(t))||!1,disabled:e.readOnly,onChange:f=>{T(b=>{const x=A(b.native.cron);f.target.checked?x.dows.push(t):x.dows=x.dows.filter(P=>P!==t),b.native.cron=B(x)})},size:"small"}))}))))),C==="monthly"&&n.createElement("div",{className:e.classes.field},n.createElement("table",null,n.createElement("thead",null,n.createElement("tr",null,new Array(12).fill(null).map((t,o)=>n.createElement("td",{key:o,className:e.classes.tableCell},Y()().month(o).format("MMM"))))),n.createElement("tbody",null,n.createElement("tr",null,new Array(12).fill(null).map((t,o)=>{var f;return n.createElement("td",{key:o},n.createElement(d.Checkbox,{checked:((f=m==null?void 0:m.months)==null?void 0:f.includes(o+1))||!1,disabled:e.readOnly,onChange:b=>{T(x=>{const P=A(x.native.cron);b.target.checked?P.months.push(o+1):P.months=P.months.filter(Je=>Je!==o+1),x.native.cron=B(P)})},size:"small"}))}))))),n.createElement("div",{className:e.classes.field},n.createElement(d.TextField,{label:"Description",value:(i==null?void 0:i.common.name)||"",disabled:e.readOnly,onChange:t=>T(o=>o.common.name=t.target.value),variant:"standard",fullWidth:!0})),n.createElement("div",{className:e.classes.narrowColor},n.createElement($.ColorPicker,{value:i.native.color||"",disabled:e.readOnly,onChange:t=>T(o=>o.native.color=t),name:e.t("Color")}))),n.createElement(d.DialogActions,null,e.readOnly?null:n.createElement(d.Button,{variant:"contained",color:"secondary",startIcon:n.createElement(K.Delete,null),onClick:()=>F(!0)},e.t("Delete")),!e.readOnly&&!e.widget?n.createElement("div",{style:{flex:1}}):null,e.readOnly?null:n.createElement(d.Button,{variant:"contained",color:"primary",disabled:!G,startIcon:n.createElement(K.Save,null),onClick:()=>p(void 0,null,function*(){i.native.type==="single"?i.native.intervals&&delete i.native.intervals:i.native.type==="double"?(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(Z)||1)*6e4,i.native.intervals[0].value=v):i.native.type==="toggle"&&(i.native.intervals=i.native.intervals||[],i.native.intervals[0]=i.native.intervals[0]||{},i.native.intervals[0].timeOffset=(parseFloat(Z)||1)*6e4),yield e.setEvent(i._id,i),e.updateEvents(),e.onClose()})},e.t("Save")),n.createElement(d.Button,{variant:"contained",color:"grey",startIcon:n.createElement(K.Cancel,null),onClick:e.onClose},e.readOnly?e.t("Close"):e.t("Cancel"))),z&&n.createElement($.Confirm,{title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",onClose:t=>p(void 0,null,function*(){if(t){try{yield e.deleteEvent(i._id),e.updateEvents()}catch(o){window.alert(`Cannot delete event: ${o}`)}e.onClose()}F(!1)})}))};ee.propTypes={systemConfig:u().object,classes:u().object.isRequired,socket:u().object.isRequired,onClose:u().func.isRequired,event:u().object,readOnly:u().bool,updateEvents:u().func.isRequired,serverTimeZone:u().number.isRequired,t:u().func.isRequired,language:u().string.isRequired,widget:u().bool,setEvent:u().func.isRequired,deleteEvent:u().func.isRequired};var Fe=(0,H.withStyles)(je)(ee),D=c(4819),U=(e,r,l)=>new Promise((s,h)=>{var E=g=>{try{O(l.next(g))}catch(I){h(I)}},i=g=>{try{O(l.throw(g))}catch(I){h(I)}},O=g=>g.done?s(g.value):Promise.resolve(g.value).then(E,i);O((l=l.apply(e,r)).next())});const Le=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Me=({type:e,t:r})=>{const l=(0,w.useRef)(null);return(0,w.useEffect)(()=>{const s=new Q._l(l.current,{eventData:()=>({id:e.type,title:r(e.name),create:!0,extendedProps:{type:e.type}})});return()=>{s.destroy()}},[]),D.createElement("div",{style:{backgroundColor:"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:l},r(e.name))},We=()=>({container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}});function te(e){if(e)return e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}50`:`${e.substring(0,7)}50`:e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function ne(e){const[r,l]=(0,w.useState)(null),s=e.storageName||"calendar",h=(0,w.useRef)(null),E=(0,w.useRef)(null),i=(0,w.useRef)(null),[O,g]=(0,w.useState)({start:null,end:null});let I=(!e.widget&&window.localStorage.getItem(`${s}Start`),new Date),z=e.viewMode||window.localStorage.getItem(`${s}View`)||"dayGridMonth";e.isSimulation&&(I=new Date,z=e.simulation.native.interval==="day"?"timeGridDay":"timeGridWeek");let F=Le;e.isSimulation&&(F=F.filter(a=>a.type==="single"));const Z=[];return e.events.forEach(a=>{var v,y,m,C,S,G,T;if(!a)return;const L=(v=a.native)!=null&&v.intervals&&a.native.intervals[0]&&a.native.intervals[0].timeOffset?a.native.intervals[0].timeOffset:20,M=a.common.enabled?a.native.color:te(a.native.color);let j=$.Utils.invertColor(a.native.color,!0);a.common.enabled||(j=te(j));let t=a.common.name;if(a.native.oid&&(t=`${a.common.name} \u2192 ${a.native.startValue}`,a.native.type==="double"&&(t+=` \u2192 ${(((m=(y=a.native.intervals)==null?void 0:y[0])==null?void 0:m.timeOffset)||0)/1e3/60} ${$.I18n.t("min")}. \u2192 ${(S=(C=a.native.intervals)==null?void 0:C[0])==null?void 0:S.value}`),a.native.type==="toggle"&&(t+=` \u2192 ${(((T=(G=a.native.intervals)==null?void 0:G[0])==null?void 0:T.timeOffset)||0)/1e3/60} ${$.I18n.t("min")}. \u2192 ${$.I18n.t("initial")}`)),a.native.cron){const o=V(a.native.cron,"cron",e.serverTimeZone),f=A(a.native.cron);if(o.setFullYear(1970),Array.isArray(f.months)){new J.Ci({dtstart:o,until:O.end||new Date,freq:J.Ci.WEEKLY,bymonth:f.months}).between(O.start||new Date,O.end||new Date).forEach(x=>{const P=a.native.astro?X().getTimes(x,e.adapterConfig.latitude||e.systemConfig.latitude,e.adapterConfig.longitude||e.systemConfig.longitude)[a.native.astro]:x;Z.push({extendedProps:{eventId:a._id},title:t,backgroundColor:M,textColor:j,start:P,duration:L,allDay:!1,display:"block"})});return}if(Array.isArray(f.dows)){new J.Ci({dtstart:o,until:O.end||new Date,freq:J.Ci.WEEKLY,byweekday:f.dows.map(x=>x===0?6:x-1)}).between(O.start||new Date,O.end||new Date).forEach(x=>{const P=a.native.astro?X().getTimes(x,e.systemConfig.latitude,e.systemConfig.longitude)[a.native.astro]:x;Z.push({extendedProps:{eventId:a._id},title:t,backgroundColor:M,textColor:j,start:P,duration:L,allDay:!1,display:"block"})});return}Z.push({extendedProps:{eventId:a._id},title:t,duration:L,backgroundColor:M,textColor:j});return}Z.push({extendedProps:{eventId:a._id},title:t,display:"block",backgroundColor:M,textColor:j,start:V(a.native.start,"date",e.serverTimeZone),end:V(new Date(new Date(a.native.start).getTime()+L),"date",e.serverTimeZone)})}),(0,w.useEffect)(()=>{if(e.widget){const a=()=>{var v;const y=(v=h.current)==null?void 0:v.getApi();y&&(console.log("Scroll to now"),y.scrollToTime(new Date().getTime())),E.current?i.current=null:i.current=setTimeout(()=>a,3e5)};setTimeout(a,1e3)}return()=>{i.current&&clearTimeout(i.current),i.current=null,E.current&&clearTimeout(E.current),E.current=null}},[]),(0,w.useEffect)(()=>{var a;e.isSimulation&&((a=h.current)==null?void 0:a.getApi()).changeView(e.simulation.native.interval==="day"?"timeGridDay":"timeGridWeek",new Date)},[e.simulations,e.simulationId]),D.createElement(D.Fragment,null,D.createElement("style",null,e.theme.palette.mode==="dark"?`
:root {
    --fc-neutral-bg-color: hsla(0,0%,12%);
    --fc-list-event-hover-bg-color: hsla(0,0%,12%);
}
.fc-col-header-cell {
    background-color: #1e1e1e;
}                
`:`
.fc-col-header-cell {
    background-color: #EEEEEE;
}
`),r?D.createElement(Fe,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find(a=>a._id===r),onClose:()=>l(null),socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:e.deleteEvent,serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,D.createElement("div",{className:e.classes.container},!e.hideLeftBlock&&!e.readOnly&&D.createElement("div",{className:e.classes.leftBlock},D.createElement(d.Paper,{elevation:4,className:e.classes.leftPaper},D.createElement("div",{className:e.classes.leftContent},D.createElement("h4",null,e.t("Events")),F.map((a,v)=>D.createElement(Me,{t:e.t,type:a,name:e.t(a.name),key:a.type,index:v})),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Drag and drop the events above to create a new one.")),e.hideLeftBlockHint?null:D.createElement("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:D.createElement("div",null,e.t("Use ALT by dragging it to copy the events.")))),e.button),D.createElement("div",{className:e.classes.calendarBlock},D.createElement("div",{className:e.classes.calendar},D.createElement(ie.Z,{ref:h,plugins:[de.Z,re.Z,se.Z,Q.ZP,oe.Z],weekends:!e.hideWeekends,headerToolbar:e.hideTopBlock?!1:{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},initialView:z,initialDate:I,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,events:Z,height:"calc(100% - 20px)",locales:[ce.Z,ue.Z,ve.Z,me.Z,fe.Z,ge.Z,ye.Z,he.Z,Ee.Z,Ce.Z],locale:e.language,datesSet:a=>{var v,y;(a.start.toString()!==((v=O.start)==null?void 0:v.toString())||a.end.toString()!==((y=O.end)==null?void 0:y.toString()))&&g({start:a.start,end:a.end}),e.widget?(i.current&&clearTimeout(i.current),i.current=null,E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{E.current=null;const m=()=>{var C;const S=(C=h.current)==null?void 0:C.getApi();S==null||S.scrollToTime(new Date().getTime()),E.current?i.current=null:i.current=setTimeout(()=>m,1e3*60*5)};m()},6e4)):window.localStorage.setItem(`${s}View`,a.view.type)},eventClick:a=>l(a.event.extendedProps.eventId),eventResize:a=>{var v;const y=e.events.find(m=>m._id===a.event.extendedProps.eventId);if((v=y.native.intervals)!=null&&v[0].timeOffset){const m=JSON.parse(JSON.stringify(y));m.native.intervals[0].timeOffset+=a.endDelta.milliseconds,e.setEvent(m._id,m),e.updateEvents()}else a.revert()},eventDrop:a=>U(this,null,function*(){var v;const y=e.events.find(m=>m._id===a.event.extendedProps.eventId);if((v=y==null?void 0:y.native)!=null&&v.cron){const m=JSON.parse(JSON.stringify(y));a.jsEvent.altKey&&(m._id=`${e.calendarPrefix}.event-${(0,W.Z)()}`);const C=A(m.native.cron),S=k(a.event.start,"cron",e.serverTimeZone);C.hours=S.hours,C.minutes=S.minutes,m.native.cron=B(C),yield e.setEvent(m._id,m),e.updateEvents()}else{const m=JSON.parse(JSON.stringify(y));a.jsEvent.altKey&&(m._id=`${e.calendarPrefix}.event-${(0,W.Z)()}`),m.native.start=k(a.event.start,"date",e.serverTimeZone),yield e.setEvent(m._id,m),e.updateEvents()}}),eventReceive:a=>U(this,null,function*(){const v={_id:`${e.calendarPrefix}.event-${(0,W.Z)()}`,common:{name:a.event.title,enabled:!0},native:{id:Date.now(),start:k(a.event.start,"date",e.serverTimeZone),type:a.event.extendedProps.type,oid:"",startValue:"",color:"#3A87AD"},type:"schedule"};if(a.event.extendedProps.type!=="single"&&(v.native.intervals=[{timeOffset:30*60*1e3}]),e.isSimulation){delete v.native.start;const y=k(a.event.start,"cron",e.serverTimeZone);y.dows=e.simulation.native.interval==="day"?[0,1,2,3,4,5,6]:[a.event.start.getDay()],y.dates=["?"],y.months=["*"],v.native.cron=B(y),v._id=`${e.simulationId}.event-${(0,W.Z)()}`,v.native.color=e.simulation.native.defaultColor,v.native.record={states:[],enums:[],start:null,end:null}}yield e.setEvent(v._id,v),e.updateEvents(),setTimeout(()=>l(v._id),100)}),select:a=>U(this,null,function*(){if(a.view.calendar.unselect(),e.readOnly)return;const y={_id:`${e.calendarPrefix}.event-${(0,W.Z)()}`,common:{name:e.t("Single event"),enabled:!0},native:{id:Date.now(),start:k(a.date||a.start,"date",e.serverTimeZone),intervals:a.end?[{value:"",timeOffset:a.end.getTime()-a.start.getTime()}]:void 0,type:a.end?"double":"single",oid:"",startValue:"",color:"#3A87AD"},type:"schedule"};yield e.setEvent(y._id,y),yield e.updateEvents(),setTimeout(()=>l(y._id),100)})})))))}ne.propTypes={events:u().array,serverTimeZone:u().number,systemConfig:u().object,theme:u().object,socket:u().object,readOnly:u().bool,hideLeftBlock:u().bool,hideTopBlock:u().bool,hideLeftBlockHint:u().bool,hideTopBlockButtons:u().bool,hideWeekends:u().bool,viewMode:u().bool,updateEvents:u().func,instance:u().oneOfType([u().string,u().number]),t:u().func.isRequired,widget:u().bool,language:u().string.isRequired,storageName:u().string,calendarPrefix:u().string,isSimulation:u().bool,simulationId:u().string,setEvent:u().func,adapterConfig:u().object,button:u().any};var Ve=(0,H.withTheme)((0,H.withStyles)(We)(ne))}}]);

//# sourceMappingURL=src_Component_Calendar_js-webpack_sharing_consume_default_iobroker_vis-2-widgets-react-dev_io-4dd1d1.210c126c.chunk.js.map