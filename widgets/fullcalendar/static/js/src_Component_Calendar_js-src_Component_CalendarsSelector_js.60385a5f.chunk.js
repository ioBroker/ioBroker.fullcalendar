"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_Component_Calendar_js-src_Component_CalendarsSelector_js"],{99165:function(e,t,n){n.d(t,{Z:function(){return X}});var a=n(74165),i=n(15861),r=n(29439),o=n(4819),l=n(54261),s=n(58503),c=n(90575),u=n(38217),d=n(52720),v=n(74332),m=n(26309),f=n(49704),h=n(96906),g=n(59862),p=n(21431),x=n(82104),y=n(29688),b=n(89283),j=n(10207),w=n(44417),S=n(35422),C=n(32201),T=n(94427),k=n(75606),O=n(36402),D=n(35325),Z=n.n(D);function I(e){if("*"===e||"?"===e||""===e)return e;for(var t=e.split(","),n=[],a=0;a<t.length;a++){var i=t[a].match(/(\d+)-(\d+)/);if(i)for(var r=parseInt(i[1],10);r<=parseInt(i[2],10);r++)n.push(r);else n.push(parseInt(t[a],10))}return n}function N(e,t){var n={};if(t){var a=t.split(/\D/);n.seconds=[parseInt(a[5],10)],n.minutes=[parseInt(a[4],10)],n.hours=[parseInt(a[3],10)],n.dates=[parseInt(a[2],10)],n.months=[parseInt(a[1],10)],n.dows="?"}else{var i=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");6===i.length?(n.seconds=I(i[0]),n.minutes=I(i[1]),n.hours=I(i[2]),n.dates=I(i[3]),n.months=I(i[4]),n.dows=I(i[5])):(n.seconds=[0],n.minutes=I(i[0]),n.hours=I(i[1]),n.dates=I(i[2]),n.months=I(i[3]),n.dows=I(i[4]))}return n}function E(e){if("*"===e||"?"===e)return e;if("string"===typeof e&&(e=parseInt(e,10)),"object"!==typeof e&&(e=[e]),e.sort((function(e,t){return e-t})),e.length<3)return e.join(",");for(var t=[],n=e[0],a=e[0],i=1;i<e.length;i++)e[i]===a+1?a++:(n!==a?n+1===a?t.push("".concat(n,",").concat(a)):t.push("".concat(n,"-").concat(a)):t.push(n),n=e[i],a=e[i]);return n!==a?n+1===a?t.push("".concat(n,",").concat(a)):t.push("".concat(n,"-").concat(a)):t.push(n),t.join(",")}function _(e){var t=[];return e.seconds&&t.push(E(e.seconds)),t.push(E(e.minutes)),t.push(E(e.hours)),t.push(E(e.dates)),t.push(E(e.months)),t.push(E(e.dows)),t.join(" ")}function M(e,t){if("cron"===t){var n=N(e),a=new Date;return a.setHours(n.hours[0]),a.setMinutes(n.minutes[0]),a.setSeconds(n.seconds[0]),Array.isArray(n.dows)&&a.setDate(a.getDate()+n.dows[0]-a.getDay()),a}return"date"===t?new Date(e):null}function L(e,t){if("cron"===t)return{minutes:[(e=new Date(e.getTime())).getMinutes()],hours:[e.getHours()]};if("date"===t){var n=(e=new Date(e.getTime()-6e4*(new Date).getTimezoneOffset())).toISOString();return n.substring(0,n.length-5)}return null}var F=n(1413),A=n(72426),B=n.n(A),W=(n(15255),n(23333),n(42173),n(91115),n(593),n(45098),n(17897),n(63054),n(18300),n(44289),n(90283)),P=n(69783),R=n(36571),H=n(59665),V=n(80184),J={single:"single_description",double:"double_description",toggle:"toggle_description"},z=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function G(){return(G=(0,i.Z)((0,a.Z)().mark((function e(t,n){var i,r,o,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=6;break}return e.next=3,n.getObject(t);case 3:i=e.sent,e.next=7;break;case 6:i=t;case 7:if(r=null,!(i&&i.common&&i.common.icon)){e.next=12;break}r=k.Utils.getObjectIcon(i),e.next=31;break;case 12:if("state"!==i.type){e.next=31;break}return(o=i._id.split(".")).pop(),l=o.join("."),e.next=18,n.getObject(l);case 18:if(!((i=e.sent)&&i.common&&i.common.icon)){e.next=23;break}r=k.Utils.getObjectIcon(i),e.next=31;break;case 23:if(i&&"channel"!==i.type&&"device"!==i.type){e.next=31;break}return(o=i._id.split(".")).pop(),l=o.join("."),e.next=29,n.getObject(l);case 29:(i=e.sent)&&i.common&&i.common.icon&&(r=k.Utils.getObjectIcon(i));case 31:return e.abrupt("return",r);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=(0,s.withStyles)({field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:150},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133}})((function(e){var t,n,l,s,c,u,d,v,m,f,h,g,p=null!==(t=e.event)&&void 0!==t&&null!==(n=t.native)&&void 0!==n&&n.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,x=null!==(l=e.event)&&void 0!==l&&null!==(s=l.native)&&void 0!==s&&s.intervals&&e.event.native.intervals[0]&&void 0!==e.event.native.intervals[0].value?e.event.native.intervals[0].value:"",y=(0,o.useState)(!1),b=(0,r.Z)(y,2),j=b[0],w=b[1],S=(0,o.useState)(e.event),C=(0,r.Z)(S,2),O=C[0],D=C[1],I=(0,o.useState)(null),E=(0,r.Z)(I,2),A=E[0],U=E[1],K=(0,o.useState)(!1),Y=(0,r.Z)(K,2),$=Y[0],q=Y[1],Q=(0,o.useState)(p),X=(0,r.Z)(Q,2),ee=X[0],te=X[1],ne=(0,o.useState)(x),ae=(0,r.Z)(ne,2),ie=ae[0],re=ae[1],oe=(0,o.useState)({}),le=(0,r.Z)(oe,2),se=le[0],ce=le[1];B().locale(e.language);var ue=(0,o.useCallback)((function(e){var t=JSON.parse(JSON.stringify(O));e(t),D(t)}),[O]);(0,o.useEffect)((function(){var t,n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);var a,i=Z().getTimes(n,e.systemConfig.latitude,e.systemConfig.longitude);if(ce(i),null!==(t=O.native)&&void 0!==t&&t.oid){if(!A||A._id!==(null===(a=O.native)||void 0===a?void 0:a.oid))try{var r;e.socket.getObject(null===(r=O.native)||void 0===r?void 0:r.oid).then((function(t){var n;JSON.stringify(null===(n=O.native)||void 0===n?void 0:n.states)!==JSON.stringify(t.common.states)&&ue((function(e){return e.native.states=t.common.states})),(A||e.event.native.oid!==O.native.oid)&&function(e,t){return G.apply(this,arguments)}(t,e.socket).then((function(e){return ue((function(t){return t.common.icon=e}))})),U(t)}))}catch(o){console.error("Cannot get object ".concat(O.native.oid,": ").concat(o)),U(null)}}else U(null)}),[null===(c=O.native)||void 0===c?void 0:c.oid,e.socket,ue,null===(u=O.native)||void 0===u?void 0:u.states,A,null===(d=e.event)||void 0===d?void 0:d.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);var de,ve,me=null!==(v=O.native)&&void 0!==v&&v.cron?N(O.native.cron):null,fe="once";if(Array.isArray(null===me||void 0===me?void 0:me.months)?fe="monthly":Array.isArray(null===me||void 0===me?void 0:me.dows)&&(fe="daily"),O)if("once"===fe)de=M(null===(ve=O.native)||void 0===ve?void 0:ve.start,"date",e.serverTimeZone);else if("monthly"===fe||"daily"===fe){var he;de=M(null===(he=O.native)||void 0===he?void 0:he.cron,"cron",e.serverTimeZone)}var ge=JSON.stringify(e.event)!==JSON.stringify(O)||ee!==p||ie!==x,pe="monday"===(null===(m=e.systemConfig)||void 0===m?void 0:m.firstDayOfWeek)?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],xe=null!==(f=O.native)&&void 0!==f&&f.astro&&se?se[O.native.astro]:"",ye=xe?xe.toLocaleTimeString().replace(/:\d\d$/,""):"",be="";null!==(h=O.native)&&void 0!==h&&h.astro&&null!==(g=O.native)&&void 0!==g&&g.offset&&xe&&(be=new Date(xe.getTime()+6e4*O.native.offset).toLocaleTimeString().replace(/:\d\d$/,""));var je,we,Se,Ce,Te=null===O||void 0===O?void 0:O.common.icon;return!Te||Te.startsWith("data:image")||Te.startsWith("http")||Te.startsWith("/")||(Te="../../".concat(Te)),e.event?(0,V.jsxs)(T.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0,children:[(0,V.jsx)(T.DialogTitle,{children:e.t("Configure event")}),(0,V.jsxs)(T.DialogContent,{children:[j&&(0,V.jsx)(k.SelectID,{imagePrefix:"../..",selected:O.native.oid,disabled:e.readOnly,onOk:function(e){ue((function(t){return t.native.oid=e})),w(!1)},onClose:function(){return w(!1)},socket:e.socket}),(0,V.jsx)("div",{className:e.classes.field,children:(0,V.jsx)(T.FormControlLabel,{control:(0,V.jsx)(T.Checkbox,{checked:!(null===O||void 0===O||!O.common.enabled),disabled:e.readOnly,onChange:function(e){return ue((function(t){return t.common.enabled=e.target.checked}))}}),label:e.t("Active")})}),(0,V.jsxs)("div",{className:e.classes.field,children:[(0,V.jsxs)(T.FormControl,{variant:"standard",className:e.classes.timeType,children:[(0,V.jsx)(T.InputLabel,{children:e.t("Time type")}),(0,V.jsx)(T.Select,{value:O.native.astro?"astro":"time",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){"astro"===e.target.value?t.native.astro="sunrise":delete t.native.astro}))},renderValue:function(t){return e.t(t)},children:["time","astro"].map((function(t){return(0,V.jsx)(T.MenuItem,{value:t,children:(0,V.jsx)("div",{children:e.t(t)})},t)}))})]}),O.native.astro?(0,V.jsxs)(T.FormControl,{className:e.classes.narrowText,variant:"standard",children:[(0,V.jsx)(T.InputLabel,{children:e.t("Astronomic event")}),(0,V.jsx)(T.Select,{value:O.native.astro||"",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.native.astro=e.target.value}))},renderValue:function(t){return e.t(t)},children:z.map((function(t){return(0,V.jsx)(T.MenuItem,{value:t,children:(0,V.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,V.jsx)("span",{children:e.t(t)}),(0,V.jsx)("span",{style:{flexGrow:1}}),(0,V.jsxs)("span",{children:[" ","- [",se&&se[t]?se[t].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]"]})]})},t)}))})]}):(0,V.jsx)(R._,{dateAdapter:P.Z,children:(0,V.jsx)(W.j,{label:e.t("Time"),value:de||null,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(t){if(t)try{ue((function(n){if("once"===fe)n.native.start=L(t.toDate(),"date",e.serverTimeZone);else if("monthly"===fe||"daily"===fe){var a=N(n.native.cron),i=L(t.toDate(),"cron",e.serverTimeZone);a.hours=i.hours,a.minutes=i.minutes,n.native.cron=_(a)}}))}catch(n){}},renderInput:function(t){return(0,V.jsx)(T.TextField,(0,F.Z)((0,F.Z)({},t),{},{variant:"standard",className:e.classes.narrowText,helperText:de.getSeconds()?de.toLocaleTimeString():""}))},ampm:!1})}),O.native.astro?(0,V.jsxs)(T.FormControl,{variant:"standard",className:e.classes.width60,children:[(0,V.jsx)(T.InputLabel,{children:e.t("Offset")}),(0,V.jsx)(T.Select,{value:O.native.offset||0,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.native.offset=e.target.value}))},children:[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map((function(t){return(0,V.jsx)(T.MenuItem,{value:t.value,children:t.value<0?"- ".concat(e.t(t.label)):e.t(t.label)},t.value)}))})]}):null,e.isSimulation&&(0,V.jsx)(T.TextField,{className:e.classes.randomTime,label:e.t("Time random offset"),value:O.native.timeRandomOffset||0,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.native.timeRandomOffset=parseInt(e.target.value)}))},variant:"standard",InputProps:{endAdornment:(0,V.jsx)(T.InputAdornment,{position:"end",children:e.t("ms")})}})]}),O.native.astro?(0,V.jsxs)("div",{className:e.classes.field,children:[e.t("Today %s is at %s.",e.t(O.native.astro),ye),"\xa0",O.native.offset?e.t("With offset at %s.",be):null]}):null,(0,V.jsxs)("div",{className:e.classes.field,children:[!e.isSimulation&&(0,V.jsxs)(T.FormControl,{variant:"standard",className:e.classes.narrowText2,children:[(0,V.jsx)(T.InputLabel,{children:e.t("Event type")}),(0,V.jsx)(T.Select,{value:O.native.type||"",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(t){return ue((function(n){n.common.name===e.t(n.native.type)&&(n.common.name=e.t(t.target.value)),n.native.type=t.target.value}))},renderValue:function(t){return e.t(t)},children:["single","double","toggle"].map((function(t){return(0,V.jsx)(T.MenuItem,{value:t,children:(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{children:e.t(t)}),(0,V.jsx)("div",{className:e.classes.typeDescription,children:e.t(J[t])})]})},t)}))})]}),"single"!==O.native.type&&(0,V.jsx)(T.TextField,{label:e.t("Duration"),value:ee,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return te(e.target.value)},variant:"standard",className:e.classes.narrowText,InputProps:{endAdornment:(0,V.jsx)(T.InputAdornment,{position:"end",children:e.t("minutes")})}})]}),(0,V.jsx)("div",{className:e.classes.field,children:(0,V.jsxs)("div",{className:e.classes.selectId,children:[(0,V.jsx)(k.Icon,{src:Te||"",style:{width:32,height:32}}),(0,V.jsx)(T.TextField,{label:"Object ID",value:O.native.oid||"",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.native.oid=e.target.value}))},variant:"standard",helperText:(Se=(null===A||void 0===A?void 0:A.common.name)||"",Ce=e.language,Se&&"object"===typeof Se?Se[Ce]||Se.en:Se),fullWidth:!0}),(0,V.jsx)(T.Button,{onClick:function(){return w(!0)},children:"..."})]})}),(0,V.jsxs)("div",{className:e.classes.field,children:[(je="startValue",we="toggle"===O.native.type?"First value":"single"===O.native.type?"Desired value":"Start value",A?"boolean"===A.common.type?("startValue"===je&&"boolean"!==typeof O.native[je]&&setTimeout((function(){return ue((function(e){return e.native[je]=!!e.native[je]}))}),100),(0,V.jsx)(T.FormControlLabel,{className:e.classes.narrowText2,control:(0,V.jsx)(T.Checkbox,{checked:!!O.native[je],disabled:e.readOnly,onChange:function(e){return ue((function(t){return t.native[je]=e.target.checked}))}}),label:(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{children:e.t(we)}),(0,V.jsx)("div",{style:{fontSize:10,fontStyle:"italic"},children:e.t("Checked means ON, unchecked means OFF")})]})})):A.common.states?(0,V.jsxs)(T.FormControl,{className:e.classes.narrowText2,variant:"standard",children:[(0,V.jsx)(T.InputLabel,{children:e.t(we)}),(0,V.jsx)(T.Select,{value:O.native[je]||"",disabled:e.readOnly,onChange:function(e){return ue((function(t){return t.native[je]=e.target.value}))},children:Object.keys(A.common.states).map((function(e){return(0,V.jsx)(T.MenuItem,{value:e,children:A.common.states[e]},e)}))})]}):(0,V.jsx)(T.TextField,{className:e.classes.narrowText2,label:e.t(we),value:O.native[je]||"",disabled:e.readOnly,onChange:function(e){return ue((function(t){return t.native[je]=e.target.value}))},variant:"standard"}):null),"double"===O.native.type&&(A?"boolean"===A.common.type?("boolean"!==typeof ie&&setTimeout((function(){return re(!!ie)}),100),(0,V.jsx)(T.FormControlLabel,{className:e.classes.narrowText2,control:(0,V.jsx)(T.Checkbox,{checked:!!ie,disabled:e.readOnly,onChange:function(e){return re(e.target.checked)}}),label:(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{children:e.t("End value")}),(0,V.jsx)("div",{style:{fontSize:10,fontStyle:"italic"},children:e.t("Checked means ON, unchecked means OFF")})]})})):A.common.states?(0,V.jsxs)(T.FormControl,{className:e.classes.narrowText2,variant:"standard",children:[(0,V.jsx)(T.InputLabel,{children:e.t("End value")}),(0,V.jsx)(T.Select,{value:ie||"",disabled:e.readOnly,onChange:function(e){return re(e.target.value)},children:Object.keys(A.common.states).map((function(e){return(0,V.jsx)(T.MenuItem,{value:e,children:A.common.states[e]},e)}))})]}):(0,V.jsx)(T.TextField,{label:e.t("End value"),value:ie||"",disabled:e.readOnly,onChange:function(e){return re(e.target.value)},variant:"standard",className:e.classes.narrowText2}):null)]}),(0,V.jsxs)("div",{className:e.classes.field,children:[!e.isSimulation&&(0,V.jsxs)(T.FormControl,{variant:"standard",children:[(0,V.jsx)(T.InputLabel,{children:e.t("Period")}),(0,V.jsx)(T.Select,{value:fe||"once",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(t){t.target.value!==O.native.cron&&ue((function(n){if("once"===t.target.value)delete n.native.cron,n.native.start=L(de,"date",e.serverTimeZone);else if("daily"===t.target.value){delete n.native.start;var a=N("0 0 ? * 0-6"),i=L(de,"cron",e.serverTimeZone);a.hours=i.hours,a.minutes=i.minutes,n.native.cron=_(a)}else if("monthly"===t.target.value){delete n.native.start;var r=N("0 0 * 1-12 *"),o=L(de,"cron",e.serverTimeZone);r.hours=o.hours,r.minutes=o.minutes,n.native.cron=_(r)}}))},children:["once","daily","monthly"].map((function(t){return(0,V.jsx)(T.MenuItem,{value:t,children:e.t(t)},t)}))})]}),"daily"===fe&&(!e.isSimulation||"week"===e.simulation.native.interval)&&(0,V.jsxs)("table",{className:e.classes.dayTable,style:e.isSimulation?{marginLeft:0}:void 0,children:[(0,V.jsx)("thead",{children:(0,V.jsx)("tr",{children:pe.map((function(t){return(0,V.jsx)("td",{className:e.classes.tableCell,children:B()().day(t).format("ddd")},t)}))})}),(0,V.jsx)("tbody",{children:(0,V.jsx)("tr",{children:pe.map((function(t){var n;return(0,V.jsx)("td",{children:(0,V.jsx)(T.Checkbox,{checked:(null===me||void 0===me||null===(n=me.dows)||void 0===n?void 0:n.includes(t))||!1,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){ue((function(n){var a=N(n.native.cron);e.target.checked?a.dows.push(t):a.dows=a.dows.filter((function(e){return e!==t})),n.native.cron=_(a)}))},size:"small"})},t)}))})})]})]}),"monthly"===fe&&(0,V.jsx)("div",{className:e.classes.field,children:(0,V.jsxs)("table",{children:[(0,V.jsx)("thead",{children:(0,V.jsx)("tr",{children:new Array(12).fill(null).map((function(t,n){return(0,V.jsx)("td",{className:e.classes.tableCell,children:B()().month(n).format("MMM")},n)}))})}),(0,V.jsx)("tbody",{children:(0,V.jsx)("tr",{children:new Array(12).fill(null).map((function(t,n){var a;return(0,V.jsx)("td",{children:(0,V.jsx)(T.Checkbox,{checked:(null===me||void 0===me||null===(a=me.months)||void 0===a?void 0:a.includes(n+1))||!1,disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){ue((function(t){var a=N(t.native.cron);e.target.checked?a.months.push(n+1):a.months=a.months.filter((function(e){return e!==n+1})),t.native.cron=_(a)}))},size:"small"})},n)}))})})]})}),(0,V.jsx)("div",{className:e.classes.field,children:(0,V.jsx)(T.TextField,{label:"Description",value:(null===O||void 0===O?void 0:O.common.name)||"",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.common.name=e.target.value}))},variant:"standard",fullWidth:!0})}),(0,V.jsx)("div",{className:e.classes.narrowColor,children:(0,V.jsx)(k.ColorPicker,{value:O.common.color||O.native.color||"",disabled:e.readOnly||!(null!==O&&void 0!==O&&O.common.enabled),onChange:function(e){return ue((function(t){return t.common.color=e}))},name:e.t("Color")})})]}),(0,V.jsxs)(T.DialogActions,{children:[e.readOnly?null:(0,V.jsx)(T.Button,{variant:"contained",color:"secondary",startIcon:(0,V.jsx)(H.Delete,{}),onClick:function(){return q(!0)},children:e.t("Delete")}),e.readOnly||e.widget?null:(0,V.jsx)("div",{style:{flex:1}}),e.readOnly?null:(0,V.jsx)(T.Button,{variant:"contained",color:"primary",disabled:!ge,startIcon:(0,V.jsx)(H.Save,{}),onClick:(0,i.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"single"===O.native.type?O.native.intervals&&delete O.native.intervals:"double"===O.native.type?(O.native.intervals=O.native.intervals||[],O.native.intervals[0]=O.native.intervals[0]||{},O.native.intervals[0].timeOffset=6e4*(parseFloat(ee)||1),O.native.intervals[0].value=ie):"toggle"===O.native.type&&(O.native.intervals=O.native.intervals||[],O.native.intervals[0]=O.native.intervals[0]||{},O.native.intervals[0].timeOffset=6e4*(parseFloat(ee)||1)),t.next=3,e.setEvent(O._id,O);case 3:e.updateEvents(),e.onClose();case 5:case"end":return t.stop()}}),t)}))),children:e.t("Save")}),(0,V.jsx)(T.Button,{variant:"contained",color:"grey",startIcon:(0,V.jsx)(H.Cancel,{}),onClick:e.onClose,children:e.readOnly||!ge?e.t("ra_Close"):e.t("ra_Cancel")})]}),$&&(0,V.jsx)(k.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return t.prev=1,t.next=4,e.deleteEvent(O._id);case 4:e.updateEvents(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),window.alert("Cannot delete event: ".concat(t.t0));case 10:e.onClose();case 11:q(!1);case 12:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}()})]}):null})),K=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],Y=[1,2,3,5,10,15,20,30,60],$=function(e){var t=e.type,n=e.t,a=e.color,i=(0,o.useRef)(null);return(0,o.useEffect)((function(){var e=new v._l(i.current,{eventData:function(){return{id:t.type,title:n(t.name),create:!0,extendedProps:{type:t.type}}}});return function(){e.destroy()}}),[]),(0,V.jsx)("div",{style:{backgroundColor:a||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:i,children:n(t.name)})};function q(e){if(e)return e.startsWith("#")?4===e.length?"#".concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2]).concat(e[3]).concat(e[3],"50"):"".concat(e.substring(0,7),"50"):e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function Q(e){return e.date.second?"".concat(e.date.hour,":").concat(e.date.minute.toString().padStart(2,"0"),":").concat(e.date.second.toString().padStart(2,"0")):"".concat(e.date.hour,":").concat(e.date.minute.toString().padStart(2,"0"))}var X=(0,s.withTheme)((0,s.withStyles)((function(){return{container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"}}}))((function(e){var t,n,s=(0,o.useState)(null),D=(0,r.Z)(s,2),I=D[0],E=D[1],F=(0,o.useState)(e.dayStep||parseInt(window.localStorage.getItem("calendarStep"),10)||30),A=(0,r.Z)(F,2),B=A[0],W=A[1],P=e.storageName||"calendar",R=(0,o.useRef)(null),H=(0,o.useRef)(null),J=(0,o.useRef)(null),z=(0,o.useRef)(null),G=(0,o.useRef)(null),X=(0,o.useState)({start:null,end:null}),ee=(0,r.Z)(X,2),te=ee[0],ne=ee[1],ae=(!e.widget&&window.localStorage.getItem("".concat(P,"Start")),new Date),ie=e.viewMode||window.localStorage.getItem("".concat(P,"View"))||"dayGridMonth";e.isSimulation&&(ae=new Date,ie="day"===(null===(n=e.simulation)||void 0===n?void 0:n.native.interval)?"timeGridDay":"timeGridWeek");var re=K;e.isSimulation&&(re=re.filter((function(e){return"single"===e.type})));var oe=(0,o.useMemo)((function(){var t=[];return e.events.forEach((function(n){var a;if(n){var i=null!==(a=n.native)&&void 0!==a&&a.intervals&&n.native.intervals[0]&&n.native.intervals[0].timeOffset?n.native.intervals[0].timeOffset:30;n.common.color=n.common.color||"#3a87b2";var r=n.common.enabled?n.common.color:q(n.common.color),o=k.Utils.invertColor(n.common.color,!0);n.common.enabled||(o=q(o));var l=n.common.name;if(n.native.oid){var s,c,u=n.native.startValue;"boolean"===typeof u?u=u?k.I18n.t("ON"):k.I18n.t("OFF"):n.native.states&&n.native.states[u]&&(u=n.native.states[u]);var d,v,m,f,h=null===(s=n.native.intervals)||void 0===s||null===(c=s[0])||void 0===c?void 0:c.value;if("boolean"===typeof h?h=h?k.I18n.t("ON"):k.I18n.t("OFF"):n.native.states&&n.native.states[h]&&(h=n.native.states[h]),l="".concat(n.common.name," \u2192 ").concat(u),"double"===n.native.type)l+=" \u2192 ".concat(((null===(d=n.native.intervals)||void 0===d||null===(v=d[0])||void 0===v?void 0:v.timeOffset)||0)/1e3/60," ").concat(k.I18n.t("min"),". \u2192 ").concat(h);if("toggle"===n.native.type)l+=" \u2192 ".concat(((null===(m=n.native.intervals)||void 0===m||null===(f=m[0])||void 0===f?void 0:f.timeOffset)||0)/1e3/60," ").concat(k.I18n.t("min"),". \u2192 ").concat(k.I18n.t("initial"))}if(n.native.cron){var g=M(n.native.cron,"cron",e.serverTimeZone),p=N(n.native.cron);if(g.setFullYear((new Date).getFullYear()-1),Array.isArray(p.months))new O.Ci({dtstart:g,until:te.end||new Date,freq:O.Ci.WEEKLY,bymonth:p.months}).between(te.start||new Date,te.end||new Date).forEach((function(a){var i=n.native.astro?Z().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:a;n.native.astro&&n.native.offset&&i.setMinutes(i.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:i.getSeconds()},title:l,backgroundColor:r,textColor:o,start:i,allDay:!1,display:"block"})}));else if(Array.isArray(p.dows)){new O.Ci({dtstart:g,until:te.end||new Date,freq:O.Ci.WEEKLY,byweekday:p.dows.map((function(e){return 0===e?6:e-1}))}).between(te.start||new Date,te.end||new Date).forEach((function(a){var i=n.native.astro?Z().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:a;n.native.astro&&n.native.offset&&i.setMinutes(i.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:i.getSeconds()},title:l,backgroundColor:r,textColor:o,start:i,allDay:!1,display:"block"})}))}else t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:0},title:l,backgroundColor:r,textColor:o,icon:n.common.icon})}else{var x=n.native.astro?Z().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:n.native.start;n.native.astro&&n.native.offset&&x.setMinutes(x.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:0},title:l,display:"block",backgroundColor:r,textColor:o,start:M(x,"date",e.serverTimeZone),end:M(new Date(new Date(x).getTime()+i),"date",e.serverTimeZone)})}}})),t}),[e.events,e.serverTimeZone,e.systemConfig.latitude,e.systemConfig.longitude,te.end,te.start]);if((0,o.useEffect)((function(){if(e.widget){setTimeout((function e(){var t,n=null===(t=R.current)||void 0===t?void 0:t.getApi();n&&(console.log("Scroll to now"),n.scrollToTime((new Date).getTime())),J.current?z.current=null:z.current=setTimeout((function(){return e}),3e5)}),1e3)}return function(){z.current&&clearTimeout(z.current),z.current=null,J.current&&clearTimeout(J.current),J.current=null}}),[]),(0,o.useEffect)((function(){G.current=null,setTimeout((function(){var e,t=new Date;null===(e=R.current)||void 0===e||e.getApi().scrollToTime("".concat(t.getHours().toString().padStart(2,"0"),":").concat((B>t.getMinutes()?0:t.getMinutes()-B).toString().padStart(2,"0"),":00"))}),300)}),[e.calendarPrefix,e.simulationId,B]),(0,o.useEffect)((function(){if(e.isSimulation){var t,n,a=null===(t=R.current)||void 0===t?void 0:t.getApi();null===a||void 0===a||a.changeView("day"===(null===(n=e.simulation)||void 0===n?void 0:n.native.interval)?"timeGridDay":"timeGridWeek",new Date)}}),[e.isSimulation,null===(t=e.simulation)||void 0===t?void 0:t.native.interval]),e.isSimulation&&!e.simulation)return null;var le=G.current?void 0:new Date,se=le?"".concat(le.getHours().toString().padStart(2,"0"),":").concat((B>le.getMinutes()?0:le.getMinutes()-B).toString().padStart(2,"0"),":00"):void 0;return console.log("SCROLL TIME: ".concat(se)),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("style",{children:"dark"===e.theme.palette.mode?"\n:root {\n    --fc-neutral-bg-color: hsla(0,0%,12%);\n    --fc-list-event-hover-bg-color: hsla(0,0%,12%);\n}\n.fc-col-header-cell {\n    background-color: #1e1e1e;\n}                \n":"\n.fc-col-header-cell {\n    background-color: #EEEEEE;\n}\n"}),I?(0,V.jsx)(U,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find((function(e){return(null===e||void 0===e?void 0:e._id)===I})),onClose:function(){E(null);var e=G.current?new Date(G.current):new Date,t="".concat(e.getHours().toString().padStart(2,"0"),":").concat((B>e.getMinutes()?0:e.getMinutes()-B).toString().padStart(2,"0"),":00");setTimeout((function(){var e;return null===(e=R.current)||void 0===e?void 0:e.getApi().scrollToTime(t)}),200)},socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:function(t){E(null),e.deleteEvent(t)},serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,(0,V.jsxs)("div",{className:e.classes.container,children:[!e.hideLeftBlock&&!e.readOnly&&(0,V.jsxs)("div",{className:e.classes.leftBlock,children:[(0,V.jsx)(T.Paper,{elevation:4,className:e.classes.leftPaper,children:(0,V.jsxs)("div",{className:e.classes.leftContent,children:[(0,V.jsx)("h4",{children:e.t("Events")}),re.map((function(t,n){var a,i;return(0,V.jsx)($,{t:e.t,type:t,name:e.t(t.name),index:n,color:e.isSimulation?null===(a=e.simulation)||void 0===a||null===(i=a.common)||void 0===i?void 0:i.color:void 0},t.type)})),e.hideLeftBlockHint?null:(0,V.jsx)("div",{children:e.t("Drag and drop the events above to create a new one.")}),e.hideLeftBlockHint?null:(0,V.jsx)("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:(0,V.jsx)("div",{children:e.t("Use ALT by dragging it to copy the events.")}),e.hideLeftBlockHint?null:(0,V.jsx)("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:(0,V.jsx)("div",{children:e.t("Use double click on calendar to add new events.")}),e.hideLeftBlockHint?null:(0,V.jsx)("hr",{className:e.classes.hr}),e.hideLeftBlockHint?null:(0,V.jsxs)(T.FormControl,{fullWidth:!0,variant:"standard",children:[(0,V.jsx)(T.InputLabel,{children:e.t("Zoom")}),(0,V.jsx)(T.Select,{value:B,onChange:function(e){var t,n;if(null!==(t=R.current)&&void 0!==t&&null!==(n=t.elRef)&&void 0!==n&&n.current){var a=function(e){for(var t=e.getBoundingClientRect(),n=e.getElementsByClassName("fc-timegrid-slot"),a=0;a<n.length;a++)if(n[a].getBoundingClientRect().top>t.top+100)return n[a].dataset.time;return null}(R.current.elRef.current);a&&setTimeout((function(){var e;return null===(e=R.current)||void 0===e?void 0:e.getApi().scrollToTime(a)}),300)}window.localStorage.setItem("calendarStep",e.target.value.toString()),W(e.target.value)},children:Y.map((function(t){return(0,V.jsxs)(T.MenuItem,{value:t,children:[t,e.t("min")]},t)}))})]})]})}),e.button]}),(0,V.jsx)("div",{className:e.classes.calendarBlock,children:(0,V.jsx)("div",{className:e.classes.calendar,children:(0,V.jsx)(c.Z,{ref:R,plugins:[f.Z,u.Z,d.Z,v.ZP,m.Z],weekends:!e.hideWeekends,headerToolbar:!e.hideTopBlock&&{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},eventTimeFormat:e.isSimulation?Q:void 0,slotDuration:"00:".concat(B.toString().padStart(2,"0"),":00"),eventMinHeight:20,initialView:ie,initialDate:ae,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,defaultTimedEventDuration:"00:".concat(B.toString().padStart(2,"0")),events:oe,height:"calc(100% - 20px)",locales:[h.Z,g.Z,p.Z,x.Z,y.Z,b.Z,j.Z,w.Z,S.Z,C.Z],locale:e.language,datesSet:function(t){var n,a;t.start.toString()===(null===(n=te.start)||void 0===n?void 0:n.toString())&&t.end.toString()===(null===(a=te.end)||void 0===a?void 0:a.toString())||(G.current=null,ne({start:t.start,end:t.end})),e.widget?(z.current&&clearTimeout(z.current),z.current=null,J.current&&clearTimeout(J.current),J.current=setTimeout((function(){J.current=null;!function e(){var t,n=null===(t=R.current)||void 0===t?void 0:t.getApi();null===n||void 0===n||n.scrollToTime((new Date).getTime()),J.current?z.current=null:z.current=setTimeout((function(){return e}),3e5)}()}),6e4)):window.localStorage.setItem("".concat(P,"View"),t.view.type)},eventClick:function(e){G.current=new Date(e.event.start).getTime(),E(e.event.extendedProps.eventId)},eventResize:function(t){var n;G.current=new Date(t.event.start).getTime();var a=e.events.find((function(e){return e._id===t.event.extendedProps.eventId}));if(null!==(n=a.native.intervals)&&void 0!==n&&n[0].timeOffset){var i=JSON.parse(JSON.stringify(a));i.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(i._id,i),e.updateEvents()}else t.revert()},eventDrop:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r,o,s,c,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(G.current=new Date(n.event.start).getTime(),null===(r=e.events.find((function(e){return e._id===n.event.extendedProps.eventId})))||void 0===r||null===(i=r.native)||void 0===i||!i.cron){t.next=15;break}return o=JSON.parse(JSON.stringify(r)),n.jsEvent.altKey&&(o._id="".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,l.Z)())),s=N(o.native.cron),c=L(n.event.start,"cron",e.serverTimeZone),s.hours=c.hours,s.minutes=c.minutes,o.native.cron=_(s),t.next=12,e.setEvent(o._id,o);case 12:e.updateEvents(),t.next=21;break;case 15:return u=JSON.parse(JSON.stringify(r)),n.jsEvent.altKey&&(u._id="".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,l.Z)())),u.native.start=L(n.event.start,"date",e.serverTimeZone),t.next=20,e.setEvent(u._id,u);case 20:e.updateEvents();case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),eventReceive:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={_id:"".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,l.Z)()),common:{name:n.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:L(n.event.start,"date",e.serverTimeZone),type:n.event.extendedProps.type,oid:"",startValue:""},type:"schedule"},"single"!==n.event.extendedProps.type&&(i.native.intervals=[{timeOffset:18e5}]),e.isSimulation&&(i.common.color=e.simulation.common.color||i.common.color,delete i.native.start,(r=L(n.event.start,"cron",e.serverTimeZone)).dows="day"===e.simulation.native.interval?[0,1,2,3,4,5,6]:[n.event.start.getDay()],r.dates=["?"],r.months=["*"],i.native.cron=_(r),i.native.record={states:[],enums:[],start:null,end:null}),G.current=new Date(n.event.start).getTime(),t.next=6,e.setEvent(i._id,i);case 6:e.updateEvents(),setTimeout((function(){return E(i._id)}),100);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),eventDidMount:function(e){var t=e.event.extendedProps.icon;if(t){var n=window.document.createElement("img");t.startsWith("data:image")||t.startsWith("http")||t.startsWith("/")||(t="../../".concat(t)),n.setAttribute("src",t),n.className="icon",n.style.width="20px",n.style.height="20px";var a=e.el.getElementsByClassName("fc-event-title-container");if(a.length){a[0].prepend(n);var i=a[0].getElementsByClassName("fc-event-title");i.length&&(i[0].style.marginLeft="23px")}}},select:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.view.calendar.unselect(),!e.readOnly){t.next=4;break}return t.abrupt("return");case 4:if(i=n.end.getTime()-n.start.getTime(),H.current&&!(Date.now()-H.current>500)||18e5!==i){t.next=8;break}return H.current=Date.now(),t.abrupt("return");case 8:return r={_id:"".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,l.Z)()),common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:L(n.date||n.start,"date",e.serverTimeZone),intervals:n.end&&!e.isSimulation?[{value:"",timeOffset:n.end.getTime()-n.start.getTime()}]:void 0,type:n.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"},e.isSimulation&&(r.common.color=e.simulation.common.color||r.common.color),G.current=new Date(r.native.start).getTime(),t.next=13,e.setEvent(r._id,r);case 13:return t.next=15,e.updateEvents();case 15:setTimeout((function(){return E(r._id)}),100);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})})]})]})})))},54794:function(e,t,n){var a=n(15671),i=n(43144),r=n(60136),o=n(27277),l=n(4819),s=n.n(l),c=n(94427),u=n(75606),d=n(88411),v=n(80184),m=window.visRxWidget||d.VisRxWidget,f=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).state={list:[{value:"",label:m.t("default")}]},i}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.instance&&this.props.socket.getObjectViewSystem("folder","fullcalendar.".concat(this.props.instance,".Calendars."),"fullcalendar.".concat(this.props.instance,".Calendars.\u9999")).then((function(t){var a=Object.keys(t).map((function(e){return{value:e,label:n.getText(t[e].common.name)}}));a.unshift({value:"",label:m.t("default")}),e.setState({list:a})}))}},{key:"render",value:function(){var e=this;return(0,v.jsx)(c.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"",onChange:function(t){return e.props.onChange(t.target.value)},children:this.state.list.map((function(e){return(0,v.jsx)(c.MenuItem,{value:e.value,children:e.label},e.value)}))})}}],[{key:"getText",value:function(e){return"object"===typeof e?e[u.I18n.getLanguage()]||e.en:e}}]),n}(s().Component);t.Z=f}}]);
//# sourceMappingURL=src_Component_Calendar_js-src_Component_CalendarsSelector_js.60385a5f.chunk.js.map