"use strict";(self.webpackChunkiobroker_vis_2_widgets_fullcalendar=self.webpackChunkiobroker_vis_2_widgets_fullcalendar||[]).push([["src_FullCalendar_jsx"],{53096:function(e,t,n){n.r(t),n.d(t,{default:function(){return pe}});var a=n(74165),i=n(15861),r=n(15671),l=n(43144),o=n(11752),s=n(61120),c=n(60136),d=n(27277),u=n(4819),v=n.n(u),m=n(15854),f=n.n(m),h=n(75606),p=n(78997),g=n(54261),x=n(90575),y=n(38217),b=n(52720),w=n(74332),j=n(26309),k=n(49704),C=n(96906),S=n(59862),T=n(21431),D=n(82104),Z=n(29688),O=n(89283),I=n(10207),_=n(44417),E=n(35422),M=n(32201),B=n(94427),A=n(36402),L=n(35325),F=n.n(L);function W(e){if("*"===e||"?"===e||""===e)return e;for(var t=e.split(","),n=[],a=0;a<t.length;a++){var i=t[a].match(/(\d+)-(\d+)/);if(i)for(var r=parseInt(i[1],10);r<=parseInt(i[2],10);r++)n.push(r);else n.push(parseInt(t[a],10))}return n}function N(e,t){var n={};if(t){var a=t.split(/\D/);n.seconds=[parseInt(a[5],10)],n.minutes=[parseInt(a[4],10)],n.hours=[parseInt(a[3],10)],n.dates=[parseInt(a[2],10)],n.months=[parseInt(a[1],10)],n.dows="?"}else{var i=e.replace(/\s\s/g," ").replace(/\s\s/g," ").split(" ");6===i.length?(n.seconds=W(i[0]),n.minutes=W(i[1]),n.hours=W(i[2]),n.dates=W(i[3]),n.months=W(i[4]),n.dows=W(i[5])):(n.seconds=[0],n.minutes=W(i[0]),n.hours=W(i[1]),n.dates=W(i[2]),n.months=W(i[3]),n.dows=W(i[4]))}return n}function P(e){if("*"===e||"?"===e)return e;if("string"===typeof e&&(e=parseInt(e,10)),"object"!==typeof e&&(e=[e]),e.sort((function(e,t){return e-t})),e.length<3)return e.join(",");for(var t=[],n=e[0],a=e[0],i=1;i<e.length;i++)e[i]===a+1?a++:(n!==a?n+1===a?t.push("".concat(n,",").concat(a)):t.push("".concat(n,"-").concat(a)):t.push(n),n=e[i],a=e[i]);return n!==a?n+1===a?t.push("".concat(n,",").concat(a)):t.push("".concat(n,"-").concat(a)):t.push(n),t.join(",")}function R(e){var t=[];return e.seconds&&t.push(P(e.seconds)),t.push(P(e.minutes)),t.push(P(e.hours)),t.push(P(e.dates)),t.push(P(e.months)),t.push(P(e.dows)),t.join(" ")}function H(e,t){if("cron"===t){var n=N(e),a=new Date;return a.setHours(n.hours[0]),a.setMinutes(n.minutes[0]),a.setSeconds(n.seconds[0]),Array.isArray(n.dows)&&a.setDate(a.getDate()+n.dows[0]-a.getDay()),a}return"date"===t?new Date(e):null}function G(e,t){if("cron"===t)return{minutes:[(e=new Date(e.getTime())).getMinutes()],hours:[e.getHours()]};if("date"===t){var n=(e=new Date(e.getTime()-6e4*(new Date).getTimezoneOffset())).toISOString();return n.substring(0,n.length-5)}return null}var J=n(1413),V=n(72426),z=n.n(V),U=(n(15255),n(23333),n(42173),n(91115),n(593),n(45098),n(17897),n(63054),n(18300),n(44289),n(97892)),Y=n.n(U),$=n(54225),K=n(24750),q=n(71652),Q=n(59665),X=n(80184),ee={single:"single_description",double:"double_description",toggle:"toggle_description"},te={field:{padding:"2px 0px"},tableCell:{textAlign:"center"},typeDescription:{fontSize:12,whiteSpace:"normal",fontStyle:"italic"},selectId:{display:"flex",alignItems:"center",gap:8},timeType:{width:150},narrowText:{width:140,marginLeft:8},width60:{width:80,marginLeft:16},narrowText2:{minWidth:150,marginRight:8},narrowColor:{width:200},dayTable:{marginLeft:20,display:"inline-block"},randomTime:{marginLeft:16,width:133},timeSelector:function(e){return{marginLeft:"16px",marginTop:"7.5px",width:120,borderBottomColor:"dark"===e.palette.mode?"#FFFFFFB2":"#000000B2"}},days:function(e){return{backgroundColor:"dark"===e.palette.mode?"#656565":"#dadada"}}},ne=["sunrise","sunriseEnd","goldenHourEnd","solarNoon","goldenHour","sunsetStart","sunset","dusk","nauticalDusk","night","nadir","nightEnd","nauticalDawn","dawn"];function ae(){return(ae=(0,i.Z)((0,a.Z)().mark((function e(t,n){var i,r,l,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=6;break}return e.next=3,n.getObject(t);case 3:i=e.sent,e.next=7;break;case 6:i=t;case 7:if(r=null,!(i&&i.common&&i.common.icon)){e.next=12;break}r=h.Utils.getObjectIcon(i),e.next=31;break;case 12:if("state"!==i.type){e.next=31;break}return(l=i._id.split(".")).pop(),o=l.join("."),e.next=18,n.getObject(o);case 18:if(!((i=e.sent)&&i.common&&i.common.icon)){e.next=23;break}r=h.Utils.getObjectIcon(i),e.next=31;break;case 23:if(i&&"channel"!==i.type&&"device"!==i.type){e.next=31;break}return(l=i._id.split(".")).pop(),o=l.join("."),e.next=29,n.getObject(o);case 29:(i=e.sent)&&i.common&&i.common.icon&&(r=h.Utils.getObjectIcon(i));case 31:return e.abrupt("return",r);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(e){var t,n,r,l,o,s,c,d,v,m,f,g,x,y,b,w,j=null!==(t=e.event)&&void 0!==t&&null!==(n=t.native)&&void 0!==n&&n.intervals&&e.event.native.intervals[0]&&e.event.native.intervals[0].timeOffset?e.event.native.intervals[0].timeOffset/6e4:0,k=null!==(r=e.event)&&void 0!==r&&null!==(l=r.native)&&void 0!==l&&l.intervals&&e.event.native.intervals[0]&&void 0!==e.event.native.intervals[0].value?e.event.native.intervals[0].value:"",C=(0,u.useState)(!1),S=(0,p.Z)(C,2),T=S[0],D=S[1],Z=(0,u.useState)(e.event),O=(0,p.Z)(Z,2),I=O[0],_=O[1],E=(0,u.useState)(null),M=(0,p.Z)(E,2),A=M[0],L=M[1],W=(0,u.useState)(!1),P=(0,p.Z)(W,2),V=P[0],U=P[1],ie=(0,u.useState)(j),re=(0,p.Z)(ie,2),le=re[0],oe=re[1],se=(0,u.useState)(k),ce=(0,p.Z)(se,2),de=ce[0],ue=ce[1],ve=(0,u.useState)({}),me=(0,p.Z)(ve,2),fe=me[0],he=me[1];z().locale(e.language);var pe=(0,u.useCallback)((function(e){var t=JSON.parse(JSON.stringify(I));e(t),_(t)}),[I]);(0,u.useEffect)((function(){var t,n=new Date;n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);var a,i=F().getTimes(n,e.systemConfig.latitude,e.systemConfig.longitude);if(he(i),null!==(t=I.native)&&void 0!==t&&t.oid){if(!A||A._id!==(null===(a=I.native)||void 0===a?void 0:a.oid))try{var r;e.socket.getObject(null===(r=I.native)||void 0===r?void 0:r.oid).then((function(t){var n;JSON.stringify(null===(n=I.native)||void 0===n?void 0:n.states)!==JSON.stringify(t.common.states)&&pe((function(e){return e.native.states=t.common.states})),(A||e.event.native.oid!==I.native.oid)&&function(e,t){return ae.apply(this,arguments)}(t,e.socket).then((function(e){return pe((function(t){return t.common.icon=e}))})),L(t)}))}catch(l){console.error("Cannot get object ".concat(I.native.oid,": ").concat(l)),L(null)}}else L(null)}),[null===(o=I.native)||void 0===o?void 0:o.oid,e.socket,pe,null===(s=I.native)||void 0===s?void 0:s.states,A,null===(c=e.event)||void 0===c?void 0:c.native.oid,e.systemConfig.latitude,e.systemConfig.longitude]);var ge,xe,ye=null!==(d=I.native)&&void 0!==d&&d.cron?N(I.native.cron):null,be="once",we=29;if(Array.isArray(null===ye||void 0===ye?void 0:ye.months)){var je,ke;be="monthly";var Ce=[4,6,9,11],Se=[1,3,5,7,8,10,12];null!==(je=ye.months)&&void 0!==je&&je.find((function(e){return Se.includes(e)}))?we=31:null!==(ke=ye.months)&&void 0!==ke&&ke.find((function(e){return Ce.includes(e)}))&&(we=30)}else Array.isArray(null===ye||void 0===ye?void 0:ye.dows)&&(be="daily");if(I)if("once"===be)ge=H(null===(xe=I.native)||void 0===xe?void 0:xe.start,"date",e.serverTimeZone);else if("monthly"===be||"daily"===be){var Te;ge=H(null===(Te=I.native)||void 0===Te?void 0:Te.cron,"cron",e.serverTimeZone)}var De=JSON.stringify(e.event)!==JSON.stringify(I)||le!==j||de!==k,Ze="monday"===(null===(v=e.systemConfig)||void 0===v?void 0:v.firstDayOfWeek)?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6],Oe=null!==(m=I.native)&&void 0!==m&&m.astro&&fe?fe[I.native.astro]:"",Ie=Oe?Oe.toLocaleTimeString().replace(/:\d\d$/,""):"",_e="";null!==(f=I.native)&&void 0!==f&&f.astro&&null!==(g=I.native)&&void 0!==g&&g.offset&&Oe&&(_e=new Date(Oe.getTime()+6e4*I.native.offset).toLocaleTimeString().replace(/:\d\d$/,""));var Ee,Me,Be,Ae,Le=null===I||void 0===I?void 0:I.common.icon;return!Le||Le.startsWith("data:image")||Le.startsWith("http")||Le.startsWith("/")||(Le="../../".concat(Le)),e.event?(0,X.jsxs)(B.Dialog,{open:!0,onClose:e.onClose,fullWidth:!0,children:[(0,X.jsx)(B.DialogTitle,{children:e.t("Configure event")}),(0,X.jsxs)(B.DialogContent,{children:[T&&(0,X.jsx)(h.SelectID,{imagePrefix:"../..",theme:e.theme,selected:I.native.oid,disabled:e.readOnly,onOk:function(e){pe((function(t){return t.native.oid=e})),D(!1)},onClose:function(){return D(!1)},socket:e.socket}),(0,X.jsx)("div",{style:te.field,children:(0,X.jsx)(B.FormControlLabel,{control:(0,X.jsx)(B.Checkbox,{checked:!(null===I||void 0===I||!I.common.enabled),disabled:e.readOnly,onChange:function(e){return pe((function(t){return t.common.enabled=e.target.checked}))}}),label:e.t("Active")})}),(0,X.jsxs)("div",{style:te.field,children:[(0,X.jsxs)(B.FormControl,{style:(0,J.Z)((0,J.Z)({},te.timeType),{},{width:180}),variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t("Time type")}),(0,X.jsx)(B.Select,{value:I.native.astro?"astro":"time",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){"astro"===e.target.value?t.native.astro="sunrise":delete t.native.astro}))},renderValue:function(t){return e.t(t)},children:["time","astro"].map((function(t){return(0,X.jsx)(B.MenuItem,{value:t,children:(0,X.jsx)("div",{children:e.t(t)})},t)}))})]}),I.native.astro?(0,X.jsxs)(B.FormControl,{style:(0,J.Z)((0,J.Z)({},te.narrowText),{},{width:250}),variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t("Astronomic event")}),(0,X.jsx)(B.Select,{value:I.native.astro||"",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.native.astro=e.target.value}))},renderValue:function(t){return e.t(t)},children:ne.map((function(t){return(0,X.jsx)(B.MenuItem,{value:t,children:(0,X.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,X.jsx)("span",{children:e.t(t)}),(0,X.jsx)("span",{style:{flexGrow:1}}),(0,X.jsxs)("span",{children:[" ","- [",fe&&fe[t]?fe[t].toLocaleTimeString().replace(/:\d\d$/,""):"??:??","]"]})]})},t)}))})]}):(0,X.jsx)(q._,{dateAdapter:K.y,children:(0,X.jsx)($.j,{sx:function(e){return{borderBottom:"1px solid ".concat(e.palette.text.primary),"& fieldset":{display:"none"},"& input":{padding:"".concat(e.spacing(1.5)," 0 4px 0")},"& .MuiInputAdornment-root":{marginLeft:0,marginTop:1},"& label":{transform:"translate(0px, -9px) scale(0.75)"},"&.MuiFormControl-root":te.timeSelector}},label:e.t("Time"),variant:"standard",value:ge?Y()(ge):null,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(t){if(t)try{pe((function(n){if("once"===be)n.native.start=G(t.toDate(),"date",e.serverTimeZone);else if("monthly"===be||"daily"===be){var a=N(n.native.cron),i=G(t.toDate(),"cron",e.serverTimeZone);a.hours=i.hours,a.minutes=i.minutes,n.native.cron=R(a)}}))}catch(n){}},renderInput:function(e){return(0,X.jsx)(B.TextField,(0,J.Z)((0,J.Z)({},e),{},{variant:"standard",style:(0,J.Z)({},te.narrowText),helperText:ge.getSeconds()?ge.toLocaleTimeString():""}))},ampm:!1})}),I.native.astro?(0,X.jsxs)(B.FormControl,{variant:"standard",style:(0,J.Z)((0,J.Z)({},te.width60),{},{width:95}),children:[(0,X.jsx)(B.InputLabel,{children:e.t("Offset")}),(0,X.jsx)(B.Select,{value:I.native.offset||0,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.native.offset=e.target.value}))},children:[{label:"none",value:0},{label:"5 min",value:5},{label:"10 min",value:10},{label:"15 min",value:15},{label:"20 min",value:20},{label:"30 min",value:30},{label:"45 min",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120},{label:"2.5 hours",value:150},{label:"3 hours",value:180},{label:"4 hours",value:240},{label:"5 min",value:-5},{label:"10 min",value:-10},{label:"15 min",value:-15},{label:"20 min",value:-20},{label:"30 min",value:-30},{label:"45 min",value:-45},{label:"1 hour",value:-60},{label:"1.5 hours",value:-90},{label:"2 hours",value:-120},{label:"2.5 hours",value:-150},{label:"3 hours",value:-180},{label:"4 hours",value:-240}].map((function(t){return(0,X.jsx)(B.MenuItem,{value:t.value,children:t.value<0?"- ".concat(e.t(t.label)):e.t(t.label)},t.value)}))})]}):null,e.isSimulation&&(0,X.jsx)(B.TextField,{style:te.randomTime,label:e.t("Time random offset"),value:I.native.timeRandomOffset||0,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.native.timeRandomOffset=parseInt(e.target.value)}))},variant:"standard",slotProps:{input:{endAdornment:(0,X.jsx)(B.InputAdornment,{position:"end",children:e.t("ms")})}}})]}),I.native.astro?(0,X.jsxs)("div",{style:te.field,children:[e.t("Today %s is at %s.",e.t(I.native.astro),Ie),"\xa0",I.native.offset?e.t("With offset at %s.",_e):null]}):null,(0,X.jsxs)("div",{style:te.field,children:[!e.isSimulation&&(0,X.jsxs)(B.FormControl,{variant:"standard",style:te.narrowText2,children:[(0,X.jsx)(B.InputLabel,{children:e.t("Event type")}),(0,X.jsx)(B.Select,{value:I.native.type||"",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(t){return pe((function(n){n.common.name===e.t(n.native.type)&&(n.common.name=e.t(t.target.value)),n.native.type=t.target.value}))},renderValue:function(t){return e.t(t)},children:["single","double","toggle"].map((function(t){return(0,X.jsx)(B.MenuItem,{value:t,children:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{children:e.t(t)}),(0,X.jsx)("div",{style:te.typeDescription,children:e.t(ee[t])})]})},t)}))})]}),"single"!==I.native.type&&(0,X.jsx)(B.TextField,{label:e.t("Duration"),value:le,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return oe(e.target.value)},variant:"standard",style:te.narrowText,slotProps:{input:{endAdornment:(0,X.jsx)(B.InputAdornment,{position:"end",children:e.t("minutes")})}}})]}),(0,X.jsx)("div",{style:te.field,children:(0,X.jsxs)("div",{style:te.selectId,children:[(0,X.jsx)(h.Icon,{src:Le||"",style:{width:32,height:32}}),(0,X.jsx)(B.TextField,{label:e.t("Object ID"),value:I.native.oid||"",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.native.oid=e.target.value}))},variant:"standard",helperText:(Be=(null===A||void 0===A?void 0:A.common.name)||"",Ae=e.language,Be&&"object"===typeof Be?Be[Ae]||Be.en:Be),fullWidth:!0}),(0,X.jsx)(B.Button,{disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onClick:function(){return D(!0)},children:"..."})]})}),(0,X.jsxs)("div",{style:te.field,children:[(Ee="startValue",Me="toggle"===I.native.type?"First value":"single"===I.native.type?"Desired value":"Start value",A?"boolean"===A.common.type?("startValue"===Ee&&"boolean"!==typeof I.native[Ee]&&setTimeout((function(){return pe((function(e){return e.native[Ee]=!!e.native[Ee]}))}),100),(0,X.jsx)(B.FormControlLabel,{style:te.narrowText2,control:(0,X.jsx)(B.Checkbox,{checked:!!I.native[Ee],disabled:e.readOnly,onChange:function(e){return pe((function(t){return t.native[Ee]=e.target.checked}))}}),label:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{children:e.t(Me)}),(0,X.jsx)("div",{style:{fontSize:10,fontStyle:"italic"},children:e.t("Checked means ON, unchecked means OFF")})]})})):A.common.states?(0,X.jsxs)(B.FormControl,{style:te.narrowText2,variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t(Me)}),(0,X.jsx)(B.Select,{value:I.native[Ee]||"",disabled:e.readOnly,onChange:function(e){return pe((function(t){return t.native[Ee]=e.target.value}))},children:Object.keys(A.common.states).map((function(e){return(0,X.jsx)(B.MenuItem,{value:e,children:A.common.states[e]},e)}))})]}):(0,X.jsx)(B.TextField,{style:te.narrowText2,label:e.t(Me),value:I.native[Ee]||"",disabled:e.readOnly,onChange:function(e){return pe((function(t){return t.native[Ee]=e.target.value}))},variant:"standard"}):null),"double"===I.native.type&&(A?"boolean"===A.common.type?("boolean"!==typeof de&&setTimeout((function(){return ue(!!de)}),100),(0,X.jsx)(B.FormControlLabel,{style:te.narrowText2,control:(0,X.jsx)(B.Checkbox,{checked:!!de,disabled:e.readOnly,onChange:function(e){return ue(e.target.checked)}}),label:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{children:e.t("End value")}),(0,X.jsx)("div",{style:{fontSize:10,fontStyle:"italic"},children:e.t("Checked means ON, unchecked means OFF")})]})})):A.common.states?(0,X.jsxs)(B.FormControl,{style:te.narrowText2,variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t("End value")}),(0,X.jsx)(B.Select,{value:de||"",disabled:e.readOnly,onChange:function(e){return ue(e.target.value)},children:Object.keys(A.common.states).map((function(e){return(0,X.jsx)(B.MenuItem,{value:e,children:A.common.states[e]},e)}))})]}):(0,X.jsx)(B.TextField,{label:e.t("End value"),value:de||"",disabled:e.readOnly,onChange:function(e){return ue(e.target.value)},variant:"standard",style:te.narrowText2}):null)]}),(0,X.jsxs)("div",{style:te.field,children:[!e.isSimulation&&(0,X.jsxs)(B.FormControl,{variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t("Period")}),(0,X.jsx)(B.Select,{value:be||"once",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(t){t.target.value!==I.native.cron&&pe((function(n){if("once"===t.target.value)delete n.native.cron,n.native.start=G(ge,"date",e.serverTimeZone);else if("daily"===t.target.value){delete n.native.start;var a=N("0 0 ? * 0-6"),i=G(ge,"cron",e.serverTimeZone);a.hours=i.hours,a.minutes=i.minutes,n.native.cron=R(a)}else if("monthly"===t.target.value){var r,l=n.native.start;l?(r=N("0 0 ".concat(new Date(l).getDate()," ").concat(new Date(l).getMonth()+1," *")),delete n.native.start):r=N("0 0 1-31 1-12 *");var o=G(ge,"cron",e.serverTimeZone);r.hours=o.hours,r.minutes=o.minutes,n.native.cron=R(r)}}))},children:["once","daily","monthly"].map((function(t){return(0,X.jsx)(B.MenuItem,{value:t,children:e.t(t)},t)}))})]}),"daily"===be&&(!e.isSimulation||"week"===e.simulation.native.interval)&&(0,X.jsxs)("table",{style:(0,J.Z)((0,J.Z)({},te.dayTable),{},{marginLeft:e.isSimulation?0:void 0}),children:[(0,X.jsx)("thead",{children:(0,X.jsx)("tr",{children:Ze.map((function(e){return(0,X.jsx)("td",{style:te.tableCell,children:z()().day(e).format("ddd")},e)}))})}),(0,X.jsx)("tbody",{children:(0,X.jsx)("tr",{children:Ze.map((function(t){var n;return(0,X.jsx)("td",{children:(0,X.jsx)(B.Checkbox,{"aria-label":"day",checked:(null===ye||void 0===ye||null===(n=ye.dows)||void 0===n?void 0:n.includes(t))||!1,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(n){var a=N(n.native.cron);e.target.checked?a.dows.push(t):a.dows=a.dows.filter((function(e){return e!==t})),n.native.cron=R(a)}))},size:"small"})},t)}))})})]})]}),"monthly"===be&&(0,X.jsxs)("div",{style:te.field,children:[(0,X.jsxs)("table",{children:[(0,X.jsx)("thead",{children:(0,X.jsx)("tr",{children:new Array(12).fill(null).map((function(e,t){return(0,X.jsx)("td",{style:te.tableCell,children:z()().month(t).format("MMM")},t)}))})}),(0,X.jsx)("tbody",{children:(0,X.jsx)("tr",{children:new Array(12).fill(null).map((function(t,n){var a;return(0,X.jsx)("td",{children:(0,X.jsx)(B.Checkbox,{"aria-label":"month",checked:(null===ye||void 0===ye||null===(a=ye.months)||void 0===a?void 0:a.includes(n+1))||!1,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){var a=N(t.native.cron);e.target.checked?a.months.push(n+1):(a.months=a.months.filter((function(e){return e!==n+1})),a.months.length||(a.months=[1])),t.native.cron=R(a)}))},size:"small"})},n)}))})})]}),(0,X.jsxs)("table",{children:[(0,X.jsx)("thead",{children:(0,X.jsx)(B.Box,{component:"tr",sx:te.days,children:new Array(12).fill(null).map((function(e,t){return(0,X.jsx)("td",{style:te.tableCell,children:t+1},t)}))})}),(0,X.jsxs)("tbody",{children:[(0,X.jsx)(B.Box,{component:"tr",sx:te.days,children:new Array(12).fill(null).map((function(t,n){var a;return(0,X.jsx)("td",{children:(0,X.jsx)(B.Checkbox,{"aria-label":"day",checked:(null===ye||void 0===ye||null===(a=ye.dates)||void 0===a?void 0:a.includes(n+1))||!1,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){var a=N(t.native.cron);e.target.checked?(a.dates.push(n+1),a.dates=a.dates.filter((function(e){return e}))):(a.dates=a.dates.filter((function(e){return e!==n+1})),a.dates.length||(a.dates=[1])),t.native.cron=R(a)}))},size:"small"})},n)}))}),(0,X.jsx)(B.Box,{component:"tr",sx:te.days,children:new Array(12).fill(null).map((function(e,t){return(0,X.jsx)("td",{style:te.tableCell,children:t+13},t)}))}),(0,X.jsx)(B.Box,{component:"tr",sx:te.days,children:new Array(12).fill(null).map((function(t,n){var a;return(0,X.jsx)("td",{children:(0,X.jsx)(B.Checkbox,{"aria-label":"day",checked:(null===ye||void 0===ye||null===(a=ye.dates)||void 0===a?void 0:a.includes(n+13))||!1,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){pe((function(t){var a=N(t.native.cron);e.target.checked?(a.dates.push(n+13),a.dates=a.dates.filter((function(e){return e}))):(a.dates=a.dates.filter((function(e){return e!==n+13})),a.dates.length||(a.dates=[1])),t.native.cron=R(a)}))},size:"small"})},n)}))}),(0,X.jsxs)(B.Box,{component:"tr",sx:te.days,children:[new Array(11).fill(null).map((function(e,t){return(0,X.jsx)("td",{style:te.tableCell,children:we<t+25?null:t+25},t)})),(0,X.jsx)("td",{style:te.tableCell,children:e.t("All")})]}),(0,X.jsxs)(B.Box,{component:"tr",sx:te.days,children:[new Array(11).fill(null).map((function(t,n){var a;return(0,X.jsx)("td",{children:we<n+25?null:(0,X.jsx)(B.Checkbox,{"aria-label":"day",checked:(null===ye||void 0===ye||null===(a=ye.dates)||void 0===a?void 0:a.includes(n+25))||!1,disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){var a=N(t.native.cron);e.target.checked?(a.dates.push(n+25),a.dates=a.dates.filter((function(e){return e}))):(a.dates=a.dates.filter((function(e){return e!==n+25})),a.dates.length||(a.dates=[1])),t.native.cron=R(a)}))},size:"small"})},n)})),(0,X.jsx)("td",{children:(0,X.jsx)(B.Checkbox,{"aria-label":"all",checked:(null===ye||void 0===ye||null===(x=ye.dates)||void 0===x?void 0:x.length)===we,indeterminate:(null===ye||void 0===ye||null===(y=ye.dates)||void 0===y?void 0:y.length)!==we&&!(null!==ye&&void 0!==ye&&ye.dates.includes(0)),disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(){return pe((function(e){var t,n=N(e.native.cron);if((null===n||void 0===n||null===(t=n.dates)||void 0===t?void 0:t.length)!==we){n.dates=[];for(var a=0;a<we;a++)n.dates.push(a+1)}else n.dates=[1];e.native.cron=R(n)}))},size:"small"})})]})]})]})]}),(0,X.jsx)("div",{style:te.field,children:(0,X.jsx)(B.TextField,{label:e.t("Description"),value:(null===I||void 0===I?void 0:I.common.name)||"",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.common.name=e.target.value}))},variant:"standard",fullWidth:!0})}),(0,X.jsx)("div",{style:te.narrowColor,children:(0,X.jsx)(h.ColorPicker,{value:I.common.color||I.native.color||"",disabled:e.readOnly||!(null!==I&&void 0!==I&&I.common.enabled),onChange:function(e){return pe((function(t){return t.common.color=e}))},name:e.t("Color")})})]}),(0,X.jsxs)(B.DialogActions,{children:[e.readOnly?null:(0,X.jsx)(B.Button,{variant:"contained",color:"secondary",startIcon:(0,X.jsx)(Q.Delete,{}),onClick:function(){return U(!0)},children:e.t("Delete")}),e.readOnly||e.widget?null:(0,X.jsx)("div",{style:{flex:1}}),e.readOnly?null:(0,X.jsx)(B.Button,{variant:"contained",color:"primary",disabled:!De||"monthly"===be&&(!(null!==(b=ye.dates)&&void 0!==b&&b.length)||ye.dates.includes(0)||!(null!==(w=ye.months)&&void 0!==w&&w.length)),startIcon:(0,X.jsx)(Q.Save,{}),onClick:(0,i.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"single"===I.native.type?I.native.intervals&&delete I.native.intervals:"double"===I.native.type?(I.native.intervals=I.native.intervals||[],I.native.intervals[0]=I.native.intervals[0]||{},I.native.intervals[0].timeOffset=6e4*(parseFloat(le)||1),I.native.intervals[0].value=de):"toggle"===I.native.type&&(I.native.intervals=I.native.intervals||[],I.native.intervals[0]=I.native.intervals[0]||{},I.native.intervals[0].timeOffset=6e4*(parseFloat(le)||1)),t.next=3,e.setEvent(I._id,I);case 3:e.updateEvents(),e.onClose();case 5:case"end":return t.stop()}}),t)}))),children:e.t("Save")}),(0,X.jsx)(B.Button,{variant:"contained",color:"grey",startIcon:(0,X.jsx)(Q.Cancel,{}),onClick:e.onClose,children:e.readOnly||!De?e.t("ra_Close"):e.t("ra_Cancel")})]}),V&&(0,X.jsx)(h.Confirm,{fullWidth:!1,title:e.t("Delete event"),text:e.t("Event will be deleted. Confirm?"),suppressQuestionMinutes:5,dialogName:"deleteConfirmDialog",ok:e.t("Delete"),onClose:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=11;break}return t.prev=1,t.next=4,e.deleteEvent(I._id);case 4:e.updateEvents(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),window.alert("Cannot delete event: ".concat(t.t0));case 10:e.onClose();case 11:U(!1);case 12:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e){return t.apply(this,arguments)}}()})]}):null},re=[{type:"single",name:"Single event"},{type:"double",name:"Double event"},{type:"toggle",name:"Toggle event"}],le=[1,2,3,5,10,15,20,30,60],oe=function(e){var t=e.type,n=e.t,a=e.color,i=(0,u.useRef)(null);return(0,u.useEffect)((function(){var e=new w._l(i.current,{eventData:function(){return{id:t.type,title:n(t.name),create:!0,extendedProps:{type:t.type}}}});return function(){e.destroy()}}),[]),(0,X.jsx)("div",{style:{backgroundColor:a||"rgb(58, 135, 178)",color:"white",cursor:"pointer",fontSize:"14px",padding:"3px 4px 6px 8px",borderRadius:4,marginBottom:20},ref:i,children:n(t.name)})},se={container:{display:"flex",width:"100%",flex:1},leftBlock:{width:200},calendarBlock:{flex:1,display:"flex"},calendar:{marginRight:20,width:"100%"},leftPaper:{margin:20},leftContent:{display:"flex",flexDirection:"column",padding:"20px 10px"},hr:{width:"100%"},leftMargin:{marginLeft:4}};function ce(e){if(e)return e.startsWith("#")?4===e.length?"#".concat(e[1]).concat(e[1]).concat(e[2]).concat(e[2]).concat(e[3]).concat(e[3],"50"):"".concat(e.substring(0,7),"50"):e.startsWith("rgb(")?e.replace("rgb(","rgba(").replace(")",", 0.3)"):e.startsWith("rgba(")?e.replace(/,\s?[.\d]+\)$/,", 0.3)"):e}function de(e){return e.date.second?"".concat(e.date.hour,":").concat(e.date.minute.toString().padStart(2,"0"),":").concat(e.date.second.toString().padStart(2,"0")):"".concat(e.date.hour,":").concat(e.date.minute.toString().padStart(2,"0"))}var ue=function(e){var t,n,r,l=(0,u.useState)(null),o=(0,p.Z)(l,2),s=o[0],c=o[1],d=(0,u.useState)(e.dayStep||parseInt(window.localStorage.getItem("calendarStep"),10)||30),v=(0,p.Z)(d,2),m=v[0],f=v[1],L=e.storageName||"calendar",W=(0,u.useRef)(null),P=(0,u.useRef)(null),J=(0,u.useRef)(null),V=(0,u.useRef)(null),z=(0,u.useRef)(null),U=(0,u.useState)({start:null,end:null}),Y=(0,p.Z)(U,2),$=Y[0],K=Y[1],q=(!e.widget&&window.localStorage.getItem("".concat(L,"Start")),new Date),Q=e.viewMode||window.localStorage.getItem("".concat(L,"View"))||"dayGridMonth";e.isSimulation&&(q=new Date,Q="day"===(null===(r=e.simulation)||void 0===r?void 0:r.native.interval)?"timeGridDay":"timeGridWeek");var ee=re;e.isSimulation&&(ee=ee.filter((function(e){return"single"===e.type})));var te=(0,u.useMemo)((function(){var t=[];return e.events.forEach((function(n){var a;if(n){var i=null!==(a=n.native)&&void 0!==a&&a.intervals&&n.native.intervals[0]&&n.native.intervals[0].timeOffset?n.native.intervals[0].timeOffset:30;n.common.color=n.common.color||"#3a87b2";var r=n.common.enabled?n.common.color:ce(n.common.color),l=h.Utils.invertColor(n.common.color,!0);n.common.enabled||(l=ce(l));var o=n.common.name;if(n.native.oid){var s,c,d=n.native.startValue;"boolean"===typeof d?d=d?h.I18n.t("ON"):h.I18n.t("OFF"):n.native.states&&n.native.states[d]&&(d=n.native.states[d]);var u,v,m,f,p=null===(s=n.native.intervals)||void 0===s||null===(c=s[0])||void 0===c?void 0:c.value;if("boolean"===typeof p?p=p?h.I18n.t("ON"):h.I18n.t("OFF"):n.native.states&&n.native.states[p]&&(p=n.native.states[p]),o="".concat(n.common.name," \u2192 ").concat(d),"double"===n.native.type)o+=" \u2192 ".concat(((null===(u=n.native.intervals)||void 0===u||null===(v=u[0])||void 0===v?void 0:v.timeOffset)||0)/1e3/60," ").concat(h.I18n.t("min"),". \u2192 ").concat(p);if("toggle"===n.native.type)o+=" \u2192 ".concat(((null===(m=n.native.intervals)||void 0===m||null===(f=m[0])||void 0===f?void 0:f.timeOffset)||0)/1e3/60," ").concat(h.I18n.t("min"),". \u2192 ").concat(h.I18n.t("initial"))}if(n.native.cron){var g=H(n.native.cron,"cron",e.serverTimeZone),x=N(n.native.cron);if(g.setFullYear((new Date).getFullYear()-1),Array.isArray(x.months))new A.Ci({dtstart:g,until:$.end||new Date,freq:A.Ci.MONTHLY,bymonth:x.months,bymonthday:x.dates}).between($.start||new Date,$.end||new Date).forEach((function(a){var i=n.native.astro?F().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:a;n.native.astro&&n.native.offset&&i.setMinutes(i.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:i.getSeconds()},title:o,backgroundColor:r,textColor:l,start:i,allDay:!1,display:"block"})}));else if(Array.isArray(x.dows)){new A.Ci({dtstart:g,until:$.end||new Date,freq:A.Ci.WEEKLY,byweekday:x.dows.map((function(e){return 0===e?6:e-1}))}).between($.start||new Date,$.end||new Date).forEach((function(a){var i=n.native.astro?F().getTimes(a,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:a;n.native.astro&&n.native.offset&&i.setMinutes(i.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:i.getSeconds()},title:o,backgroundColor:r,textColor:l,start:i,allDay:!1,display:"block"})}))}else t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:0},title:o,backgroundColor:r,textColor:l,icon:n.common.icon})}else{var y=n.native.astro?F().getTimes(new Date,e.systemConfig.latitude,e.systemConfig.longitude)[n.native.astro]:n.native.start;n.native.astro&&n.native.offset&&y.setMinutes(y.getMinutes()+n.native.offset),t.push({extendedProps:{eventId:n._id,icon:n.common.icon,type:n.native.type,seconds:0},title:o,display:"block",backgroundColor:r,textColor:l,start:H(y,"date",e.serverTimeZone),end:H(new Date(new Date(y).getTime()+i),"date",e.serverTimeZone)})}}})),t}),[e.events,e.serverTimeZone,e.systemConfig.latitude,e.systemConfig.longitude,$.end,$.start]);if((0,u.useEffect)((function(){if(e.widget){setTimeout((function e(){var t,n=null===(t=W.current)||void 0===t?void 0:t.getApi();n&&(console.log("Scroll to now"),n.scrollToTime((new Date).getTime())),J.current?V.current=null:V.current=setTimeout((function(){return e}),3e5)}),1e3)}return function(){V.current&&clearTimeout(V.current),V.current=null,J.current&&clearTimeout(J.current),J.current=null}}),[]),(0,u.useEffect)((function(){z.current=null,setTimeout((function(){var e,t=new Date;null===(e=W.current)||void 0===e||e.getApi().scrollToTime("".concat(t.getHours().toString().padStart(2,"0"),":").concat((m>t.getMinutes()?0:t.getMinutes()-m).toString().padStart(2,"0"),":00"))}),300)}),[e.calendarPrefix,e.simulationId,m]),(0,u.useEffect)((function(){if(e.isSimulation){var t,n,a=null===(t=W.current)||void 0===t?void 0:t.getApi();null===a||void 0===a||a.changeView("day"===(null===(n=e.simulation)||void 0===n?void 0:n.native.interval)?"timeGridDay":"timeGridWeek",new Date)}}),[e.isSimulation,null===(t=e.simulation)||void 0===t?void 0:t.native.interval]),e.isSimulation&&!e.simulation)return null;var ne=z.current?void 0:new Date,ae=ne?"".concat(ne.getHours().toString().padStart(2,"0"),":").concat((m>ne.getMinutes()?0:ne.getMinutes()-m).toString().padStart(2,"0"),":00"):void 0;console.log("SCROLL TIME: ".concat(ae));var ue=null===(n=W.current)||void 0===n?void 0:n.getApi().view.type;return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)("style",{children:"dark"===e.theme.palette.mode?"\n:root {\n    --fc-neutral-bg-color: hsla(0,0%,12%);\n    --fc-list-event-hover-bg-color: hsla(0,0%,12%);\n}\n.fc-col-header-cell {\n    background-color: #1e1e1e;\n}                \n":"\n.fc-col-header-cell {\n    background-color: #EEEEEE;\n}\n"}),s?(0,X.jsx)(ie,{systemConfig:e.systemConfig,widget:e.widget,event:e.events.find((function(e){return(null===e||void 0===e?void 0:e._id)===s})),onClose:function(){c(null);var e=z.current?new Date(z.current):new Date,t="".concat(e.getHours().toString().padStart(2,"0"),":").concat((m>e.getMinutes()?0:e.getMinutes()-m).toString().padStart(2,"0"),":00");setTimeout((function(){var e;return null===(e=W.current)||void 0===e?void 0:e.getApi().scrollToTime(t)}),200)},socket:e.socket,updateEvents:e.updateEvents,setEvent:e.setEvent,deleteEvent:function(t){c(null),e.deleteEvent(t)},serverTimeZone:e.serverTimeZone,readOnly:e.readOnly,t:e.t,theme:e.theme,language:e.language,isSimulation:e.isSimulation,simulationId:e.simulationId,simulation:e.simulation}):null,(0,X.jsxs)("div",{style:se.container,children:[!e.hideLeftBlock&&!e.readOnly&&(0,X.jsxs)("div",{style:se.leftBlock,children:[(0,X.jsx)(B.Paper,{elevation:4,style:se.leftPaper,children:(0,X.jsxs)("div",{style:se.leftContent,children:[(0,X.jsx)("h4",{children:e.t("Events")}),ee.map((function(t,n){var a,i;return(0,X.jsx)(oe,{t:e.t,type:t,name:e.t(t.name),index:n,color:e.isSimulation?null===(a=e.simulation)||void 0===a||null===(i=a.common)||void 0===i?void 0:i.color:void 0},t.type)})),e.hideLeftBlockHint?null:(0,X.jsx)("div",{children:e.t("Drag and drop the events above to create a new one.")}),e.hideLeftBlockHint?null:(0,X.jsx)("hr",{style:se.hr}),e.hideLeftBlockHint?null:(0,X.jsx)("div",{children:e.t("Use ALT by dragging it to copy the events.")}),e.hideLeftBlockHint?null:(0,X.jsx)("hr",{style:se.hr}),e.hideLeftBlockHint?null:(0,X.jsx)("div",{children:e.t("Use double click on calendar to add new events.")}),e.hideLeftBlockHint?null:(0,X.jsx)("hr",{style:se.hr}),e.hideLeftBlockHint||"dayGridMonth"===ue||"listMonth"===ue?null:(0,X.jsxs)(B.FormControl,{fullWidth:!0,variant:"standard",children:[(0,X.jsx)(B.InputLabel,{children:e.t("Zoom")}),(0,X.jsx)(B.Select,{value:m,onChange:function(e){var t,n;if(null!==(t=W.current)&&void 0!==t&&null!==(n=t.elRef)&&void 0!==n&&n.current){var a=function(e){for(var t=e.getBoundingClientRect(),n=e.getElementsByClassName("fc-timegrid-slot"),a=0;a<n.length;a++)if(n[a].getBoundingClientRect().top>t.top+100)return n[a].dataset.time;return null}(W.current.elRef.current);a&&setTimeout((function(){var e;return null===(e=W.current)||void 0===e?void 0:e.getApi().scrollToTime(a)}),300)}window.localStorage.setItem("calendarStep",e.target.value.toString()),f(e.target.value)},children:le.map((function(t){return(0,X.jsxs)(B.MenuItem,{value:t,children:[t,(0,X.jsx)("span",{style:se.leftMargin,children:e.t("min")})]},t)}))})]})]})}),e.button]}),(0,X.jsx)("div",{style:se.calendarBlock,children:(0,X.jsx)("div",{style:se.calendar,children:(0,X.jsx)(x.Z,{ref:W,plugins:[k.Z,y.Z,b.Z,w.ZP,j.Z],weekends:!e.hideWeekends,headerToolbar:!e.hideTopBlock&&{left:e.hideTopBlockButtons||e.isSimulation?"":"prev,next today",center:e.isSimulation?"":"title",right:e.hideTopBlockButtons||e.isSimulation?"":"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},eventTimeFormat:e.isSimulation?de:void 0,scrollTime:e.isSimulation&&"record"===e.simulationState?ae:void 0,slotDuration:"00:".concat(m.toString().padStart(2,"0"),":00"),eventMinHeight:20,initialView:Q,initialDate:q,editable:!e.readOnly,selectable:!0,selectMirror:!0,nowIndicator:!0,dayMaxEvents:!0,eventResizableFromStart:!e.isSimulation,eventDurationEditable:!e.isSimulation,defaultTimedEventDuration:"00:".concat(m.toString().padStart(2,"0")),events:te,height:"calc(100% - 20px)",locales:[C.Z,S.Z,T.Z,D.Z,Z.Z,O.Z,I.Z,_.Z,E.Z,M.Z],locale:e.language,datesSet:function(t){var n,a;t.start.toString()===(null===(n=$.start)||void 0===n?void 0:n.toString())&&t.end.toString()===(null===(a=$.end)||void 0===a?void 0:a.toString())||(z.current=null,K({start:t.start,end:t.end})),e.widget?(V.current&&clearTimeout(V.current),V.current=null,J.current&&clearTimeout(J.current),J.current=setTimeout((function(){J.current=null;!function e(){var t,n=null===(t=W.current)||void 0===t?void 0:t.getApi();null===n||void 0===n||n.scrollToTime((new Date).getTime()),J.current?V.current=null:V.current=setTimeout((function(){return e}),3e5)}()}),6e4)):window.localStorage.setItem("".concat(L,"View"),t.view.type)},eventClick:function(e){z.current=new Date(e.event.start).getTime(),c(e.event.extendedProps.eventId)},eventResize:function(t){var n;z.current=new Date(t.event.start).getTime();var a=e.events.find((function(e){return e._id===t.event.extendedProps.eventId}));if(null!==(n=a.native.intervals)&&void 0!==n&&n[0].timeOffset){var i=JSON.parse(JSON.stringify(a));i.native.intervals[0].timeOffset+=t.endDelta.milliseconds,e.setEvent(i._id,i),e.updateEvents()}else t.revert()},eventDrop:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r,l,o,s,c,d,u,v;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(z.current=new Date(n.event.start).getTime(),null===(r=e.events.find((function(e){return e._id===n.event.extendedProps.eventId})))||void 0===r||null===(i=r.native)||void 0===i||!i.cron){t.next=19;break}return l=JSON.parse(JSON.stringify(r)),n.jsEvent.altKey&&(l._id="".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,g.Z)())),o=N(l.native.cron),s=G(n.event.start,"cron",e.serverTimeZone),c=new Date(n.event.start).getDate(),d=new Date(n.event.start).getMonth()+1,u=new Date(n.event.start).getDay(),Array.isArray(o.months)?(n.delta.days&&(o.dates=[c]),o.months.includes(d)||(o.months=[d]),o.dows="*"):Array.isArray(o.dows)&&(o.months="*",o.dates="*",n.delta.days&&(o.dows=[u])),o.hours=s.hours,o.minutes=s.minutes,l.native.cron=R(o),t.next=16,e.setEvent(l._id,l);case 16:e.updateEvents(),t.next=25;break;case 19:return v=JSON.parse(JSON.stringify(r)),n.jsEvent.altKey&&(v._id="".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,g.Z)())),v.native.start=G(n.event.start,"date",e.serverTimeZone),t.next=24,e.setEvent(v._id,v);case 24:e.updateEvents();case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),eventReceive:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r,l;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={_id:"".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,g.Z)()),common:{name:n.event.title,enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:G(n.event.start,"date",e.serverTimeZone),type:n.event.extendedProps.type,oid:"",startValue:""},type:"schedule"},(r=new Date(i.native.start)).getMinutes()||r.getHours()||(r.setHours(12),i.native.start=G(r,"date",e.serverTimeZone)),"single"!==n.event.extendedProps.type&&(i.native.intervals=[{timeOffset:18e5}]),e.isSimulation&&(i.common.color=e.simulation.common.color||i.common.color,delete i.native.start,(l=G(n.event.start,"cron",e.serverTimeZone)).dows="day"===e.simulation.native.interval?[0,1,2,3,4,5,6]:[n.event.start.getDay()],l.dates=["?"],l.months=["*"],i.native.cron=R(l),i.native.record={states:[],enums:[],start:null,end:null}),z.current=new Date(n.event.start).getTime(),t.next=8,e.setEvent(i._id,i);case 8:e.updateEvents(),setTimeout((function(){return c(i._id)}),100);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),eventDidMount:function(e){var t=e.event.extendedProps.icon;if(t){var n=window.document.createElement("img");t.startsWith("data:image")||t.startsWith("http")||t.startsWith("/")||(t="../../".concat(t)),n.setAttribute("src",t),n.className="icon",n.style.width="20px",n.style.height="20px";var a=e.el.getElementsByClassName("fc-event-title-container");if(a.length){a[0].prepend(n);var i=a[0].getElementsByClassName("fc-event-title");i.length&&(i[0].style.marginLeft="23px")}}},select:function(){var t=(0,i.Z)((0,a.Z)().mark((function t(n){var i,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.view.calendar.unselect(),!e.readOnly){t.next=4;break}return t.abrupt("return");case 4:if(i=n.end.getTime()-n.start.getTime(),P.current&&!(Date.now()-P.current>500)||18e5!==i){t.next=8;break}return P.current=Date.now(),t.abrupt("return");case 8:return r={_id:"".concat(e.calendarPrefix||e.simulationId,".event-").concat((0,g.Z)()),common:{name:e.t("Single event"),enabled:!0,color:"#3A87AD"},native:{id:Date.now(),start:G(n.date||n.start,"date",e.serverTimeZone),intervals:n.end&&!e.isSimulation?[{value:"",timeOffset:n.end.getTime()-n.start.getTime()}]:void 0,type:n.end&&!e.isSimulation?"double":"single",oid:"",startValue:""},type:"schedule"},e.isSimulation&&(r.common.color=e.simulation.common.color||r.common.color),z.current=new Date(r.native.start).getTime(),t.next=13,e.setEvent(r._id,r);case 13:return t.next=15,e.updateEvents();case 15:setTimeout((function(){return c(r._id)}),100);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})})]})]})},ve=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).state={list:[{value:"_",label:e.t("default")}]},a}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.instance&&this.props.socket.getObjectViewSystem("folder","fullcalendar.".concat(this.props.instance,".Calendars."),"fullcalendar.".concat(this.props.instance,".Calendars.\u9999")).then((function(t){var a=Object.keys(t).map((function(e){return{value:e,label:n.getText(t[e].common.name)}}));a.unshift({value:"_",label:e.props.t("default")}),e.setState({list:a})}))}},{key:"render",value:function(){var e=this;return(0,X.jsx)(B.Select,{variant:"standard",fullWidth:!0,value:this.props.value||"_",onChange:function(t){return e.props.onChange("_"===t.target.value?"":t.target.value)},children:this.state.list.map((function(e){return(0,X.jsx)(B.MenuItem,{value:e.value,children:e.label},e.value)}))})}}],[{key:"getText",value:function(e){return"object"===typeof e?e[h.I18n.getLanguage()]||e.en:e}}]),n}(v().Component),me=ve,fe={content:{display:"flex",width:"100%",height:"100%",overflow:"auto"}},he=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var l;return(0,r.Z)(this,n),(l=t.call(this,e)).onEventsChanged=function(e,t){if(l.state.rxData.calendar||!(e.split(".").length>3)){var n=JSON.parse(JSON.stringify(l.state.events)),a=n.findIndex((function(t){return t._id===e}));-1!==a?t?n[a]=t:n.splice(a,1):n.push(t),l.setState({events:n})}},l.updateEvents=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,i,r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.state.rxData.calendar?"".concat(l.state.rxData.calendar,".*"):l.state.rxData.instance||0===l.state.rxData.instance?"fullcalendar.".concat(l.state.rxData.instance,".*"):"",l.subscribed===t){e.next=11;break}if(e.t0=l.subscribed,!e.t0){e.next=6;break}return e.next=6,l.props.context.socket.unsubscribeObject(l.subscribed,l.onEventsChanged);case 6:if(l.subscribed=t,e.t1=l.subscribed,!e.t1){e.next=11;break}return e.next=11,l.props.context.socket.subscribeObject(l.subscribed,l.onEventsChanged);case 11:if(l.subscribed){e.next=14;break}return l.setState({events:[]}),e.abrupt("return");case 14:return e.next=16,l.props.context.socket.getObjectViewCustom("schedule","schedule",l.state.rxData.calendar?"".concat(l.state.rxData.calendar,"."):"fullcalendar.".concat(l.state.rxData.instance,"."),l.state.rxData.calendar?"".concat(l.state.rxData.calendar,".\u9999"):"fullcalendar.".concat(l.state.rxData.instance,".\u9999"));case 16:return n=e.sent,i=0,e.prev=18,e.next=21,l.props.context.socket.getState("fullcalendar.".concat(l.state.rxData.instance,".info.timeZone"));case 21:r=e.sent,i=(null===r||void 0===r?void 0:r.val)||0,e.next=27;break;case 25:e.prev=25,e.t2=e.catch(18);case 27:o=Object.values(n),l.state.rxData.calendar||(o=o.filter((function(e){return e._id.split(".").length<=3}))),l.setState({events:o,serverTimeZone:i});case 30:case"end":return e.stop()}}),e,null,[[18,25]])}))),l.changeEvents=function(e){l.setState({events:e})},l.setEvent=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.props.context.socket.setObject(t,n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l.deleteEvent=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.props.context.socket.delObject(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l.widgetRef=v().createRef(),l}return(0,l.Z)(n,[{key:"getWidgetInfo",value:function(){return n.getWidgetInfo()}},{key:"componentDidMount",value:function(){(0,o.Z)((0,s.Z)(n.prototype),"componentDidMount",this).call(this),this.updateEvents()}},{key:"componentWillUnmount",value:function(){this.subscribed&&this.props.context.socket.unsubscribeObject(this.subscribed,this.onEventsChanged),this.subscribed=null,(0,o.Z)((0,s.Z)(n.prototype),"componentWillUnmount",this).call(this)}},{key:"onRxDataChanged",value:function(){this.updateEvents()}},{key:"renderWidgetBody",value:function(e){var t,a,i;((0,o.Z)((0,s.Z)(n.prototype),"renderWidgetBody",this).call(this,e),null!==(t=this.widgetRef.current)&&void 0!==t&&t.offsetWidth||this.forceUpdate(),this.state.rxData.instance||0===this.state.rxData.instance)?a=(0,X.jsx)("div",{style:fe.content,ref:this.widgetRef,children:(0,X.jsx)(ue,{widget:!0,systemConfig:this.props.systemConfig?this.props.systemConfig.common:null===(i=this.props.context.systemConfig)||void 0===i?void 0:i.common,events:this.state.events||[],socket:this.props.context.socket,instance:this.state.rxData.instance,calendarPrefix:"fullcalendar.".concat(this.state.rxData.instance),changeEvents:this.changeEvents,updateEvents:this.updateEvents,setEvent:this.setEvent,deleteEvent:this.deleteEvent,serverTimeZone:this.state.serverTimeZone||0,readOnly:this.state.rxData.readOnly||!1,hideLeftBlock:this.state.rxData.hideLeftBlock||!1,hideTopBlock:this.state.rxData.hideTopBlock||!1,hideLeftBlockHint:this.state.rxData.hideLeftBlockHint||!1,hideTopBlockButtons:this.state.rxData.hideTopBlockButtons||!1,viewMode:this.state.rxData.viewMode||null,storageName:"fc_".concat(this.props.id),hideWeekends:this.state.rxData.hideWeekends||!1,t:n.t,language:h.I18n.getLanguage(),dayStep:this.state.rxData.dayStep||30,theme:this.props.context.theme},"".concat(this.state.rxData.viewMode,"_").concat(this.state.rxData.dayStep||30))}):a=(0,X.jsx)("div",{style:fe.content,ref:this.widgetRef,children:n.t("Please select instance")});return"relative"===this.state.rxStyle.position?this.wrapContent(a,null,{height:"calc(100% - 24px)",width:"calc(100% - 24px)"}):a}}],[{key:"getWidgetInfo",value:function(){return{id:"tplFullCalendar",visSet:"fullcalendar",visWidgetLabel:"fullcalendar",visSetLabel:"set_label",visSetColor:"#112233",visName:"Full calendar",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"fullcalendar",isShort:!0},{label:"calendar",name:"calendar",type:"custom",component:function(e,t,a,i){return(0,X.jsx)(me,{instance:t.instance,value:t.calendar,onChange:function(e){return a({calendar:e})},socket:i.context.socket,t:n.t},t.instance)},default:""},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_left_block",name:"hideLeftBlock",type:"checkbox",hidden:function(e){return e.readOnly},default:!1},{label:"hide_left_block_hint",name:"hideLeftBlockHint",type:"checkbox",hidden:function(e){return e.readOnly||e.hideLeftBlock},default:!1},{label:"hide_top_block",name:"hideTopBlock",type:"checkbox",default:!1},{label:"hide_top_block_buttons",name:"hideTopBlockButtons",type:"checkbox",hidden:function(e){return e.hide_top_block},default:!1},{label:"hide_weekends",name:"hideWeekends",type:"checkbox",default:!1},{label:"view_mode",name:"viewMode",type:"select",options:[{label:"full_calendar_dayGridMonth",value:"dayGridMonth"},{label:"full_calendar_timeGridWeek",value:"timeGridWeek"},{label:"full_calendar_timeGridDay",value:"timeGridDay"},{label:"full_calendar_listMonth",value:"listMonth"}],default:"dayGridMonth"},{label:"name",name:"name",tooltip:"used_only_with_relative",default:"",hidden:function(e,t,n){return n&&"relative"!==n.position}},{label:"day_step",tooltip:"day_step_minutes",name:"dayStep",default:30,type:"select",noTranslation:!0,hidden:function(e){return"timeGridDay"!==e.viewMode&&"timeGridWeek"!==e.viewMode},options:[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"5",value:5},{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"30",value:30},{label:"60",value:60}]}]}],visDefaultStyle:{width:"100%",height:355,position:"relative",absoluteWidth:500},visPrev:"widgets/fullcalendar/img/prev_fullcalendar.png"}}},{key:"t",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return h.I18n.t.apply(h.I18n,["full_calendar_".concat(e)].concat(n))}}]),n}(window.visRxWidget);he.propTypes={style:f().object,data:f().object,context:f().object};var pe=he}}]);
//# sourceMappingURL=src_FullCalendar_jsx.b32bf05c.chunk.js.map